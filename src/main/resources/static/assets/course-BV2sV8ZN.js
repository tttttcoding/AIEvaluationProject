import{s as V,E as r,d as O,u as j,r as v,z as P,a as h,g as U,h as z,b as D,e as C,i as t,w as c,k as f,j as y,F as R,l as w,p as F,A as H,y as M,o as L,_ as q}from"./index-ZCHI1N3d.js";import{b as G}from"./ToolsService-Bx7cvXeC.js";const J=async p=>{try{return(await V.get("/courses",{headers:{Authorization:p}})).data.courses}catch(o){if(o.response)switch(o.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${o.message}`)}else o.code==="ECONNABORTED"&&r.error("请求超时，请检查网络连接");return Promise.reject(o)}},K=async(p,o,l,m)=>{try{return console.log("!!!!!!!!!!!!!!addCourse"),(await V.post("/course",{Authorization:p,name:o,description:l,cno:m})).data}catch(d){if(d.response)switch(d.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${d.message}`)}else d.code==="ECONNABORTED"&&r.error("请求超时，请检查网络连接");return Promise.reject(d)}},Q=async(p,o,l,m,d)=>{try{return(await V.put(`/course/${o}`,{Authorization:p,name:l,description:m,cno:d})).data}catch(s){if(s.response)switch(s.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${s.message}`)}else s.code==="ECONNABORTED"&&r.error("请求超时，请检查网络连接");return Promise.reject(s)}},W=async(p,o)=>{try{return(await V.get(`/class/ratings/${o}`,{headers:{Authorization:p}})).data}catch(l){if(l.response)switch(l.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${l.message}`)}else l.code==="ECONNABORTED"&&r.error("请求超时，请检查网络连接");return Promise.reject(l)}},X=O("teacherCourse",()=>{const p=j(),o=v([]),l=async()=>{const e=await P();return o.value=e,e},m=v([]),d=async()=>{const e=p.user.token||"";if(!e){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),h.push("/form");return}const i=await J(e);return m.value=i,i},s=async(e,i,u)=>{const a=p.user.token||"";if(!a){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),h.push("/form");return}return await K(a,e,i,u)},k=async(e,i,u,a)=>{const _=p.user.token||"";if(!_){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),h.push("/form");return}return await Q(_,e,i,u,a)},b=v([]),S=async e=>{const i=p.user.token||"";if(!i){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),h.push("/form");return}const u=await W(i,e);return u!=null&&u.rates?(b.value=u.rates,await I()):r.error("获取历史评分记录失败"),u},I=async()=>{try{await Promise.all(b.value.map(async e=>{e.rate_time=e.rate_time.replace("T"," ");const i=await G(Number(e.tool_id));return e.tool_name=i.name||"未知工具",e.tool_category=i.category||"未知类别",{...e}}))}catch{r.error("格式化历史评分记录失败")}};return{classList:o,courseList:m,fetchClassList:l,fetchCourseList:d,changeCourse:k,createCourse:s,filterClassId:e=>{var a;console.log("filterClassName",e);let u=((a=o.value.filter(_=>_.name===e)[0])==null?void 0:a.id)||1;return String(u)},fetchRateHistory:S,rates:b}}),Y={class:"action-bar"},Z={class:"container-rates"},ee={class:"dialog-footer"},re=U({__name:"course",setup(p){const o=X(),l=v(!1),m=v(!1),d=v("create"),s=v({id:"",course:"",description:"",cno:""}),k=v(!0),b=(g,e)=>{d.value=g,l.value=!0,g==="edit"&&e?(s.value={...e},k.value=!1):(k.value=!0,s.value={id:"",course:"",description:"",cno:""})},S=()=>{k.value?(console.log("isCreate = true"),o.createCourse(s.value.course,s.value.description,s.value.cno)):o.changeCourse(Number(s.value.id),s.value.course,s.value.description,s.value.cno),o.fetchCourseList(),r.success(d.value==="create"?"创建成功":"更新成功"),l.value=!1},I=g=>{m.value=!0,o.fetchRateHistory(g.id)};return z(()=>{setTimeout(()=>{o.fetchClassList(),o.fetchCourseList(),console.log("班级列表:",o.classList),console.log("课程列表:",o.courseList)},1e3)}),(g,e)=>{const i=f("el-icon"),u=f("el-button"),a=f("el-table-column"),_=f("el-table"),N=f("el-input"),T=f("el-form-item"),$=f("el-option"),x=f("el-select"),A=f("el-form"),E=f("el-dialog");return L(),D(R,null,[e[12]||(e[12]=C("div",{class:"course-page"},"课程管理",-1)),C("div",Y,[t(u,{type:"primary",onClick:e[0]||(e[0]=n=>b("create"))},{default:c(()=>[t(i,null,{default:c(()=>[t(y(F))]),_:1}),e[7]||(e[7]=w("创建新课程 "))]),_:1,__:[7]})]),C("div",Z,[t(_,{data:y(o).courseList,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:c(()=>[t(a,{prop:"id",label:"课程ID",width:"80"}),t(a,{prop:"course",label:"课程名称",width:"150"}),t(a,{prop:"description",label:"课程描述",width:"250"}),t(a,{prop:"cno",label:"所属班级",width:"150"}),t(a,{label:"操作",width:"200"},{default:c(n=>[t(u,{size:"small",type:"primary",onClick:B=>b("edit",n.row)},{default:c(()=>e[8]||(e[8]=[w(" 编辑 ")])),_:2,__:[8]},1032,["onClick"]),t(u,{size:"small",type:"info",onClick:B=>I(n.row)},{default:c(()=>e[9]||(e[9]=[w(" 查看评价 ")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(E,{title:d.value==="create"?"创建新课程":"编辑课程",modelValue:l.value,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value=n),width:"500px"},{footer:c(()=>[C("span",ee,[t(u,{onClick:e[4]||(e[4]=n=>l.value=!1)},{default:c(()=>e[10]||(e[10]=[w("取消")])),_:1,__:[10]}),t(u,{type:"primary",onClick:S},{default:c(()=>e[11]||(e[11]=[w("保存")])),_:1,__:[11]})])]),default:c(()=>[t(A,{model:s.value,"label-width":"90px"},{default:c(()=>[t(T,{label:"课程名称"},{default:c(()=>[t(N,{modelValue:s.value.course,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.course=n),placeholder:"请输入课程名称"},null,8,["modelValue"])]),_:1}),t(T,{label:"课程描述"},{default:c(()=>[t(N,{type:"textarea",modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=n=>s.value.description=n),placeholder:"请输入课程描述",rows:3},null,8,["modelValue"])]),_:1}),t(T,{label:"所属班级"},{default:c(()=>[t(x,{modelValue:s.value.cno,"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.cno=n),placeholder:"请选择班级"},{default:c(()=>[(L(!0),D(R,null,H(y(o).classList,n=>(L(),M($,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(E,{title:"学生评价记录",modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),width:"80%"},{default:c(()=>[t(_,{data:y(o).rates,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:c(()=>[t(a,{prop:"user",label:"学生",width:"75"}),t(a,{prop:"tool_id",label:"工具id",width:"75"}),t(a,{prop:"tool_name",label:"工具名称",width:"90"}),t(a,{prop:"tool_category",label:"工具分类",width:"90"}),t(a,{prop:"rating",label:"评分",width:"60"}),t(a,{prop:"comment",label:"评论内容",width:"275"}),t(a,{prop:"rate_time",label:"评价时间",width:"185"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}}),se=q(re,[["__scopeId","data-v-b487af46"]]);export{se as default};
