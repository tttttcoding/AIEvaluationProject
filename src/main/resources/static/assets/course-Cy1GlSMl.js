import{s as N,E as r,d as j,u as D,r as _,y as P,a as C,h as U,i as z,b as R,e as V,j as t,w as n,l as f,k as S,m as $,q as h,v as H,z as F,A as M,o as I,_ as q}from"./index-Bc0iVnwy.js";import{u as G}from"./useScoreStore-D0K3hL-K.js";import{b as J}from"./ToolsService-CI-kn2Kv.js";import"./useToolsStore-BCcS8HQM.js";const K=async p=>{try{return(await N.get("/courses",{headers:{Authorization:p}})).data.courses}catch(o){if(o.response)switch(o.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${o.message}`)}else o.code==="ECONNABORTED"?r.error("请求超时，请检查网络连接"):r.error("网络错误，请检查网络连接");return Promise.reject(o)}},Q=async(p,o,a,m)=>{try{return(await N.post("/course",{Authorization:p,name:o,description:a,cno:m})).data}catch(d){if(d.response)switch(d.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${d.message}`)}else d.code==="ECONNABORTED"?r.error("请求超时，请检查网络连接"):r.error("网络错误，请检查网络连接");return Promise.reject(d)}},W=async(p,o,a,m,d)=>{try{return(await N.put(`/course/${o}`,{Authorization:p,name:a,description:m,cno:d})).data}catch(s){if(s.response)switch(s.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${s.message}`)}else s.code==="ECONNABORTED"?r.error("请求超时，请检查网络连接"):r.error("网络错误，请检查网络连接");return Promise.reject(s)}},X=async(p,o)=>{try{return(await N.get(`/class/ratings/${o}`,{headers:{Authorization:p}})).data}catch(a){if(a.response)switch(a.response.status){case 401:r.error("登录状态过期，请重新登录!"),localStorage.removeItem("user");break;case 403:r.error("没有权限访问");break;case 404:r.error("请求的资源不存在");break;case 500:r.error("服务器内部错误");break;default:r.error(`请求失败: ${a.message}`)}else a.code==="ECONNABORTED"?r.error("请求超时，请检查网络连接"):r.error("网络错误，请检查网络连接");return Promise.reject(a)}},Y=j("teacherCourse",()=>{const p=D(),o=_([]),a=async()=>{const e=await P();return o.value=e,e},m=_([]),d=async()=>{const e=p.user.token||"";if(!e){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),C.push("/form");return}const u=await K(e);return m.value=u,u},s=async(e,u,i)=>{const c=v(i),b=p.user.token||"";if(!b){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),C.push("/form");return}return await Q(b,e,u,c)},g=async(e,u,i,c)=>{const b=v(c),w=p.user.token||"";if(!w){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),C.push("/form");return}return await W(w,e,u,i,b)},k=_([]),T=async e=>{const u=p.user.token||"";if(!u){r.error("Token失效，请重新登录"),localStorage.removeItem("user"),C.push("/form");return}const i=await X(u,e);return i!=null&&i.rates?(k.value=i.rates,await E()):r.error("获取历史评分记录失败"),i},E=async()=>{try{await Promise.all(k.value.map(async e=>{e.rate_time=e.rate_time.replace("T"," ");const u=await J(Number(e.tool_id));return e.tool_name=u.name||"未知工具",e.tool_category=u.category||"未知类别",{...e}}))}catch{r.error("格式化历史评分记录失败")}},v=e=>o.value.filter(u=>u.name===e)[0].id;return{classList:o,courseList:m,fetchClassList:a,fetchCourseList:d,changeCourse:g,createCourse:s,filterClassId:v,fetchRateHistory:T,rates:k}}),Z={class:"action-bar"},ee={class:"container-rates"},re={class:"dialog-footer"},te=U({__name:"course",setup(p){D(),G();const o=Y();_([{id:1,name:"计算机1班"},{id:2,name:"计算机2班"}]),_([]);const a=_(!1),m=_(!1),d=_("create"),s=_({id:"",course:"",description:"",cno:""}),g=_(!0),k=(v,e)=>{d.value=v,a.value=!0,v==="edit"&&e?(s.value={...e},g.value=!1):(g.value=!0,s.value={id:"",course:"",description:"",cno:""})},T=()=>{g.value?o.createCourse(s.value.course,s.value.description,s.value.cno):o.changeCourse(Number(s.value.id),s.value.course,s.value.description,s.value.cno),o.fetchCourseList(),r.success(d.value==="create"?"创建成功":"更新成功"),a.value=!1},E=v=>{m.value=!0,o.fetchRateHistory(v.id)};return z(()=>{setTimeout(()=>{o.fetchClassList(),o.fetchCourseList()})}),(v,e)=>{const u=f("el-icon"),i=f("el-button"),c=f("el-table-column"),b=f("el-table"),w=f("el-input"),y=f("el-form-item"),x=f("el-option"),A=f("el-select"),B=f("el-form"),L=f("el-dialog");return I(),R($,null,[e[12]||(e[12]=V("div",{class:"course-page"},"课程管理",-1)),V("div",Z,[t(i,{type:"primary",onClick:e[0]||(e[0]=l=>k("create"))},{default:n(()=>[t(u,null,{default:n(()=>[t(S(H))]),_:1}),e[7]||(e[7]=h("创建新课程 "))]),_:1,__:[7]})]),V("div",ee,[t(b,{data:S(o).courseList,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:n(()=>[t(c,{prop:"id",label:"课程ID",width:"80"}),t(c,{prop:"course",label:"课程名称",width:"150"}),t(c,{prop:"description",label:"课程描述",width:"250"}),t(c,{prop:"cno",label:"所属班级",width:"150"}),t(c,{label:"操作",width:"200"},{default:n(l=>[t(i,{size:"small",type:"primary",onClick:O=>k("edit",l.row)},{default:n(()=>e[8]||(e[8]=[h(" 编辑 ")])),_:2,__:[8]},1032,["onClick"]),t(i,{size:"small",type:"info",onClick:O=>E(l.row)},{default:n(()=>e[9]||(e[9]=[h(" 查看评价 ")])),_:2,__:[9]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),t(L,{title:d.value==="create"?"创建新课程":"编辑课程",modelValue:a.value,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value=l),width:"500px"},{footer:n(()=>[V("span",re,[t(i,{onClick:e[4]||(e[4]=l=>a.value=!1)},{default:n(()=>e[10]||(e[10]=[h("取消")])),_:1,__:[10]}),t(i,{type:"primary",onClick:T},{default:n(()=>e[11]||(e[11]=[h("保存")])),_:1,__:[11]})])]),default:n(()=>[t(B,{model:s.value,"label-width":"90px"},{default:n(()=>[t(y,{label:"课程名称"},{default:n(()=>[t(w,{modelValue:s.value.course,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.course=l),placeholder:"请输入课程名称"},null,8,["modelValue"])]),_:1}),t(y,{label:"课程描述"},{default:n(()=>[t(w,{type:"textarea",modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l),placeholder:"请输入课程描述",rows:3},null,8,["modelValue"])]),_:1}),t(y,{label:"所属班级"},{default:n(()=>[t(A,{modelValue:s.value.cno,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.cno=l),placeholder:"请选择班级"},{default:n(()=>[(I(!0),R($,null,F(S(o).classList,l=>(I(),M(x,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),t(L,{title:"学生评价记录",modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=l=>m.value=l),width:"80%"},{default:n(()=>[t(b,{data:S(o).rates,style:{width:"100%"},"highlight-current-row":"",stripe:""},{default:n(()=>[t(c,{prop:"user",label:"学生",width:"75"}),t(c,{prop:"tool_id",label:"工具id",width:"75"}),t(c,{prop:"tool_name",label:"工具名称",width:"90"}),t(c,{prop:"tool_category",label:"工具分类",width:"90"}),t(c,{prop:"rating",label:"评分",width:"60"}),t(c,{prop:"comment",label:"评论内容",width:"275"}),t(c,{prop:"rate_time",label:"评价时间",width:"185"})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}}),ne=q(te,[["__scopeId","data-v-8c1c96db"]]);export{ne as default};
