import{T as me}from"./index-CJBLsY-P.js";import{d as pe,r as c,i as R,c as V,v as B,j as L,E as M,ad as ve,e as h,f as e,k as n,p as k,m as y,w as v,n as A,q as O,l as m,B as E,t as i,A as G,ae as he,af as Y,C as fe,U as ge,o as _,_ as H,H as q,ag as K,ah as P,ai as be,aj as F,ak as Se}from"./index-uf0FIciC.js";import{u as ye}from"./useSelectedToolStore-DTE7_rlX.js";import{u as X}from"./useScoreStore-BmVhGhYZ.js";import{L as ke}from"./loading-COF-PQm4.js";import"./theme-GRzP-Tyy.js";import"./ToolsService-Cj2k-usM.js";const we=pe("debounce",()=>{const w=c(!1);return c({}),{isSubmitting:w,debounce:(p,o=500)=>{let a=null;return function(...f){a&&clearTimeout(a),a=window.setTimeout(()=>{p.apply(null,f),a=null},o)}},withSubmitLock:async(p,o=3e3)=>{w.value||(w.value=!0,await p(),setTimeout(()=>{w.value=!1},o))},dailySubmitManager:{checkDailySubmit(p){const o=`dailySubmit_${p}`,a=localStorage.getItem(o);if(a){const f=new Date().toISOString().split("T")[0];return a===f}return!1},recordSubmit(p){const o=`dailySubmit_${p}`,a=new Date().toISOString().split("T")[0];localStorage.setItem(o,a)},getLastSubmitDate(p){const o=`dailySubmit_${p}`;return localStorage.getItem(o)||""}}}}),Te={class:"main-container"},$e={class:"main-score-container"},xe={class:"title"},Ce={class:"content"},Ie={class:"rating-container"},Ne={class:"rating-item"},De={class:"rating-title"},Ee={class:"score-label"},Le={class:"criteria-container"},Re={class:"criteria-list"},Ue={class:"comment"},Ve={key:0,class:"input-less"},Me={class:"submit-wrapper"},Ae={class:"submit-buttons"},Oe={key:0,class:"submit-info"},Fe={class:"main-upload-container"},Be={class:"score-title title"},He={class:"score-content-item"},ze={class:"score-header"},Je={class:"score-content-item-title"},je={class:"user-nickname"},Ge={class:"user-nickname"},Ye={class:"user-nickname"},qe={class:"score-content-item-score"},Ke={key:0,class:"score-content-item-content"},Pe={key:1,class:"no-comments"},W=10,We=500,Xe=5,Qe=R({__name:"score",setup(w){const l=c(0),d=c(0),T=c(!1),p=c(360),o=c(),a=c(),f=c(),u=X(),S=we(),x=c({id:""}),g=c(""),b=c(!1),C=["#C6D1DE","#409EFF","#67C23A"],I=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(t){return console.error("解析工具数据失败:",t),{id:""}}},N=(t,s="success")=>{M({message:t,type:s,duration:3e3,showClose:!0})},z=t=>typeof t=="string"?parseInt(t,10):t,J=V(()=>{var t;return!b.value&&!S.isSubmitting&&((t=x.value)==null?void 0:t.id)}),Q=V(()=>S.isSubmitting?"提交中...":b.value?"今日已提交":"提交评分"),D=V(()=>[...u.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),j=()=>{u.rateStandards.forEach(t=>{t.score=0}),u.rate.comment="",b.value=!1,g.value=""},Z=async()=>{try{await S.withSubmitLock(async()=>{const t=I();if(x.value=t,!t.id)throw new Error("未找到工具ID");const s=z(t.id);await u.evaluationTransmission(s),b.value=!0,g.value=new Date().toISOString().split("T")[0],N("评分提交成功，感谢您的参与！","success")})}catch(t){console.error("提交评分失败:",t),N("提交失败，请稍后重试","error")}},ee=t=>{var s;(s=a.value)==null||s.setScrollTop(t)},te=({scrollTop:t})=>{d.value=t},se=t=>`${t} px`;B(()=>I().id,(t,s)=>{t&&t!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",t),j())},{immediate:!0}),L(async()=>{try{const t=I();if(x.value=t,j(),t.id){const s=z(t.id);try{await u.ToolsDetailGet(s)}catch($){throw M.error("获取工具详情失败:",$),$}}await ve(),o.value&&(l.value=Math.max(0,o.value.clientHeight-p.value))}catch(t){M.error("初始化失败:",t),N("初始化失败，请刷新页面重试","error")}}),B(()=>{var t;return(t=u.rate.comment)==null?void 0:t.length},t=>{T.value=(t??0)<W});const oe=S.debounce(Z,We);return(t,s)=>{const $=y("el-icon"),ae=y("el-rate"),ne=y("el-popover"),le=y("el-input"),ie=y("el-button"),ce=y("el-avatar"),re=y("el-scrollbar"),de=y("el-slider");return _(),h("div",Te,[e("div",$e,[e("div",xe,[n($,null,{default:v(()=>[n(m(he))]),_:1}),s[2]||(s[2]=k("评分模块 "))]),e("div",Ce,[e("div",Ie,[(_(!0),h(A,null,O(m(u).rateStandards,(r,ue)=>(_(),G(ne,{key:ue,width:400,placement:"right",trigger:"hover"},{reference:v(()=>[e("div",Ne,[e("span",De,i(r.name)+"：",1),n(ae,{modelValue:r.score,"onUpdate:modelValue":U=>r.score=U,max:Xe,"allow-half":"",colors:C},null,8,["modelValue","onUpdate:modelValue"]),e("span",Ee,i(r.score)+" 分",1)])]),default:v(()=>[e("div",Le,[s[3]||(s[3]=e("div",{class:"criteria-header"},"评分标准",-1)),e("ul",Re,[(_(!0),h(A,null,O(r.criteria,(U,_e)=>(_(),h("li",{key:_e},i(U),1))),128))])])]),_:2},1024))),128))]),e("div",Ue,[n(le,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:m(u).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=r=>m(u).rate.comment=r),disabled:!J.value},null,8,["modelValue","disabled"]),T.value?(_(),h("p",Ve," 输入的字符数少于"+i(W)+"个! ")):E("",!0)]),e("div",Me,[e("div",Ae,[n(ie,{type:"primary",onClick:m(oe),class:"submit-btn",disabled:!J.value,loading:m(S).isSubmitting,ref_key:"submitRef",ref:f},{default:v(()=>[k(i(Q.value),1)]),_:1},8,["onClick","disabled","loading"])]),g.value?(_(),h("div",Oe," 上次提交日期: "+i(g.value),1)):E("",!0)])])]),e("div",Fe,[e("div",Be,[n($,null,{default:v(()=>[n(m(Y))]),_:1}),s[4]||(s[4]=k("用户评价 "))]),n(re,{class:"tool-details",always:"",onScroll:te,ref_key:"scrollbarRef",ref:a,height:`${p.value}px`},{default:v(()=>[e("div",{ref_key:"innerRef",ref:o},[D.value&&D.value.length>0?(_(!0),h(A,{key:0},O(D.value,r=>fe((_(),h("div",{class:"score-content",key:r.id},[e("div",He,[e("div",ze,[e("div",Je,[n(ce,{size:24,class:"user-avatar"},{default:v(()=>[k(i(r.user.charAt(0)),1)]),_:2},1024),e("span",je,"@"+i(r.user||"未设置昵称用户"),1),e("span",Ge,i(r.cno||"-"),1),e("span",Ye,"   "+i(r.rate_time.replace("T"," ")||"-"),1)]),e("div",qe,[s[5]||(s[5]=e("span",null,"评分：",-1)),k(i(r.rating)+" ⭐ ",1)])]),r.comment?(_(),h("div",Ke,i(r.comment),1)):E("",!0)])])),[[ge,r.comment&&r.comment.trim()]])),128)):(_(),h("div",Pe,[n($,{class:"icon"},{default:v(()=>[n(m(Y))]),_:1}),s[6]||(s[6]=e("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=e("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),l.value>0&&D.value&&D.value.length>0?(_(),G(de,{key:0,modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=r=>d.value=r),max:l.value,"format-tooltip":se,onInput:ee},null,8,["modelValue","max"])):E("",!0)])])}}}),Ze=H(Qe,[["__scopeId","data-v-04026a2f"]]),et={class:"upload-container"},tt={class:"header"},st={class:"content"},ot={class:"description"},at={class:"upload-section"},nt={key:0,class:"upload-warning"},lt={class:"file-name"},it={class:"file-hint"},ct=R({__name:"upload",setup(w){const l=X(),d=c("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。此外，对于每个工具，只能上传2次作业，请谨慎提交！"),T=c([".docx",".doc"]),p=c("点击或拖拽文件到此处上传"),o=c(!1),a=g=>{const b=[25,26,60,61,98,99,138,139,157,158];o.value=b.includes(g)};L(()=>{let g=JSON.parse(localStorage.getItem("selectedTool")||"{}").id;a(Number(g))});const f=c(null);B(()=>l.uploading,g=>{g?f.value=K({title:"文件上传进度",message:F("div",{class:"upload-progress-notification"},[F("el-progress",{percentage:l.progress,status:l.progress===100?"success":"",strokeWidth:8}),F("p",{class:"progress-text"},l.progress<100?`正在上传文件: ${l.progress}%`:"等待结果返回，请稍后...")]),duration:0,position:"bottom-right",showClose:!1}):f.value&&f.value.close()});const u=c(!1),S=c(0);L(()=>{S.value=Number(JSON.parse(localStorage.getItem("selectedTool")||"{}").id),a(S.value),u.value=!l.checkUploadCount(S.value)});const x=async()=>{if(u.value){K({title:"上传失败",message:"您已达到该工具的最大上传次数(2次)",type:"error"});return}try{await l.handleUpload(),l.recordUpload(S.value),u.value=!l.checkUploadCount(S.value)}catch(g){console.error("上传失败:",g)}};return(g,b)=>{const C=y("el-icon"),I=y("el-button");return _(),h("div",et,[e("div",tt,[n(C,null,{default:v(()=>[n(m(P))]),_:1}),b[1]||(b[1]=e("span",null,"提交评价报告",-1))]),e("div",st,[e("div",ot,i(d.value),1),e("div",at,[o.value?E("",!0):(_(),h("div",nt,b[2]||(b[2]=[k(" 当前工具不在开放作业上传的工具列表中，请使用以下工具："),e("a",{href:"https://a1.x914.com/alight/i/2025/06/06/41le.png",target:"_blank"},"查看开放工具列表",-1)]))),e("div",{class:q(["file-input",{disabled:!o.value}])},[e("div",{class:q(["input-wrapper",{"has-file":m(l).userFileName}])},[n(C,{class:"upload-icon"},{default:v(()=>[n(m(be))]),_:1}),e("input",{type:"file",accept:".docx",onChange:b[0]||(b[0]=N=>m(l).handleUserFileChange(N))},null,32),e("span",lt,i(m(l).userFileName||p.value),1),e("span",it," 支持 "+i(T.value.join(", "))+" 格式, 单个文件上限为2MB ",1)],2)],2),n(I,{type:"primary",onClick:x,loading:m(l).uploading,disabled:!o.value||u.value,class:"upload-btn"},{default:v(()=>[n(C,null,{default:v(()=>[n(m(P))]),_:1}),k(" "+i(o.value?u.value?"达到单个工具作业上传次数限制，后续不可上传":m(l).uploading?"上传中...":"开始上传":"当前工具不开放上传作业"),1)]),_:1},8,["loading","disabled"])])])])}}}),rt=H(ct,[["__scopeId","data-v-e5bd1ba7"]]),dt={class:"container"},ut={class:"main-info"},_t={class:"info"},mt={class:"header-section"},pt={class:"name"},vt={class:"score-badge"},ht={class:"score-value"},ft={class:"description"},gt={class:"tag-section"},bt={class:"tag-list"},St={class:"tag-item primary"},yt={class:"action-section"},kt={class:"logo-container"},wt={class:"logo-wrapper"},Tt=["src","alt"],$t={class:"content-sections"},xt={class:"score-section"},Ct={class:"upload-section"},It=R({__name:"index",setup(w){const l=c("全部工具"),d=c({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),T=ye(),p=o=>{window.open(o,"_blank","noopener,noreferrer")};return L(()=>{setTimeout(()=>{try{const o=localStorage.getItem("selectedTool");if(o){const a=JSON.parse(o);T.selectedTool=a,d.value=a}}catch(o){console.error("解析工具数据失败:",o)}},100)}),(o,a)=>{const f=y("el-breadcrumb-item"),u=y("el-breadcrumb");return _(),h("div",dt,[n(u,{"separator-icon":m(Se),class:"breadcrumb"},{default:v(()=>[n(f,{to:{path:"/home"}},{default:v(()=>[k(i(l.value),1)]),_:1}),n(f,null,{default:v(()=>[k(i(d.value.category),1)]),_:1}),n(f,null,{default:v(()=>[k(i(d.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),e("div",ut,[e("div",_t,[e("div",mt,[e("div",pt,i(d.value.name),1),e("div",vt,[e("span",ht,i(d.value.score),1),a[1]||(a[1]=e("span",{class:"score-stars"},[e("svg",{class:"icon",viewBox:"0 0 1300 720",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"29",height:"29"},[e("path",{d:"M512.009505 25.054894l158.199417 320.580987 353.791078 51.421464L767.995248 646.579761l60.432101 352.365345-316.417844-166.354615-316.436854 166.354615 60.432101-352.365345L0 397.057345l353.791078-51.421464z",fill:"#EFCE4A","p-id":"2289","data-spm-anchor-id":"a313x.search_index.0.i1.672b3a81KYHDAp",class:"selected"})])],-1))])]),e("div",ft,i(d.value.description),1),e("div",gt,[e("div",bt,[e("span",St,i(d.value.category),1),a[2]||(a[2]=e("span",{class:"tag-item secondary"},"AI工具",-1))])]),e("div",yt,[e("button",{class:"url-button",onClick:a[0]||(a[0]=S=>p(d.value.url))},a[3]||(a[3]=[e("span",{class:"button-text"},"访问官网",-1),e("span",{class:"button-icon"},"→",-1)]))])]),e("div",kt,[e("div",wt,[e("img",{src:d.value.logo_url,alt:d.value.name},null,8,Tt)])])]),e("div",$t,[e("div",xt,[n(Ze)]),e("div",Ct,[n(rt)])])])}}}),Nt=H(It,[["__scopeId","data-v-37575c5a"]]),Dt={key:0},Et={key:1},Lt={class:"top-nav"},Rt={class:"detail-main"},Ht=R({__name:"detailPage",setup(w){const l=c(!0);return L(()=>{setTimeout(()=>{l.value=!1},500)}),(d,T)=>l.value?(_(),h("div",Dt,[n(ke)])):(_(),h("div",Et,[e("nav",Lt,[n(me)]),e("div",Rt,[n(Nt)])]))}});export{Ht as default};
