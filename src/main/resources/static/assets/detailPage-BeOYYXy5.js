import{T as _e}from"./index-Be25NOi8.js";import{s as pe,ab as Ht,ac as Gt,ad as Pt,ae as Jt,d as te,r as c,E as L,b as z,A as J,w as K,e as j,af as ve,c as w,a as t,f as n,k as I,h as $,g as b,F as B,N as W,i as u,m as U,t as d,B as Y,ag as ge,ah as he,ai as Z,n as fe,O as be,o as f,_ as X,x as Se,aj as q,ak as ye,al as we}from"./index-DKYtXeHq.js";import{u as ke}from"./useSelectedToolStore-B8t1IZBc.js";import{u as $e,b as Te}from"./ToolsService-EtuJ20_q.js";import{L as xe}from"./loading-DehwT8_U.js";import"./github.vue_vue_type_style_index_0_scoped_c5cc798f_lang-B4xjD1Jc.js";const De=async(S,l)=>{try{return(await pe.post(`/evaluation/upload/${l}`,S,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){throw r.response?r.response.data:{message:"上传失败"}}};const se=te("score",()=>{const S=c(null),l=c(!1),r=c(""),x=c([]),p=c(!1),i=c([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),a=c({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),m=c(null),_=v=>{if(!m.value)return!0;const o=Date.now(),y=10*1e3;if(m.value.fileName===v&&o-m.value.timestamp<y){const k=Math.ceil((y-(o-m.value.timestamp))/1e3);return L.warning(`请求过于频繁，请等待 ${k} 秒后再次上传相同的文件`),!1}return!0},D=v=>{const o=v.target.files;o&&o.length>0&&(S.value=o[0],r.value=o[0].name)},N=c(0),C=1*1024*1024;function M(v){const o=[];let y=0;for(;y<v.size;){const k=Math.min(y+C,v.size);o.push(v.slice(y,k)),y=k}return o}const H=async()=>{if(!S.value){L.warning("请选择文件");return}if(!_(S.value.name))return;const v=JSON.parse(localStorage.getItem("user")).token;l.value=!0;try{m.value={timestamp:Date.now(),fileName:S.value.name};let o=null,y=null;const k=M(S.value),E=k.length;for(let F=0;F<k.length;F++){const A=new FormData;A.append("Authorization",v),A.append("file",k[F]),A.append("fileSum",String(E)),o=await De(A,F+1);const G=o.message;console.log(G),N.value=Math.round((F+1)/E*100)}y||L.error(y||"上传失败")}catch(o){L.error("上传失败"),console.error(o)}finally{l.value=!1}},R=c({}),T=async v=>{const o=V();console.log(o);const y={rating:o,comment:a.value.comment},k=JSON.parse(localStorage.getItem("user")).token;try{const E=await $e(k,y,v);console.log(E.message),await O(v)}catch(E){console.error("评价失败",E)}},O=async v=>{try{R.value={};const o=await Te(v);return console.log("获取到的工具详情:",o),R.value=o,o}catch(o){throw console.error("获取工具详情失败",o),o.response?o.response.data:{message:"请求失败"}}},V=()=>{const v=[.3,.25,.25,.1,.1];let o=0;return i.value.forEach((y,k)=>{o+=y.score*v[k]}),parseFloat(o.toFixed(1))};return{rateStandards:i,rate:a,progress:N,userFile:S,uploading:l,toolsDetail:R,userFileName:r,reportHistory:x,loadingHistory:p,lastUploadRecord:m,checkThrottle:_,handleUpload:H,handleUserFileChange:D,ToolsDetailGet:O,evaluationTransmission:T,calculateWeightedAverage:V}}),Ce=te("debounce",()=>{const S=c(!1);return c({}),{isSubmitting:S,debounce:(p,i=500)=>{let a=null;return function(...m){a&&clearTimeout(a),a=window.setTimeout(()=>{p.apply(null,m),a=null},i)}},withSubmitLock:async(p,i=3e3)=>{S.value||(S.value=!0,await p(),setTimeout(()=>{S.value=!1},i))},dailySubmitManager:{checkDailySubmit(p){const i=`dailySubmit_${p}`,a=localStorage.getItem(i);if(a){const m=new Date().toISOString().split("T")[0];return a===m}return!1},recordSubmit(p){const i=`dailySubmit_${p}`,a=new Date().toISOString().split("T")[0];localStorage.setItem(i,a)},getLastSubmitDate(p){const i=`dailySubmit_${p}`;return localStorage.getItem(i)||""}}}}),Ie={class:"main-container"},Ne={class:"main-score-container"},Ee={class:"title"},Re={class:"content"},Fe={class:"rating-container"},Me={class:"rating-item"},Ve={class:"rating-title"},Ae={class:"score-label"},Oe={class:"criteria-container"},Le={class:"criteria-list"},Ue={class:"comment"},Be={key:0,class:"input-less"},ze={class:"submit-wrapper"},He={class:"submit-buttons"},Ge={key:0,class:"submit-info"},Pe={class:"main-upload-container"},Je={class:"score-title title"},We={class:"score-content-item"},je={class:"score-header"},Xe={class:"score-content-item-title"},Ke={class:"user-nickname"},Ye={class:"score-content-item-score"},Ze={key:0,class:"score-content-item-content"},qe={key:1,class:"no-comments"},Q=10,Qe=500,ee=500,et=5,tt=z({__name:"score",setup(S){const l=c(0),r=c(0),x=c(!1),p=c(360),i=c(),a=c(),m=c(),_=se(),D=Ce(),N=c({id:""}),C=c(""),M=c(!1),H=["#C6D1DE","#409EFF","#67C23A"],R=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(e){return console.error("解析工具数据失败:",e),{id:""}}},T=(e,s="success")=>{L({message:e,type:s,duration:3e3,showClose:!0})},O=e=>typeof e=="string"?parseInt(e,10):e,V=J(()=>{var e;return!M.value&&!D.isSubmitting&&((e=N.value)==null?void 0:e.id)}),v=J(()=>D.isSubmitting?"提交中...":M.value?"今日已提交":"提交评分"),o=J(()=>[..._.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),y=()=>{_.rateStandards.forEach(e=>{e.score=0}),_.rate.comment="",M.value=!1,C.value=""},k=async()=>{try{await D.withSubmitLock(async()=>{const e=R();if(N.value=e,!e.id)throw new Error("未找到工具ID");const s=O(e.id);await _.evaluationTransmission(s),M.value=!0,C.value=new Date().toISOString().split("T")[0],T("评分提交成功，感谢您的参与！","success")})}catch(e){console.error("提交评分失败:",e),T("提交失败，请稍后重试","error")}},E=e=>{var s;(s=a.value)==null||s.setScrollTop(e)},F=({scrollTop:e})=>{r.value=e},A=e=>`${e} px`,G=()=>{if(!V.value){T("您今天已经提交过评分，请换个工具尝试或明天再来！","warning");return}if(!("webkitSpeechRecognition"in window)){T("您的浏览器不支持 Web Speech API，请使用 Chrome 浏览器！","warning");return}const e=new window.webkitSpeechRecognition;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("语音识别开始..."),T("请开始说话...","info")},e.onresult=s=>{const g=s.results[0][0].transcript;console.log("识别结果:",g),g.length>ee?(_.rate.comment=g.slice(0,ee),T("评论已超过最大长度限制，已自动截断","warning")):_.rate.comment=g},e.onerror=s=>{console.error("语音识别错误:",s.error),T("语音识别失败，请重试","error")},e.onend=()=>{console.log("语音识别结束"),T("语音识别已完成","success")},e.start()};K(()=>R().id,(e,s)=>{e&&e!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",e),y())},{immediate:!0}),j(async()=>{try{const e=R();if(N.value=e,console.log("当前工具信息:",e),y(),e.id){const s=O(e.id);console.log("开始获取工具详情，工具ID:",s);try{await _.ToolsDetailGet(s),console.log("获取到的工具详情:",_.toolsDetail),console.log("获取到的评分标准:",_.rateStandards)}catch(g){throw console.error("获取工具详情失败:",g),console.error("错误详情:",{message:(g==null?void 0:g.message)||"未知错误",stack:g==null?void 0:g.stack,toolId:s}),g}}await ve(),i.value&&(l.value=Math.max(0,i.value.clientHeight-p.value))}catch(e){console.error("初始化失败:",e),console.error("完整错误信息:",{name:(e==null?void 0:e.name)||"未知错误类型",message:(e==null?void 0:e.message)||"未知错误信息",stack:e==null?void 0:e.stack}),T("初始化失败，请刷新页面重试","error")}}),K(()=>{var e;return(e=_.rate.comment)==null?void 0:e.length},e=>{x.value=(e??0)<Q});const oe=D.debounce(k,Qe);return(e,s)=>{const g=$("el-icon"),ae=$("el-rate"),ne=$("el-popover"),le=$("el-input"),ce=$("el-button"),re=$("el-avatar"),ie=$("el-scrollbar"),ue=$("el-slider");return f(),w("div",Ie,[t("div",Ne,[t("div",Ee,[n(g,null,{default:b(()=>[n(u(ge))]),_:1}),s[2]||(s[2]=I("评分模块 "))]),t("div",Re,[t("div",Fe,[(f(!0),w(B,null,W(u(_).rateStandards,(h,de)=>(f(),Y(ne,{key:de,width:400,placement:"right",trigger:"hover"},{reference:b(()=>[t("div",Me,[t("span",Ve,d(h.name)+"：",1),n(ae,{modelValue:h.score,"onUpdate:modelValue":P=>h.score=P,max:et,"allow-half":"",colors:H},null,8,["modelValue","onUpdate:modelValue"]),t("span",Ae,d(h.score)+" 分",1)])]),default:b(()=>[t("div",Oe,[s[3]||(s[3]=t("div",{class:"criteria-header"},"评分标准",-1)),t("ul",Le,[(f(!0),w(B,null,W(h.criteria,(P,me)=>(f(),w("li",{key:me},d(P),1))),128))])])]),_:2},1024))),128))]),t("div",Ue,[n(le,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:u(_).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=h=>u(_).rate.comment=h),disabled:!V.value},null,8,["modelValue","disabled"]),x.value?(f(),w("p",Be," 输入的字符数少于"+d(Q)+"个! ")):U("",!0)]),t("div",ze,[t("div",He,[n(g,{onClick:G,class:"mic-icon"},{default:b(()=>[n(u(he))]),_:1}),n(ce,{type:"primary",onClick:u(oe),class:"submit-btn",disabled:!V.value,loading:u(D).isSubmitting,ref_key:"submitRef",ref:m},{default:b(()=>[I(d(v.value),1)]),_:1},8,["onClick","disabled","loading"])]),C.value?(f(),w("div",Ge," 上次提交日期: "+d(C.value),1)):U("",!0)])])]),t("div",Pe,[t("div",Je,[n(g,null,{default:b(()=>[n(u(Z))]),_:1}),s[4]||(s[4]=I("用户评价 "))]),n(ie,{class:"tool-details",always:"",onScroll:F,ref_key:"scrollbarRef",ref:a,height:`${p.value}px`},{default:b(()=>[t("div",{ref_key:"innerRef",ref:i},[o.value&&o.value.length>0?(f(!0),w(B,{key:0},W(o.value,h=>fe((f(),w("div",{class:"score-content",key:h.id},[t("div",We,[t("div",je,[t("div",Xe,[n(re,{size:24,class:"user-avatar"},{default:b(()=>[I(d(h.user.charAt(0)),1)]),_:2},1024),t("span",Ke,"@"+d(h.user||"未设置昵称用户"),1)]),t("div",Ye,[s[5]||(s[5]=t("span",null,"评分：",-1)),I(d(h.rating)+" ⭐ ",1)])]),h.comment?(f(),w("div",Ze,d(h.comment),1)):U("",!0)])])),[[be,h.comment&&h.comment.trim()]])),128)):(f(),w("div",qe,[n(g,{class:"icon"},{default:b(()=>[n(u(Z))]),_:1}),s[6]||(s[6]=t("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=t("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),l.value>0&&o.value&&o.value.length>0?(f(),Y(ue,{key:0,modelValue:r.value,"onUpdate:modelValue":s[1]||(s[1]=h=>r.value=h),max:l.value,"format-tooltip":A,onInput:E},null,8,["modelValue","max"])):U("",!0)])])}}}),st=X(tt,[["__scopeId","data-v-fe64a419"]]),ot={class:"upload-container"},at={class:"header"},nt={class:"content"},lt={class:"description"},ct={class:"upload-section"},rt={class:"file-input"},it={class:"file-name"},ut={class:"file-hint"},dt={class:"progress-content"},mt={key:0,class:"progress-text"},_t={key:1,class:"progress-text"},pt=z({__name:"upload",setup(S){const l=se(),r=c("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),x=c([".docx",".doc"]),p=c("点击或拖拽文件到此处上传");return(i,a)=>{const m=$("el-icon"),_=$("el-button"),D=$("el-progress"),N=$("el-dialog");return f(),w(B,null,[t("div",ot,[t("div",at,[n(m,null,{default:b(()=>[n(u(q))]),_:1}),a[2]||(a[2]=t("span",null,"提交评价报告",-1))]),t("div",nt,[t("div",lt,d(r.value),1),t("div",ct,[t("div",rt,[t("div",{class:Se(["input-wrapper",{"has-file":u(l).userFileName}])},[n(m,{class:"upload-icon"},{default:b(()=>[n(u(ye))]),_:1}),t("input",{type:"file",accept:".docx",onChange:a[0]||(a[0]=C=>u(l).handleUserFileChange(C))},null,32),t("span",it,d(u(l).userFileName||p.value),1),t("span",ut," 支持 "+d(x.value.join(", "))+" 格式, 单个文件上限为2MB ",1)],2)]),n(_,{type:"primary",onClick:u(l).handleUpload,loading:u(l).uploading,class:"upload-btn"},{default:b(()=>[n(m,null,{default:b(()=>[n(u(q))]),_:1}),I(" "+d(u(l).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])]),n(N,{modelValue:u(l).uploading,"onUpdate:modelValue":a[1]||(a[1]=C=>u(l).uploading=C),title:"文件上传进度",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:b(()=>[t("div",dt,[n(D,{percentage:u(l).progress,status:u(l).progress===100?"success":"","stroke-width":15},null,8,["percentage","status"]),u(l).progress<100?(f(),w("p",mt," 正在上传文件: "+d(u(l).progress)+"% ",1)):(f(),w("p",_t,"评估处理中，请耐心等待..."))])]),_:1},8,["modelValue"])],64)}}}),vt=X(pt,[["__scopeId","data-v-88ae83bf"]]),gt={class:"container"},ht={class:"main-info"},ft={class:"info"},bt={class:"header-section"},St={class:"name"},yt={class:"score-badge"},wt={class:"score-value"},kt={class:"description"},$t={class:"tag-section"},Tt={class:"tag-list"},xt={class:"tag-item primary"},Dt={class:"action-section"},Ct={class:"logo-container"},It={class:"logo-wrapper"},Nt=["src","alt"],Et={class:"content-sections"},Rt={class:"score-section"},Ft={class:"upload-section"},Mt=z({__name:"index",setup(S){const l=c("全部工具"),r=c({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),x=ke(),p=i=>{window.open(i,"_blank","noopener,noreferrer")};return j(()=>{setTimeout(()=>{try{const i=localStorage.getItem("selectedTool");if(i){const a=JSON.parse(i);x.selectedTool=a,r.value=a}}catch(i){console.error("解析工具数据失败:",i)}},100)}),(i,a)=>{const m=$("el-breadcrumb-item"),_=$("el-breadcrumb");return f(),w("div",gt,[n(_,{"separator-icon":u(we),class:"breadcrumb"},{default:b(()=>[n(m,{to:{path:"/home"}},{default:b(()=>[I(d(l.value),1)]),_:1}),n(m,null,{default:b(()=>[I(d(r.value.category),1)]),_:1}),n(m,null,{default:b(()=>[I(d(r.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),t("div",ht,[t("div",ft,[t("div",bt,[t("div",St,d(r.value.name),1),t("div",yt,[t("span",wt,d(r.value.score),1),a[1]||(a[1]=t("span",{class:"score-stars"},"⭐",-1))])]),t("div",kt,d(r.value.description),1),t("div",$t,[t("div",Tt,[t("span",xt,d(r.value.category),1),a[2]||(a[2]=t("span",{class:"tag-item secondary"},"AI工具",-1))])]),t("div",Dt,[t("button",{class:"url-button",onClick:a[0]||(a[0]=D=>p(r.value.url))},a[3]||(a[3]=[t("span",{class:"button-text"},"访问官网",-1),t("span",{class:"button-icon"},"→",-1)]))])]),t("div",Ct,[t("div",It,[t("img",{src:r.value.logo_url,alt:r.value.name},null,8,Nt)])])]),t("div",Et,[t("div",Rt,[n(st)]),t("div",Ft,[n(vt)])])])}}}),Vt=X(Mt,[["__scopeId","data-v-42a55656"]]),At={key:0},Ot={key:1},Lt={class:"top-nav"},Ut={class:"detail-main"},Yt=z({__name:"detailPage",setup(S){const l=c(!0);return j(()=>{setTimeout(()=>{l.value=!1},500)}),(r,x)=>l.value?(f(),w("div",At,[n(xe)])):(f(),w("div",Ot,[t("nav",Lt,[n(_e)]),t("div",Ut,[n(Vt)])]))}});export{Yt as default};
