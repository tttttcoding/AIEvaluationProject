import{T as pe}from"./index-w_jVy6gQ.js";import{s as se,ab as ge,ac as ve,ad as he,ae as fe,d as oe,r as u,E,b as H,A as P,w as Y,e as X,a6 as be,c as k,a as t,f as l,k as D,h as x,g as b,F as j,N as W,i as g,m as B,t as d,B as Z,af as Se,ag as ye,ah as q,n as we,O as ke,o as S,_ as K,x as $e,ai as Q,aj as Te,ak as xe}from"./index-cI5jML3S.js";import{u as Ce}from"./useSelectedToolStore-DkxDavyt.js";import{u as Ie,b as De}from"./ToolsService-DSsT47uS.js";import{L as Ne}from"./loading-Bh1GW7lF.js";import"./github.vue_vue_type_style_index_0_scoped_c5cc798f_lang-C6Q_O1Nl.js";const Ee=async(m,a)=>{try{return(await se.post(`/evaluation/upload/${a}`,m,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(c){throw c.response?c.response.data:{message:"上传失败"}}},Fe=async m=>{try{const a=await se.post("/evaluation",{Authorization:m});return{message:a.data.message,status:a.status}}catch(a){throw a.response?a.response.data:{message:"获取评价结果失败"}}},Re=async(m,a)=>{try{const c=m.split(`
`).map(r=>new ge(r)),$=new ve({sections:[{properties:{},children:c}]}),_=await he.toBlob($);fe.saveAs(_,`${a}的评测报告.docx`)}catch{throw new Error("生成报告失败")}},ae=oe("score",()=>{const m=u(null),a=u(!1),c=u(""),$=u([]),_=u(!1),r=u([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),o=u({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),y=n=>{const i=n.target.files;i&&i.length>0&&(m.value=i[0],c.value=i[0].name)},p=1*1024*1024;function C(n){const i=[];let f=0;for(;f<n.size;){const T=Math.min(f+p,n.size);i.push(n.slice(f,T)),f=T}return i}const O=async()=>{if(!m.value){E.warning("请选择文件");return}const n=new FormData;n.append("file",m.value);const i=JSON.parse(localStorage.getItem("user")).token;n.append("Authorization",i),console.log(i,n.get("file")),a.value=!0;try{let f=null,T=null;const w=C(m.value),U=w.length;for(let I=0;I<w.length;I++){n.append("chunk",w[I]),n.append("fileSum",String(U)),f=await Ee(n,I+1);const A=f.message;console.log(A),I===w.length-1?(E.success("上传完成，正在评估，请稍后"),T=A):E.info(`第 ${I+1} / ${w.length} 片上传成功`)}if(T){const I=async()=>{try{const M=JSON.parse(localStorage.getItem("user")).token,z=await Fe(M),V=z.status;if(console.log("状态码为",V),V===200){const J=z.message,e=JSON.parse('"'+J.replace(/\\\\/g,"\\")+'"');console.log(e),E.success("评估完成，正在生成报告");const s=JSON.parse(localStorage.getItem("user"));return await Re(e,s.username),console.log("评估完成"),!0}else if(V===204)return console.log("继续轮询"),!1;return console.log("继续轮询"),!1}catch(M){return console.error("轮询评估结果失败",M),console.log("出错继续轮询"),!1}},A=setInterval(async()=>{await I()&&(console.log("停止轮询"),clearInterval(A))},2e3)}else E.error(T||"上传失败")}catch(f){E.error("上传失败"),console.error(f)}finally{a.value=!1}},N=u({}),F=async n=>{const i=R();console.log(i);const f={rating:i,comment:o.value.comment},T=JSON.parse(localStorage.getItem("user")).token;try{const w=await Ie(T,f,n);console.log(w.message),await L(n)}catch(w){console.error("评价失败",w)}},L=async n=>{try{N.value={};const i=await De(n);return console.log("获取到的工具详情:",i),N.value=i,i}catch(i){throw console.error("获取工具详情失败",i),i.response?i.response.data:{message:"请求失败"}}},R=()=>{const n=[.3,.25,.25,.1,.1];let i=0;return r.value.forEach((f,T)=>{i+=f.score*n[T]}),parseFloat(i.toFixed(1))};return{rateStandards:r,rate:o,userFile:m,uploading:a,toolsDetail:N,userFileName:c,reportHistory:$,loadingHistory:_,handleUpload:O,handleUserFileChange:y,ToolsDetailGet:L,evaluationTransmission:F,calculateWeightedAverage:R}}),Ae=oe("debounce",()=>{const m=u(!1);return u({}),{isSubmitting:m,debounce:(_,r=500)=>{let o=null;return function(...y){o&&clearTimeout(o),o=window.setTimeout(()=>{_.apply(null,y),o=null},r)}},withSubmitLock:async(_,r=3e3)=>{m.value||(m.value=!0,await _(),setTimeout(()=>{m.value=!1},r))},dailySubmitManager:{checkDailySubmit(_){const r=`dailySubmit_${_}`,o=localStorage.getItem(r);if(o){const y=new Date().toISOString().split("T")[0];return o===y}return!1},recordSubmit(_){const r=`dailySubmit_${_}`,o=new Date().toISOString().split("T")[0];localStorage.setItem(r,o)},getLastSubmitDate(_){const r=`dailySubmit_${_}`;return localStorage.getItem(r)||""}}}}),Me={class:"main-container"},Oe={class:"main-score-container"},Ve={class:"title"},Le={class:"content"},Ue={class:"rating-container"},ze={class:"rating-item"},Be={class:"rating-title"},He={class:"score-label"},Je={class:"criteria-container"},Ge={class:"criteria-list"},Pe={class:"comment"},je={key:0,class:"input-less"},We={class:"submit-wrapper"},Xe={class:"submit-buttons"},Ke={key:0,class:"submit-info"},Ye={class:"main-upload-container"},Ze={class:"score-title title"},qe={class:"score-content-item"},Qe={class:"score-header"},et={class:"score-content-item-title"},tt={class:"user-nickname"},st={class:"score-content-item-score"},ot={key:0,class:"score-content-item-content"},at={key:1,class:"no-comments"},ee=10,nt=500,te=500,lt=5,ct=H({__name:"score",setup(m){const a=u(0),c=u(0),$=u(!1),_=u(360),r=u(),o=u(),y=u(),p=ae(),C=Ae(),O=u({id:""}),N=u(""),F=u(!1),L=["#C6D1DE","#409EFF","#67C23A"],R=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(e){return console.error("解析工具数据失败:",e),{id:""}}},n=(e,s="success")=>{E({message:e,type:s,duration:3e3,showClose:!0})},i=e=>typeof e=="string"?parseInt(e,10):e,f=P(()=>{var e;return!F.value&&!C.isSubmitting&&((e=O.value)==null?void 0:e.id)}),T=P(()=>C.isSubmitting?"提交中...":F.value?"今日已提交":"提交评分"),w=P(()=>[...p.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),U=()=>{p.rateStandards.forEach(e=>{e.score=0}),p.rate.comment="",F.value=!1,N.value=""},I=async()=>{try{await C.withSubmitLock(async()=>{const e=R();if(O.value=e,!e.id)throw new Error("未找到工具ID");const s=i(e.id);await p.evaluationTransmission(s),F.value=!0,N.value=new Date().toISOString().split("T")[0],n("评分提交成功，感谢您的参与！","success")})}catch(e){console.error("提交评分失败:",e),n("提交失败，请稍后重试","error")}},A=e=>{var s;(s=o.value)==null||s.setScrollTop(e)},M=({scrollTop:e})=>{c.value=e},z=e=>`${e} px`,V=()=>{if(!f.value){n("您今天已经提交过评分，请换个工具尝试或明天再来！","warning");return}if(!("webkitSpeechRecognition"in window)){n("您的浏览器不支持 Web Speech API，请使用 Chrome 浏览器！","warning");return}const e=new window.webkitSpeechRecognition;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("语音识别开始..."),n("请开始说话...","info")},e.onresult=s=>{const v=s.results[0][0].transcript;console.log("识别结果:",v),v.length>te?(p.rate.comment=v.slice(0,te),n("评论已超过最大长度限制，已自动截断","warning")):p.rate.comment=v},e.onerror=s=>{console.error("语音识别错误:",s.error),n("语音识别失败，请重试","error")},e.onend=()=>{console.log("语音识别结束"),n("语音识别已完成","success")},e.start()};Y(()=>R().id,(e,s)=>{e&&e!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",e),U())},{immediate:!0}),X(async()=>{try{const e=R();if(O.value=e,console.log("当前工具信息:",e),U(),e.id){const s=i(e.id);console.log("开始获取工具详情，工具ID:",s);try{await p.ToolsDetailGet(s),console.log("获取到的工具详情:",p.toolsDetail),console.log("获取到的评分标准:",p.rateStandards)}catch(v){throw console.error("获取工具详情失败:",v),console.error("错误详情:",{message:(v==null?void 0:v.message)||"未知错误",stack:v==null?void 0:v.stack,toolId:s}),v}}await be(),r.value&&(a.value=Math.max(0,r.value.clientHeight-_.value))}catch(e){console.error("初始化失败:",e),console.error("完整错误信息:",{name:(e==null?void 0:e.name)||"未知错误类型",message:(e==null?void 0:e.message)||"未知错误信息",stack:e==null?void 0:e.stack}),n("初始化失败，请刷新页面重试","error")}}),Y(()=>{var e;return(e=p.rate.comment)==null?void 0:e.length},e=>{$.value=(e??0)<ee});const J=C.debounce(I,nt);return(e,s)=>{const v=x("el-icon"),ne=x("el-rate"),le=x("el-popover"),ce=x("el-input"),re=x("el-button"),ie=x("el-avatar"),ue=x("el-scrollbar"),de=x("el-slider");return S(),k("div",Me,[t("div",Oe,[t("div",Ve,[l(v,null,{default:b(()=>[l(g(Se))]),_:1}),s[2]||(s[2]=D("评分模块 "))]),t("div",Le,[t("div",Ue,[(S(!0),k(j,null,W(g(p).rateStandards,(h,me)=>(S(),Z(le,{key:me,width:400,placement:"right",trigger:"hover"},{reference:b(()=>[t("div",ze,[t("span",Be,d(h.name)+"：",1),l(ne,{modelValue:h.score,"onUpdate:modelValue":G=>h.score=G,max:lt,"allow-half":"",colors:L},null,8,["modelValue","onUpdate:modelValue"]),t("span",He,d(h.score)+" 分",1)])]),default:b(()=>[t("div",Je,[s[3]||(s[3]=t("div",{class:"criteria-header"},"评分标准",-1)),t("ul",Ge,[(S(!0),k(j,null,W(h.criteria,(G,_e)=>(S(),k("li",{key:_e},d(G),1))),128))])])]),_:2},1024))),128))]),t("div",Pe,[l(ce,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:g(p).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=h=>g(p).rate.comment=h),disabled:!f.value},null,8,["modelValue","disabled"]),$.value?(S(),k("p",je," 输入的字符数少于"+d(ee)+"个! ")):B("",!0)]),t("div",We,[t("div",Xe,[l(v,{onClick:V,class:"mic-icon"},{default:b(()=>[l(g(ye))]),_:1}),l(re,{type:"primary",onClick:g(J),class:"submit-btn",disabled:!f.value,loading:g(C).isSubmitting,ref_key:"submitRef",ref:y},{default:b(()=>[D(d(T.value),1)]),_:1},8,["onClick","disabled","loading"])]),N.value?(S(),k("div",Ke," 上次提交日期: "+d(N.value),1)):B("",!0)])])]),t("div",Ye,[t("div",Ze,[l(v,null,{default:b(()=>[l(g(q))]),_:1}),s[4]||(s[4]=D("用户评价 "))]),l(ue,{class:"tool-details",always:"",onScroll:M,ref_key:"scrollbarRef",ref:o,height:`${_.value}px`},{default:b(()=>[t("div",{ref_key:"innerRef",ref:r},[w.value&&w.value.length>0?(S(!0),k(j,{key:0},W(w.value,h=>we((S(),k("div",{class:"score-content",key:h.id},[t("div",qe,[t("div",Qe,[t("div",et,[l(ie,{size:24,class:"user-avatar"},{default:b(()=>[D(d(h.user.charAt(0)),1)]),_:2},1024),t("span",tt,"@"+d(h.user||"未设置昵称用户"),1)]),t("div",st,[s[5]||(s[5]=t("span",null,"评分：",-1)),D(d(h.rating)+" ⭐ ",1)])]),h.comment?(S(),k("div",ot,d(h.comment),1)):B("",!0)])])),[[ke,h.comment&&h.comment.trim()]])),128)):(S(),k("div",at,[l(v,{class:"icon"},{default:b(()=>[l(g(q))]),_:1}),s[6]||(s[6]=t("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=t("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),a.value>0&&w.value&&w.value.length>0?(S(),Z(de,{key:0,modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=h=>c.value=h),max:a.value,"format-tooltip":z,onInput:A},null,8,["modelValue","max"])):B("",!0)])])}}}),rt=K(ct,[["__scopeId","data-v-fe64a419"]]),it={class:"upload-container"},ut={class:"header"},dt={class:"content"},mt={class:"description"},_t={class:"upload-section"},pt={class:"file-input"},gt={class:"file-name"},vt={class:"file-hint"},ht=H({__name:"upload",setup(m){const a=ae(),c=u("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),$=u([".docx",".doc"]),_=u("点击或拖拽文件到此处上传");return(r,o)=>{const y=x("el-icon"),p=x("el-button");return S(),k("div",it,[t("div",ut,[l(y,null,{default:b(()=>[l(g(Q))]),_:1}),o[1]||(o[1]=t("span",null,"提交评价报告",-1))]),t("div",dt,[t("div",mt,d(c.value),1),t("div",_t,[t("div",pt,[t("div",{class:$e(["input-wrapper",{"has-file":g(a).userFileName}])},[l(y,{class:"upload-icon"},{default:b(()=>[l(g(Te))]),_:1}),t("input",{type:"file",accept:".docx",onChange:o[0]||(o[0]=C=>g(a).handleUserFileChange(C))},null,32),t("span",gt,d(g(a).userFileName||_.value),1),t("span",vt," 支持 "+d($.value.join(", "))+" 格式 ",1)],2)]),l(p,{type:"primary",onClick:g(a).handleUpload,loading:g(a).uploading,class:"upload-btn"},{default:b(()=>[l(y,null,{default:b(()=>[l(g(Q))]),_:1}),D(" "+d(g(a).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])])}}}),ft=K(ht,[["__scopeId","data-v-5e41dcac"]]),bt={class:"container"},St={class:"main-info"},yt={class:"info"},wt={class:"header-section"},kt={class:"name"},$t={class:"score-badge"},Tt={class:"score-value"},xt={class:"description"},Ct={class:"tag-section"},It={class:"tag-list"},Dt={class:"tag-item primary"},Nt={class:"action-section"},Et={class:"logo-container"},Ft={class:"logo-wrapper"},Rt=["src","alt"],At={class:"content-sections"},Mt={class:"score-section"},Ot={class:"upload-section"},Vt=H({__name:"index",setup(m){const a=u("全部工具"),c=u({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),$=Ce(),_=r=>{window.open(r,"_blank","noopener,noreferrer")};return X(()=>{setTimeout(()=>{try{const r=localStorage.getItem("selectedTool");if(r){const o=JSON.parse(r);$.selectedTool=o,c.value=o}}catch(r){console.error("解析工具数据失败:",r)}},100)}),(r,o)=>{const y=x("el-breadcrumb-item"),p=x("el-breadcrumb");return S(),k("div",bt,[l(p,{"separator-icon":g(xe),class:"breadcrumb"},{default:b(()=>[l(y,{to:{path:"/home"}},{default:b(()=>[D(d(a.value),1)]),_:1}),l(y,null,{default:b(()=>[D(d(c.value.category),1)]),_:1}),l(y,null,{default:b(()=>[D(d(c.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),t("div",St,[t("div",yt,[t("div",wt,[t("div",kt,d(c.value.name),1),t("div",$t,[t("span",Tt,d(c.value.score),1),o[1]||(o[1]=t("span",{class:"score-stars"},"⭐",-1))])]),t("div",xt,d(c.value.description),1),t("div",Ct,[t("div",It,[t("span",Dt,d(c.value.category),1),o[2]||(o[2]=t("span",{class:"tag-item secondary"},"AI工具",-1))])]),t("div",Nt,[t("button",{class:"url-button",onClick:o[0]||(o[0]=C=>_(c.value.url))},o[3]||(o[3]=[t("span",{class:"button-text"},"访问官网",-1),t("span",{class:"button-icon"},"→",-1)]))])]),t("div",Et,[t("div",Ft,[t("img",{src:c.value.logo_url,alt:c.value.name},null,8,Rt)])])]),t("div",At,[t("div",Mt,[l(rt)]),t("div",Ot,[l(ft)])])])}}}),Lt=K(Vt,[["__scopeId","data-v-42a55656"]]),Ut={key:0},zt={key:1},Bt={class:"top-nav"},Ht={class:"detail-main"},Kt=H({__name:"detailPage",setup(m){const a=u(!0);return X(()=>{setTimeout(()=>{a.value=!1},500)}),(c,$)=>a.value?(S(),k("div",Ut,[l(Ne)])):(S(),k("div",zt,[t("nav",Bt,[l(pe)]),t("div",Ht,[l(Lt)])]))}});export{Kt as default};
