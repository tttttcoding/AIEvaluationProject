import{T as _e}from"./index-W7-aNi5j.js";import{s as pe,E as T,a as ve,ac as Pt,ad as jt,ae as Gt,af as Jt,d as te,r as c,e as z,B as G,w as q,f as W,ag as ge,c as w,b as t,g as n,l as N,i as $,h as b,F as B,O as J,j as u,n as U,t as d,C as K,ah as he,ai as fe,aj as Y,q as be,P as Se,o as f,_ as X,y as ye,ak as Z,al as we,am as ke}from"./index-Bn9PkK3f.js";import{u as $e}from"./useSelectedToolStore-CjTmXgEA.js";import{u as Te,b as De}from"./ToolsService-DFiPCrKj.js";import{L as xe}from"./loading-zs7ApR2m.js";import"./github.vue_vue_type_style_index_0_scoped_c5cc798f_lang-CgfJmLkw.js";const Ce=async(S,r)=>{try{return(await pe.post(`/evaluation/upload/${r}`,S,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(l){if(l.response)switch(l.response.status){case 401:T.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),ve.push("/form");break;case 403:T.error("没有权限访问");break;case 404:T.error("请求的资源不存在");break;case 500:T.error("服务器内部错误");break;default:T.error(`请求失败: ${l.message}`)}else l.code==="ECONNABORTED"?T.error("请求超时，请检查网络连接"):T.error("网络错误，请检查网络连接");return Promise.reject(l)}};const se=te("score",()=>{const S=c(null),r=c(!1),l=c(""),x=c([]),p=c(!1),i=c([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),a=c({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),m=c(null),_=v=>{if(!m.value)return!0;const o=Date.now(),y=10*1e3;if(m.value.fileName===v&&o-m.value.timestamp<y){const k=Math.ceil((y-(o-m.value.timestamp))/1e3);return T.warning(`请求过于频繁，请等待 ${k} 秒后再次上传相同的文件`),!1}return!0},C=v=>{const o=v.target.files;o&&o.length>0&&(S.value=o[0],l.value=o[0].name)},E=c(0),I=1*1024*1024;function A(v){const o=[];let y=0;for(;y<v.size;){const k=Math.min(y+I,v.size);o.push(v.slice(y,k)),y=k}return o}const H=async()=>{if(!S.value){T.warning("请选择文件");return}if(!_(S.value.name))return;const v=JSON.parse(localStorage.getItem("user")).token;r.value=!0;try{m.value={timestamp:Date.now(),fileName:S.value.name};let o=null,y=null;const k=A(S.value),R=k.length;for(let M=0;M<k.length;M++){const V=new FormData;V.append("Authorization",v),V.append("file",k[M]),V.append("fileSum",String(R)),o=await Ce(V,M+1);const P=o.message;console.log(P),E.value=Math.round((M+1)/R*100)}y||T.error(y||"上传失败")}catch(o){T.error("上传失败"),console.error(o)}finally{r.value=!1}},F=c({}),D=async v=>{const o=O();console.log(o);const y={rating:o,comment:a.value.comment},k=JSON.parse(localStorage.getItem("user")).token;try{const R=await Te(k,y,v);console.log(R.message),await L(v)}catch(R){console.error("评价失败",R)}},L=async v=>{try{F.value={};const o=await De(v);return console.log("获取到的工具详情:",o),F.value=o,o}catch(o){throw console.error("获取工具详情失败",o),o.response?o.response.data:{message:"请求失败"}}},O=()=>{const v=[.3,.25,.25,.1,.1];let o=0;return i.value.forEach((y,k)=>{o+=y.score*v[k]}),parseFloat(o.toFixed(1))};return{rateStandards:i,rate:a,progress:E,userFile:S,uploading:r,toolsDetail:F,userFileName:l,reportHistory:x,loadingHistory:p,lastUploadRecord:m,checkThrottle:_,handleUpload:H,handleUserFileChange:C,ToolsDetailGet:L,evaluationTransmission:D,calculateWeightedAverage:O}}),Ie=te("debounce",()=>{const S=c(!1);return c({}),{isSubmitting:S,debounce:(p,i=500)=>{let a=null;return function(...m){a&&clearTimeout(a),a=window.setTimeout(()=>{p.apply(null,m),a=null},i)}},withSubmitLock:async(p,i=3e3)=>{S.value||(S.value=!0,await p(),setTimeout(()=>{S.value=!1},i))},dailySubmitManager:{checkDailySubmit(p){const i=`dailySubmit_${p}`,a=localStorage.getItem(i);if(a){const m=new Date().toISOString().split("T")[0];return a===m}return!1},recordSubmit(p){const i=`dailySubmit_${p}`,a=new Date().toISOString().split("T")[0];localStorage.setItem(i,a)},getLastSubmitDate(p){const i=`dailySubmit_${p}`;return localStorage.getItem(i)||""}}}}),Ne={class:"main-container"},Ee={class:"main-score-container"},Re={class:"title"},Fe={class:"content"},Me={class:"rating-container"},Ae={class:"rating-item"},Oe={class:"rating-title"},Ve={class:"score-label"},Le={class:"criteria-container"},Ue={class:"criteria-list"},Be={class:"comment"},ze={key:0,class:"input-less"},He={class:"submit-wrapper"},Pe={class:"submit-buttons"},je={key:0,class:"submit-info"},Ge={class:"main-upload-container"},Je={class:"score-title title"},We={class:"score-content-item"},Xe={class:"score-header"},qe={class:"score-content-item-title"},Ke={class:"user-nickname"},Ye={class:"score-content-item-score"},Ze={key:0,class:"score-content-item-content"},Qe={key:1,class:"no-comments"},Q=10,et=500,ee=500,tt=5,st=z({__name:"score",setup(S){const r=c(0),l=c(0),x=c(!1),p=c(360),i=c(),a=c(),m=c(),_=se(),C=Ie(),E=c({id:""}),I=c(""),A=c(!1),H=["#C6D1DE","#409EFF","#67C23A"],F=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(e){return console.error("解析工具数据失败:",e),{id:""}}},D=(e,s="success")=>{T({message:e,type:s,duration:3e3,showClose:!0})},L=e=>typeof e=="string"?parseInt(e,10):e,O=G(()=>{var e;return!A.value&&!C.isSubmitting&&((e=E.value)==null?void 0:e.id)}),v=G(()=>C.isSubmitting?"提交中...":A.value?"今日已提交":"提交评分"),o=G(()=>[..._.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),y=()=>{_.rateStandards.forEach(e=>{e.score=0}),_.rate.comment="",A.value=!1,I.value=""},k=async()=>{try{await C.withSubmitLock(async()=>{const e=F();if(E.value=e,!e.id)throw new Error("未找到工具ID");const s=L(e.id);await _.evaluationTransmission(s),A.value=!0,I.value=new Date().toISOString().split("T")[0],D("评分提交成功，感谢您的参与！","success")})}catch(e){console.error("提交评分失败:",e),D("提交失败，请稍后重试","error")}},R=e=>{var s;(s=a.value)==null||s.setScrollTop(e)},M=({scrollTop:e})=>{l.value=e},V=e=>`${e} px`,P=()=>{if(!O.value){D("您今天已经提交过评分，请换个工具尝试或明天再来！","warning");return}if(!("webkitSpeechRecognition"in window)){D("您的浏览器不支持 Web Speech API，请使用 Chrome 浏览器！","warning");return}const e=new window.webkitSpeechRecognition;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("语音识别开始..."),D("请开始说话...","info")},e.onresult=s=>{const g=s.results[0][0].transcript;console.log("识别结果:",g),g.length>ee?(_.rate.comment=g.slice(0,ee),D("评论已超过最大长度限制，已自动截断","warning")):_.rate.comment=g},e.onerror=s=>{console.error("语音识别错误:",s.error),D("语音识别失败，请重试","error")},e.onend=()=>{console.log("语音识别结束"),D("语音识别已完成","success")},e.start()};q(()=>F().id,(e,s)=>{e&&e!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",e),y())},{immediate:!0}),W(async()=>{try{const e=F();if(E.value=e,console.log("当前工具信息:",e),y(),e.id){const s=L(e.id);console.log("开始获取工具详情，工具ID:",s);try{await _.ToolsDetailGet(s),console.log("获取到的工具详情:",_.toolsDetail),console.log("获取到的评分标准:",_.rateStandards)}catch(g){throw console.error("获取工具详情失败:",g),console.error("错误详情:",{message:(g==null?void 0:g.message)||"未知错误",stack:g==null?void 0:g.stack,toolId:s}),g}}await ge(),i.value&&(r.value=Math.max(0,i.value.clientHeight-p.value))}catch(e){console.error("初始化失败:",e),console.error("完整错误信息:",{name:(e==null?void 0:e.name)||"未知错误类型",message:(e==null?void 0:e.message)||"未知错误信息",stack:e==null?void 0:e.stack}),D("初始化失败，请刷新页面重试","error")}}),q(()=>{var e;return(e=_.rate.comment)==null?void 0:e.length},e=>{x.value=(e??0)<Q});const oe=C.debounce(k,et);return(e,s)=>{const g=$("el-icon"),ae=$("el-rate"),ne=$("el-popover"),re=$("el-input"),le=$("el-button"),ce=$("el-avatar"),ie=$("el-scrollbar"),ue=$("el-slider");return f(),w("div",Ne,[t("div",Ee,[t("div",Re,[n(g,null,{default:b(()=>[n(u(he))]),_:1}),s[2]||(s[2]=N("评分模块 "))]),t("div",Fe,[t("div",Me,[(f(!0),w(B,null,J(u(_).rateStandards,(h,de)=>(f(),K(ne,{key:de,width:400,placement:"right",trigger:"hover"},{reference:b(()=>[t("div",Ae,[t("span",Oe,d(h.name)+"：",1),n(ae,{modelValue:h.score,"onUpdate:modelValue":j=>h.score=j,max:tt,"allow-half":"",colors:H},null,8,["modelValue","onUpdate:modelValue"]),t("span",Ve,d(h.score)+" 分",1)])]),default:b(()=>[t("div",Le,[s[3]||(s[3]=t("div",{class:"criteria-header"},"评分标准",-1)),t("ul",Ue,[(f(!0),w(B,null,J(h.criteria,(j,me)=>(f(),w("li",{key:me},d(j),1))),128))])])]),_:2},1024))),128))]),t("div",Be,[n(re,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:u(_).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=h=>u(_).rate.comment=h),disabled:!O.value},null,8,["modelValue","disabled"]),x.value?(f(),w("p",ze," 输入的字符数少于"+d(Q)+"个! ")):U("",!0)]),t("div",He,[t("div",Pe,[n(g,{onClick:P,class:"mic-icon"},{default:b(()=>[n(u(fe))]),_:1}),n(le,{type:"primary",onClick:u(oe),class:"submit-btn",disabled:!O.value,loading:u(C).isSubmitting,ref_key:"submitRef",ref:m},{default:b(()=>[N(d(v.value),1)]),_:1},8,["onClick","disabled","loading"])]),I.value?(f(),w("div",je," 上次提交日期: "+d(I.value),1)):U("",!0)])])]),t("div",Ge,[t("div",Je,[n(g,null,{default:b(()=>[n(u(Y))]),_:1}),s[4]||(s[4]=N("用户评价 "))]),n(ie,{class:"tool-details",always:"",onScroll:M,ref_key:"scrollbarRef",ref:a,height:`${p.value}px`},{default:b(()=>[t("div",{ref_key:"innerRef",ref:i},[o.value&&o.value.length>0?(f(!0),w(B,{key:0},J(o.value,h=>be((f(),w("div",{class:"score-content",key:h.id},[t("div",We,[t("div",Xe,[t("div",qe,[n(ce,{size:24,class:"user-avatar"},{default:b(()=>[N(d(h.user.charAt(0)),1)]),_:2},1024),t("span",Ke,"@"+d(h.user||"未设置昵称用户"),1)]),t("div",Ye,[s[5]||(s[5]=t("span",null,"评分：",-1)),N(d(h.rating)+" ⭐ ",1)])]),h.comment?(f(),w("div",Ze,d(h.comment),1)):U("",!0)])])),[[Se,h.comment&&h.comment.trim()]])),128)):(f(),w("div",Qe,[n(g,{class:"icon"},{default:b(()=>[n(u(Y))]),_:1}),s[6]||(s[6]=t("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=t("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),r.value>0&&o.value&&o.value.length>0?(f(),K(ue,{key:0,modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=h=>l.value=h),max:r.value,"format-tooltip":V,onInput:R},null,8,["modelValue","max"])):U("",!0)])])}}}),ot=X(st,[["__scopeId","data-v-fe64a419"]]),at={class:"upload-container"},nt={class:"header"},rt={class:"content"},lt={class:"description"},ct={class:"upload-section"},it={class:"file-input"},ut={class:"file-name"},dt={class:"file-hint"},mt={class:"progress-content"},_t={key:0,class:"progress-text"},pt={key:1,class:"progress-text"},vt=z({__name:"upload",setup(S){const r=se(),l=c("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),x=c([".docx",".doc"]),p=c("点击或拖拽文件到此处上传");return(i,a)=>{const m=$("el-icon"),_=$("el-button"),C=$("el-progress"),E=$("el-dialog");return f(),w(B,null,[t("div",at,[t("div",nt,[n(m,null,{default:b(()=>[n(u(Z))]),_:1}),a[2]||(a[2]=t("span",null,"提交评价报告",-1))]),t("div",rt,[t("div",lt,d(l.value),1),t("div",ct,[t("div",it,[t("div",{class:ye(["input-wrapper",{"has-file":u(r).userFileName}])},[n(m,{class:"upload-icon"},{default:b(()=>[n(u(we))]),_:1}),t("input",{type:"file",accept:".docx",onChange:a[0]||(a[0]=I=>u(r).handleUserFileChange(I))},null,32),t("span",ut,d(u(r).userFileName||p.value),1),t("span",dt," 支持 "+d(x.value.join(", "))+" 格式, 单个文件上限为2MB ",1)],2)]),n(_,{type:"primary",onClick:u(r).handleUpload,loading:u(r).uploading,class:"upload-btn"},{default:b(()=>[n(m,null,{default:b(()=>[n(u(Z))]),_:1}),N(" "+d(u(r).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])]),n(E,{modelValue:u(r).uploading,"onUpdate:modelValue":a[1]||(a[1]=I=>u(r).uploading=I),title:"文件上传进度",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:b(()=>[t("div",mt,[n(C,{percentage:u(r).progress,status:u(r).progress===100?"success":"","stroke-width":15},null,8,["percentage","status"]),u(r).progress<100?(f(),w("p",_t," 正在上传文件: "+d(u(r).progress)+"% ",1)):(f(),w("p",pt,"评估处理中，请耐心等待..."))])]),_:1},8,["modelValue"])],64)}}}),gt=X(vt,[["__scopeId","data-v-88ae83bf"]]),ht={class:"container"},ft={class:"main-info"},bt={class:"info"},St={class:"header-section"},yt={class:"name"},wt={class:"score-badge"},kt={class:"score-value"},$t={class:"description"},Tt={class:"tag-section"},Dt={class:"tag-list"},xt={class:"tag-item primary"},Ct={class:"action-section"},It={class:"logo-container"},Nt={class:"logo-wrapper"},Et=["src","alt"],Rt={class:"content-sections"},Ft={class:"score-section"},Mt={class:"upload-section"},At=z({__name:"index",setup(S){const r=c("全部工具"),l=c({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),x=$e(),p=i=>{window.open(i,"_blank","noopener,noreferrer")};return W(()=>{setTimeout(()=>{try{const i=localStorage.getItem("selectedTool");if(i){const a=JSON.parse(i);x.selectedTool=a,l.value=a}}catch(i){console.error("解析工具数据失败:",i)}},100)}),(i,a)=>{const m=$("el-breadcrumb-item"),_=$("el-breadcrumb");return f(),w("div",ht,[n(_,{"separator-icon":u(ke),class:"breadcrumb"},{default:b(()=>[n(m,{to:{path:"/home"}},{default:b(()=>[N(d(r.value),1)]),_:1}),n(m,null,{default:b(()=>[N(d(l.value.category),1)]),_:1}),n(m,null,{default:b(()=>[N(d(l.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),t("div",ft,[t("div",bt,[t("div",St,[t("div",yt,d(l.value.name),1),t("div",wt,[t("span",kt,d(l.value.score),1),a[1]||(a[1]=t("span",{class:"score-stars"},"⭐",-1))])]),t("div",$t,d(l.value.description),1),t("div",Tt,[t("div",Dt,[t("span",xt,d(l.value.category),1),a[2]||(a[2]=t("span",{class:"tag-item secondary"},"AI工具",-1))])]),t("div",Ct,[t("button",{class:"url-button",onClick:a[0]||(a[0]=C=>p(l.value.url))},a[3]||(a[3]=[t("span",{class:"button-text"},"访问官网",-1),t("span",{class:"button-icon"},"→",-1)]))])]),t("div",It,[t("div",Nt,[t("img",{src:l.value.logo_url,alt:l.value.name},null,8,Et)])])]),t("div",Rt,[t("div",Ft,[n(ot)]),t("div",Mt,[n(gt)])])])}}}),Ot=X(At,[["__scopeId","data-v-42a55656"]]),Vt={key:0},Lt={key:1},Ut={class:"top-nav"},Bt={class:"detail-main"},Yt=z({__name:"detailPage",setup(S){const r=c(!0);return W(()=>{setTimeout(()=>{r.value=!1},500)}),(l,x)=>r.value?(f(),w("div",Vt,[n(xe)])):(f(),w("div",Lt,[t("nav",Ut,[n(_e)]),t("div",Bt,[n(Ot)])]))}});export{Yt as default};
