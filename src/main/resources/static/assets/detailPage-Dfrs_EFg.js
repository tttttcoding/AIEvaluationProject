import{T as de}from"./index-B2yJ0yw8.js";import{d as ue,r as _,g as I,c as R,m as z,h as F,E as M,ad as _e,b as v,e,i as a,l as b,k as h,w as m,F as E,A,j as n,B as D,t as l,y as j,ae as me,af as G,C as pe,U as ve,o as u,_ as U,H as he,ag as J,ah as ge,ai as fe}from"./index-ZCHI1N3d.js";import{u as be}from"./useSelectedToolStore-P--qPDgT.js";import{u as K}from"./useScoreStore-BxaJM46H.js";import{L as Se}from"./loading-X9k4tBg4.js";import"./theme-DTxeISNh.js";import"./ToolsService-Bx7cvXeC.js";const ye=ue("debounce",()=>{const S=_(!1);return _({}),{isSubmitting:S,debounce:(p,c=500)=>{let s=null;return function(...g){s&&clearTimeout(s),s=window.setTimeout(()=>{p.apply(null,g),s=null},c)}},withSubmitLock:async(p,c=3e3)=>{S.value||(S.value=!0,await p(),setTimeout(()=>{S.value=!1},c))},dailySubmitManager:{checkDailySubmit(p){const c=`dailySubmit_${p}`,s=localStorage.getItem(c);if(s){const g=new Date().toISOString().split("T")[0];return s===g}return!1},recordSubmit(p){const c=`dailySubmit_${p}`,s=new Date().toISOString().split("T")[0];localStorage.setItem(c,s)},getLastSubmitDate(p){const c=`dailySubmit_${p}`;return localStorage.getItem(c)||""}}}}),$e={class:"main-container"},we={class:"main-score-container"},ke={class:"title"},Te={class:"content"},xe={class:"rating-container"},Ce={class:"rating-item"},De={class:"rating-title"},Ee={class:"score-label"},Ie={class:"criteria-container"},Ve={class:"criteria-list"},Le={class:"comment"},Ne={key:0,class:"input-less"},Re={class:"submit-wrapper"},Me={class:"submit-buttons"},Ae={key:0,class:"submit-info"},Fe={class:"main-upload-container"},Ue={class:"score-title title"},Be={class:"score-content-item"},Oe={class:"score-header"},He={class:"score-content-item-title"},ze={class:"user-nickname"},je={class:"user-nickname"},Ge={class:"user-nickname"},Je={class:"score-content-item-score"},Ye={key:0,class:"score-content-item-content"},Ke={key:1,class:"no-comments"},Y=10,Pe=500,Xe=5,qe=I({__name:"score",setup(S){const i=_(0),d=_(0),y=_(!1),p=_(360),c=_(),s=_(),g=_(),f=K(),$=ye(),T=_({id:""}),w=_(""),C=_(!1),P=["#C6D1DE","#409EFF","#67C23A"],V=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(t){return console.error("解析工具数据失败:",t),{id:""}}},L=(t,o="success")=>{M({message:t,type:o,duration:3e3,showClose:!0})},B=t=>typeof t=="string"?parseInt(t,10):t,O=R(()=>{var t;return!C.value&&!$.isSubmitting&&((t=T.value)==null?void 0:t.id)}),X=R(()=>$.isSubmitting?"提交中...":C.value?"今日已提交":"提交评分"),x=R(()=>[...f.toolsDetail.rates||[]].reverse().filter(o=>o.comment&&o.comment.trim()!=="")),H=()=>{f.rateStandards.forEach(t=>{t.score=0}),f.rate.comment="",C.value=!1,w.value=""},q=async()=>{try{await $.withSubmitLock(async()=>{const t=V();if(T.value=t,!t.id)throw new Error("未找到工具ID");const o=B(t.id);await f.evaluationTransmission(o),C.value=!0,w.value=new Date().toISOString().split("T")[0],L("评分提交成功，感谢您的参与！","success")})}catch(t){console.error("提交评分失败:",t),L("提交失败，请稍后重试","error")}},Q=t=>{var o;(o=s.value)==null||o.setScrollTop(t)},W=({scrollTop:t})=>{d.value=t},Z=t=>`${t} px`;z(()=>V().id,(t,o)=>{t&&t!==o&&(console.log("工具ID变化，重置评分状态:",o,"->",t),H())},{immediate:!0}),F(async()=>{try{const t=V();if(T.value=t,H(),t.id){const o=B(t.id);try{await f.ToolsDetailGet(o)}catch(k){throw M.error("获取工具详情失败:",k),k}}await _e(),c.value&&(i.value=Math.max(0,c.value.clientHeight-p.value))}catch(t){M.error("初始化失败:",t),L("初始化失败，请刷新页面重试","error")}}),z(()=>{var t;return(t=f.rate.comment)==null?void 0:t.length},t=>{y.value=(t??0)<Y});const ee=$.debounce(q,Pe);return(t,o)=>{const k=h("el-icon"),te=h("el-rate"),se=h("el-popover"),oe=h("el-input"),ae=h("el-button"),ne=h("el-avatar"),le=h("el-scrollbar"),ie=h("el-slider");return u(),v("div",$e,[e("div",we,[e("div",ke,[a(k,null,{default:m(()=>[a(n(me))]),_:1}),o[2]||(o[2]=b("评分模块 "))]),e("div",Te,[e("div",xe,[(u(!0),v(E,null,A(n(f).rateStandards,(r,ce)=>(u(),j(se,{key:ce,width:400,placement:"right",trigger:"hover"},{reference:m(()=>[e("div",Ce,[e("span",De,l(r.name)+"：",1),a(te,{modelValue:r.score,"onUpdate:modelValue":N=>r.score=N,max:Xe,"allow-half":"",colors:P},null,8,["modelValue","onUpdate:modelValue"]),e("span",Ee,l(r.score)+" 分",1)])]),default:m(()=>[e("div",Ie,[o[3]||(o[3]=e("div",{class:"criteria-header"},"评分标准",-1)),e("ul",Ve,[(u(!0),v(E,null,A(r.criteria,(N,re)=>(u(),v("li",{key:re},l(N),1))),128))])])]),_:2},1024))),128))]),e("div",Le,[a(oe,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:n(f).rate.comment,"onUpdate:modelValue":o[0]||(o[0]=r=>n(f).rate.comment=r),disabled:!O.value},null,8,["modelValue","disabled"]),y.value?(u(),v("p",Ne," 输入的字符数少于"+l(Y)+"个! ")):D("",!0)]),e("div",Re,[e("div",Me,[a(ae,{type:"primary",onClick:n(ee),class:"submit-btn",disabled:!O.value,loading:n($).isSubmitting,ref_key:"submitRef",ref:g},{default:m(()=>[b(l(X.value),1)]),_:1},8,["onClick","disabled","loading"])]),w.value?(u(),v("div",Ae," 上次提交日期: "+l(w.value),1)):D("",!0)])])]),e("div",Fe,[e("div",Ue,[a(k,null,{default:m(()=>[a(n(G))]),_:1}),o[4]||(o[4]=b("用户评价 "))]),a(le,{class:"tool-details",always:"",onScroll:W,ref_key:"scrollbarRef",ref:s,height:`${p.value}px`},{default:m(()=>[e("div",{ref_key:"innerRef",ref:c},[x.value&&x.value.length>0?(u(!0),v(E,{key:0},A(x.value,r=>pe((u(),v("div",{class:"score-content",key:r.id},[e("div",Be,[e("div",Oe,[e("div",He,[a(ne,{size:24,class:"user-avatar"},{default:m(()=>[b(l(r.user.charAt(0)),1)]),_:2},1024),e("span",ze,"@"+l(r.user||"未设置昵称用户"),1),e("span",je,l(r.cno||"-"),1),e("span",Ge,"   "+l(r.rate_time.replace("T"," ")||"-"),1)]),e("div",Je,[o[5]||(o[5]=e("span",null,"评分：",-1)),b(l(r.rating)+" ⭐ ",1)])]),r.comment?(u(),v("div",Ye,l(r.comment),1)):D("",!0)])])),[[ve,r.comment&&r.comment.trim()]])),128)):(u(),v("div",Ke,[a(k,{class:"icon"},{default:m(()=>[a(n(G))]),_:1}),o[6]||(o[6]=e("div",{class:"message"},"暂无用户评价",-1)),o[7]||(o[7]=e("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),i.value>0&&x.value&&x.value.length>0?(u(),j(ie,{key:0,modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=r=>d.value=r),max:i.value,"format-tooltip":Z,onInput:Q},null,8,["modelValue","max"])):D("",!0)])])}}}),Qe=U(qe,[["__scopeId","data-v-04026a2f"]]),We={class:"upload-container"},Ze={class:"header"},et={class:"content"},tt={class:"description"},st={class:"upload-section"},ot={class:"file-input"},at={class:"file-name"},nt={class:"file-hint"},lt={class:"progress-content"},it={key:0,class:"progress-text"},ct={key:1,class:"progress-text"},rt=I({__name:"upload",setup(S){const i=K(),d=_("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),y=_([".docx",".doc"]),p=_("点击或拖拽文件到此处上传");return(c,s)=>{const g=h("el-icon"),f=h("el-button"),$=h("el-progress"),T=h("el-dialog");return u(),v(E,null,[e("div",We,[e("div",Ze,[a(g,null,{default:m(()=>[a(n(J))]),_:1}),s[2]||(s[2]=e("span",null,"提交评价报告",-1))]),e("div",et,[e("div",tt,l(d.value),1),e("div",st,[e("div",ot,[e("div",{class:he(["input-wrapper",{"has-file":n(i).userFileName}])},[a(g,{class:"upload-icon"},{default:m(()=>[a(n(ge))]),_:1}),e("input",{type:"file",accept:".docx",onChange:s[0]||(s[0]=w=>n(i).handleUserFileChange(w))},null,32),e("span",at,l(n(i).userFileName||p.value),1),e("span",nt," 支持 "+l(y.value.join(", "))+" 格式, 单个文件上限为2MB ",1)],2)]),a(f,{type:"primary",onClick:n(i).handleUpload,loading:n(i).uploading,class:"upload-btn"},{default:m(()=>[a(g,null,{default:m(()=>[a(n(J))]),_:1}),b(" "+l(n(i).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])]),a(T,{modelValue:n(i).uploading,"onUpdate:modelValue":s[1]||(s[1]=w=>n(i).uploading=w),title:"文件上传进度",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:m(()=>[e("div",lt,[a($,{percentage:n(i).progress,status:n(i).progress===100?"success":"","stroke-width":15},null,8,["percentage","status"]),n(i).progress<100?(u(),v("p",it," 正在上传文件: "+l(n(i).progress)+"% ",1)):(u(),v("p",ct,"等待结果返回，请稍后..."))])]),_:1},8,["modelValue"])],64)}}}),dt=U(rt,[["__scopeId","data-v-8c0cfb32"]]),ut={class:"container"},_t={class:"main-info"},mt={class:"info"},pt={class:"header-section"},vt={class:"name"},ht={class:"score-badge"},gt={class:"score-value"},ft={class:"description"},bt={class:"tag-section"},St={class:"tag-list"},yt={class:"tag-item primary"},$t={class:"action-section"},wt={class:"logo-container"},kt={class:"logo-wrapper"},Tt=["src","alt"],xt={class:"content-sections"},Ct={class:"score-section"},Dt={class:"upload-section"},Et=I({__name:"index",setup(S){const i=_("全部工具"),d=_({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),y=be(),p=c=>{window.open(c,"_blank","noopener,noreferrer")};return F(()=>{setTimeout(()=>{try{const c=localStorage.getItem("selectedTool");if(c){const s=JSON.parse(c);y.selectedTool=s,d.value=s}}catch(c){console.error("解析工具数据失败:",c)}},100)}),(c,s)=>{const g=h("el-breadcrumb-item"),f=h("el-breadcrumb");return u(),v("div",ut,[a(f,{"separator-icon":n(fe),class:"breadcrumb"},{default:m(()=>[a(g,{to:{path:"/home"}},{default:m(()=>[b(l(i.value),1)]),_:1}),a(g,null,{default:m(()=>[b(l(d.value.category),1)]),_:1}),a(g,null,{default:m(()=>[b(l(d.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),e("div",_t,[e("div",mt,[e("div",pt,[e("div",vt,l(d.value.name),1),e("div",ht,[e("span",gt,l(d.value.score),1),s[1]||(s[1]=e("span",{class:"score-stars"},[e("svg",{class:"icon",viewBox:"0 0 1300 720",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"29",height:"29"},[e("path",{d:"M512.009505 25.054894l158.199417 320.580987 353.791078 51.421464L767.995248 646.579761l60.432101 352.365345-316.417844-166.354615-316.436854 166.354615 60.432101-352.365345L0 397.057345l353.791078-51.421464z",fill:"#EFCE4A","p-id":"2289","data-spm-anchor-id":"a313x.search_index.0.i1.672b3a81KYHDAp",class:"selected"})])],-1))])]),e("div",ft,l(d.value.description),1),e("div",bt,[e("div",St,[e("span",yt,l(d.value.category),1),s[2]||(s[2]=e("span",{class:"tag-item secondary"},"AI工具",-1))])]),e("div",$t,[e("button",{class:"url-button",onClick:s[0]||(s[0]=$=>p(d.value.url))},s[3]||(s[3]=[e("span",{class:"button-text"},"访问官网",-1),e("span",{class:"button-icon"},"→",-1)]))])]),e("div",wt,[e("div",kt,[e("img",{src:d.value.logo_url,alt:d.value.name},null,8,Tt)])])]),e("div",xt,[e("div",Ct,[a(Qe)]),e("div",Dt,[a(dt)])])])}}}),It=U(Et,[["__scopeId","data-v-37575c5a"]]),Vt={key:0},Lt={key:1},Nt={class:"top-nav"},Rt={class:"detail-main"},zt=I({__name:"detailPage",setup(S){const i=_(!0);return F(()=>{setTimeout(()=>{i.value=!1},500)}),(d,y)=>i.value?(u(),v("div",Vt,[a(Se)])):(u(),v("div",Lt,[e("nav",Nt,[a(de)]),e("div",Rt,[a(It)])]))}});export{zt as default};
