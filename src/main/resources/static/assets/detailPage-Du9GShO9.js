import{T as pe}from"./index-B7bie7zQ.js";import{s as ee,ab as ve,ac as ge,ad as he,ae as fe,d as te,r as c,E,b as L,A as H,w as X,e as j,a6 as be,c as w,a as t,f as n,k as I,h as T,g as h,F as G,N as P,i as p,m as M,t as u,B as Y,af as Se,ag as ye,ah as q,n as we,O as ke,o as b,_ as W,x as $e,ai as K,aj as Te,ak as xe}from"./index-DFfRBlu0.js";import{u as Ce}from"./useSelectedToolStore-DFMdHIiV.js";import{u as De,b as Ie}from"./ToolsService-kAmPzzl5.js";import{L as Ne}from"./loading-Bh8NjNDk.js";import"./github.vue_vue_type_style_index_0_scoped_c5cc798f_lang-rEtG9IZ4.js";const Re=async m=>{try{return(await ee.post("/evaluation/upload",m,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw o.response?o.response.data:{message:"上传失败"}}},Ee=async m=>{try{const o=await ee.post("/evaluation",{Authorization:m});return{message:o.data.message,status:o.status}}catch(o){throw o.response?o.response.data:{message:"获取评价结果失败"}}},Fe=async(m,o)=>{try{const i=m.split(`
`).map(l=>new ve(l)),k=new ge({sections:[{properties:{},children:i}]}),d=await he.toBlob(k);fe.saveAs(d,`${o}的评测报告.docx`)}catch{throw new Error("生成报告失败")}},se=te("score",()=>{const m=c(null),o=c(!1),i=c(""),k=c([]),d=c(!1),l=c([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),a=c({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),S=y=>{const r=y.target.files;r&&r.length>0&&(m.value=r[0],i.value=r[0].name)},_=async()=>{if(!m.value){E.warning("请选择文件");return}const y=new FormData;y.append("file",m.value);const r=JSON.parse(localStorage.getItem("user")).token;y.append("Authorization",r),console.log(r,y.get("file")),o.value=!0;try{const x=(await Re(y)).message;if(console.log(x),E.success("正在评估，请稍后"),x){const D=async()=>{try{const C=JSON.parse(localStorage.getItem("user")).token,A=await Ee(C),O=A.status;if(console.log("状态码为",O),O===200){const B=A.message,V=JSON.parse('"'+B.replace(/\\\\/g,"\\")+'"');console.log(V),E.success("评估完成，正在生成报告");const z=JSON.parse(localStorage.getItem("user"));return await Fe(V,z.username),console.log("评估完成"),!0}else if(O===204)return console.log("继续轮询"),!1;return console.log("继续轮询"),!1}catch(C){return console.error("轮询评估结果失败",C),console.log("出错继续轮询"),!1}},U=setInterval(async()=>{await D()&&(console.log("停止轮询"),clearInterval(U))},2e3)}else E.error(x||"上传失败")}catch(f){E.error("上传失败"),console.error(f)}finally{o.value=!1}},$=c({}),F=async y=>{const r=R();console.log(r);const f={rating:r,comment:a.value.comment},x=JSON.parse(localStorage.getItem("user")).token;try{const D=await De(x,f,y);console.log(D.message),await N(y)}catch(D){console.error("评价失败",D)}},N=async y=>{try{$.value={};const r=await Ie(y);return console.log("获取到的工具详情:",r),$.value=r,r}catch(r){throw console.error("获取工具详情失败",r),r.response?r.response.data:{message:"请求失败"}}},R=()=>{const y=[.3,.25,.25,.1,.1];let r=0;return l.value.forEach((f,x)=>{r+=f.score*y[x]}),parseFloat(r.toFixed(1))};return{rateStandards:l,rate:a,userFile:m,uploading:o,toolsDetail:$,userFileName:i,reportHistory:k,loadingHistory:d,handleUpload:_,handleUserFileChange:S,ToolsDetailGet:N,evaluationTransmission:F,calculateWeightedAverage:R}}),Ae=te("debounce",()=>{const m=c(!1);return c({}),{isSubmitting:m,debounce:(d,l=500)=>{let a=null;return function(...S){a&&clearTimeout(a),a=window.setTimeout(()=>{d.apply(null,S),a=null},l)}},withSubmitLock:async(d,l=3e3)=>{m.value||(m.value=!0,await d(),setTimeout(()=>{m.value=!1},l))},dailySubmitManager:{checkDailySubmit(d){const l=`dailySubmit_${d}`,a=localStorage.getItem(l);if(a){const S=new Date().toISOString().split("T")[0];return a===S}return!1},recordSubmit(d){const l=`dailySubmit_${d}`,a=new Date().toISOString().split("T")[0];localStorage.setItem(l,a)},getLastSubmitDate(d){const l=`dailySubmit_${d}`;return localStorage.getItem(l)||""}}}}),Oe={class:"main-container"},Ve={class:"main-score-container"},Me={class:"title"},Le={class:"content"},Ue={class:"rating-container"},Be={class:"rating-item"},ze={class:"rating-title"},Je={class:"score-label"},He={class:"criteria-container"},Ge={class:"criteria-list"},Pe={class:"comment"},je={key:0,class:"input-less"},We={class:"submit-wrapper"},Xe={class:"submit-buttons"},Ye={key:0,class:"submit-info"},qe={class:"main-upload-container"},Ke={class:"score-title title"},Qe={class:"score-content-item"},Ze={class:"score-header"},et={class:"score-content-item-title"},tt={class:"user-nickname"},st={class:"score-content-item-score"},ot={key:0,class:"score-content-item-content"},at={key:1,class:"no-comments"},Q=10,nt=500,Z=500,lt=5,ct=L({__name:"score",setup(m){const o=c(0),i=c(0),k=c(!1),d=c(360),l=c(),a=c(),S=c(),_=se(),$=Ae(),F=c({id:""}),N=c(""),R=c(!1),y=["#C6D1DE","#409EFF","#67C23A"],r=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(e){return console.error("解析工具数据失败:",e),{id:""}}},f=(e,s="success")=>{E({message:e,type:s,duration:3e3,showClose:!0})},x=e=>typeof e=="string"?parseInt(e,10):e,D=H(()=>{var e;return!R.value&&!$.isSubmitting&&((e=F.value)==null?void 0:e.id)}),U=H(()=>$.isSubmitting?"提交中...":R.value?"今日已提交":"提交评分"),C=H(()=>[..._.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),A=()=>{_.rateStandards.forEach(e=>{e.score=0}),_.rate.comment="",R.value=!1,N.value=""},O=async()=>{try{await $.withSubmitLock(async()=>{const e=r();if(F.value=e,!e.id)throw new Error("未找到工具ID");const s=x(e.id);await _.evaluationTransmission(s),R.value=!0,N.value=new Date().toISOString().split("T")[0],f("评分提交成功，感谢您的参与！","success")})}catch(e){console.error("提交评分失败:",e),f("提交失败，请稍后重试","error")}},B=e=>{var s;(s=a.value)==null||s.setScrollTop(e)},V=({scrollTop:e})=>{i.value=e},z=e=>`${e} px`,oe=()=>{if(!D.value){f("您今天已经提交过评分，请换个工具尝试或明天再来！","warning");return}if(!("webkitSpeechRecognition"in window)){f("您的浏览器不支持 Web Speech API，请使用 Chrome 浏览器！","warning");return}const e=new window.webkitSpeechRecognition;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("语音识别开始..."),f("请开始说话...","info")},e.onresult=s=>{const v=s.results[0][0].transcript;console.log("识别结果:",v),v.length>Z?(_.rate.comment=v.slice(0,Z),f("评论已超过最大长度限制，已自动截断","warning")):_.rate.comment=v},e.onerror=s=>{console.error("语音识别错误:",s.error),f("语音识别失败，请重试","error")},e.onend=()=>{console.log("语音识别结束"),f("语音识别已完成","success")},e.start()};X(()=>r().id,(e,s)=>{e&&e!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",e),A())},{immediate:!0}),j(async()=>{try{const e=r();if(F.value=e,console.log("当前工具信息:",e),A(),e.id){const s=x(e.id);console.log("开始获取工具详情，工具ID:",s);try{await _.ToolsDetailGet(s),console.log("获取到的工具详情:",_.toolsDetail),console.log("获取到的评分标准:",_.rateStandards)}catch(v){throw console.error("获取工具详情失败:",v),console.error("错误详情:",{message:(v==null?void 0:v.message)||"未知错误",stack:v==null?void 0:v.stack,toolId:s}),v}}await be(),l.value&&(o.value=Math.max(0,l.value.clientHeight-d.value))}catch(e){console.error("初始化失败:",e),console.error("完整错误信息:",{name:(e==null?void 0:e.name)||"未知错误类型",message:(e==null?void 0:e.message)||"未知错误信息",stack:e==null?void 0:e.stack}),f("初始化失败，请刷新页面重试","error")}}),X(()=>{var e;return(e=_.rate.comment)==null?void 0:e.length},e=>{k.value=(e??0)<Q});const ae=$.debounce(O,nt);return(e,s)=>{const v=T("el-icon"),ne=T("el-rate"),le=T("el-popover"),ce=T("el-input"),re=T("el-button"),ie=T("el-avatar"),ue=T("el-scrollbar"),de=T("el-slider");return b(),w("div",Oe,[t("div",Ve,[t("div",Me,[n(v,null,{default:h(()=>[n(p(Se))]),_:1}),s[2]||(s[2]=I("评分模块 "))]),t("div",Le,[t("div",Ue,[(b(!0),w(G,null,P(p(_).rateStandards,(g,me)=>(b(),Y(le,{key:me,width:400,placement:"right",trigger:"hover"},{reference:h(()=>[t("div",Be,[t("span",ze,u(g.name)+"：",1),n(ne,{modelValue:g.score,"onUpdate:modelValue":J=>g.score=J,max:lt,"allow-half":"",colors:y},null,8,["modelValue","onUpdate:modelValue"]),t("span",Je,u(g.score)+" 分",1)])]),default:h(()=>[t("div",He,[s[3]||(s[3]=t("div",{class:"criteria-header"},"评分标准",-1)),t("ul",Ge,[(b(!0),w(G,null,P(g.criteria,(J,_e)=>(b(),w("li",{key:_e},u(J),1))),128))])])]),_:2},1024))),128))]),t("div",Pe,[n(ce,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:p(_).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=g=>p(_).rate.comment=g),disabled:!D.value},null,8,["modelValue","disabled"]),k.value?(b(),w("p",je," 输入的字符数少于"+u(Q)+"个! ")):M("",!0)]),t("div",We,[t("div",Xe,[n(v,{onClick:oe,class:"mic-icon"},{default:h(()=>[n(p(ye))]),_:1}),n(re,{type:"primary",onClick:p(ae),class:"submit-btn",disabled:!D.value,loading:p($).isSubmitting,ref_key:"submitRef",ref:S},{default:h(()=>[I(u(U.value),1)]),_:1},8,["onClick","disabled","loading"])]),N.value?(b(),w("div",Ye," 上次提交日期: "+u(N.value),1)):M("",!0)])])]),t("div",qe,[t("div",Ke,[n(v,null,{default:h(()=>[n(p(q))]),_:1}),s[4]||(s[4]=I("用户评价 "))]),n(ue,{class:"tool-details",always:"",onScroll:V,ref_key:"scrollbarRef",ref:a,height:`${d.value}px`},{default:h(()=>[t("div",{ref_key:"innerRef",ref:l},[C.value&&C.value.length>0?(b(!0),w(G,{key:0},P(C.value,g=>we((b(),w("div",{class:"score-content",key:g.id},[t("div",Qe,[t("div",Ze,[t("div",et,[n(ie,{size:24,class:"user-avatar"},{default:h(()=>[I(u(g.user.charAt(0)),1)]),_:2},1024),t("span",tt,"@"+u(g.user||"未设置昵称用户"),1)]),t("div",st,[s[5]||(s[5]=t("span",null,"评分：",-1)),I(u(g.rating)+" ⭐ ",1)])]),g.comment?(b(),w("div",ot,u(g.comment),1)):M("",!0)])])),[[ke,g.comment&&g.comment.trim()]])),128)):(b(),w("div",at,[n(v,{class:"icon"},{default:h(()=>[n(p(q))]),_:1}),s[6]||(s[6]=t("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=t("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),o.value>0&&C.value&&C.value.length>0?(b(),Y(de,{key:0,modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=g=>i.value=g),max:o.value,"format-tooltip":z,onInput:B},null,8,["modelValue","max"])):M("",!0)])])}}}),rt=W(ct,[["__scopeId","data-v-fe64a419"]]),it={class:"upload-container"},ut={class:"header"},dt={class:"content"},mt={class:"description"},_t={class:"upload-section"},pt={class:"file-input"},vt={class:"file-name"},gt={class:"file-hint"},ht=L({__name:"upload",setup(m){const o=se(),i=c("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),k=c([".docx",".doc"]),d=c("点击或拖拽文件到此处上传");return(l,a)=>{const S=T("el-icon"),_=T("el-button");return b(),w("div",it,[t("div",ut,[n(S,null,{default:h(()=>[n(p(K))]),_:1}),a[1]||(a[1]=t("span",null,"提交评价报告",-1))]),t("div",dt,[t("div",mt,u(i.value),1),t("div",_t,[t("div",pt,[t("div",{class:$e(["input-wrapper",{"has-file":p(o).userFileName}])},[n(S,{class:"upload-icon"},{default:h(()=>[n(p(Te))]),_:1}),t("input",{type:"file",accept:".docx",onChange:a[0]||(a[0]=$=>p(o).handleUserFileChange($))},null,32),t("span",vt,u(p(o).userFileName||d.value),1),t("span",gt," 支持 "+u(k.value.join(", "))+" 格式 ",1)],2)]),n(_,{type:"primary",onClick:p(o).handleUpload,loading:p(o).uploading,class:"upload-btn"},{default:h(()=>[n(S,null,{default:h(()=>[n(p(K))]),_:1}),I(" "+u(p(o).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])])}}}),ft=W(ht,[["__scopeId","data-v-5e41dcac"]]),bt={class:"container"},St={class:"main-info"},yt={class:"info"},wt={class:"header-section"},kt={class:"name"},$t={class:"score-badge"},Tt={class:"score-value"},xt={class:"description"},Ct={class:"tag-section"},Dt={class:"tag-list"},It={class:"tag-item primary"},Nt={class:"action-section"},Rt={class:"logo-container"},Et={class:"logo-wrapper"},Ft=["src","alt"],At={class:"content-sections"},Ot={class:"score-section"},Vt={class:"upload-section"},Mt=L({__name:"index",setup(m){const o=c("全部工具"),i=c({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),k=Ce(),d=l=>{window.open(l,"_blank","noopener,noreferrer")};return j(()=>{setTimeout(()=>{try{const l=localStorage.getItem("selectedTool");if(l){const a=JSON.parse(l);k.selectedTool=a,i.value=a}}catch(l){console.error("解析工具数据失败:",l)}},100)}),(l,a)=>{const S=T("el-breadcrumb-item"),_=T("el-breadcrumb");return b(),w("div",bt,[n(_,{"separator-icon":p(xe),class:"breadcrumb"},{default:h(()=>[n(S,{to:{path:"/home"}},{default:h(()=>[I(u(o.value),1)]),_:1}),n(S,null,{default:h(()=>[I(u(i.value.category),1)]),_:1}),n(S,null,{default:h(()=>[I(u(i.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),t("div",St,[t("div",yt,[t("div",wt,[t("div",kt,u(i.value.name),1),t("div",$t,[t("span",Tt,u(i.value.score),1),a[1]||(a[1]=t("span",{class:"score-stars"},"⭐",-1))])]),t("div",xt,u(i.value.description),1),t("div",Ct,[t("div",Dt,[t("span",It,u(i.value.category),1),a[2]||(a[2]=t("span",{class:"tag-item secondary"},"AI工具",-1))])]),t("div",Nt,[t("button",{class:"url-button",onClick:a[0]||(a[0]=$=>d(i.value.url))},a[3]||(a[3]=[t("span",{class:"button-text"},"访问官网",-1),t("span",{class:"button-icon"},"→",-1)]))])]),t("div",Rt,[t("div",Et,[t("img",{src:i.value.logo_url,alt:i.value.name},null,8,Ft)])])]),t("div",At,[t("div",Ot,[n(rt)]),t("div",Vt,[n(ft)])])])}}}),Lt=W(Mt,[["__scopeId","data-v-42a55656"]]),Ut={key:0},Bt={key:1},zt={class:"top-nav"},Jt={class:"detail-main"},Yt=L({__name:"detailPage",setup(m){const o=c(!0);return j(()=>{setTimeout(()=>{o.value=!1},500)}),(i,k)=>o.value?(b(),w("div",Ut,[n(Ne)])):(b(),w("div",Bt,[t("nav",zt,[n(pe)]),t("div",Jt,[n(Lt)])]))}});export{Yt as default};
