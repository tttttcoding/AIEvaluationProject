import{T as pe}from"./index-0CyBte5T.js";import{s as se,ab as ge,ac as ve,ad as he,ae as fe,d as oe,r as i,E as R,b as H,A as P,w as Y,e as X,a6 as be,c as k,a as t,f as l,k as N,h as T,g as f,F as j,N as W,i as g,m as B,t as d,B as Z,af as Se,ag as ye,ah as q,n as we,O as ke,o as S,_ as K,x as $e,ai as Q,aj as Te,ak as xe}from"./index-DU-Sq44Q.js";import{u as Ce}from"./useSelectedToolStore-CbLG9HR9.js";import{u as Ie,b as De}from"./ToolsService-dFMA0NzI.js";import{L as Ne}from"./loading-BnmZL4ro.js";import"./github.vue_vue_type_style_index_0_scoped_c5cc798f_lang-CAulx1qC.js";const Ee=async(_,a)=>{try{return(await se.post(`/evaluation/upload/${a}`,_,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(c){throw c.response?c.response.data:{message:"上传失败"}}},Fe=async _=>{try{const a=await se.post("/evaluation",{Authorization:_});return{message:a.data.message,status:a.status}}catch(a){throw a.response?a.response.data:{message:"获取评价结果失败"}}},Re=async(_,a)=>{try{const c=_.split(`
`).map(r=>new ge(r)),$=new ve({sections:[{properties:{},children:c}]}),m=await he.toBlob($);fe.saveAs(m,`${a}的评测报告.docx`)}catch{throw new Error("生成报告失败")}},ae=oe("score",()=>{const _=i(null),a=i(!1),c=i(""),$=i([]),m=i(!1),r=i([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),o=i({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),y=u=>{const n=u.target.files;n&&n.length>0&&(_.value=n[0],c.value=n[0].name)},p=1*1024*1024;function I(u){const n=[];let b=0;for(;b<u.size;){const w=Math.min(b+p,u.size);n.push(u.slice(b,w)),b=w}return n}const O=async()=>{if(!_.value){R.warning("请选择文件");return}const u=JSON.parse(localStorage.getItem("user")).token;a.value=!0;try{let n=null,b=null;const w=I(_.value),x=w.length;for(let C=0;C<w.length;C++){const F=new FormData;F.append("Authorization",u),F.append("chunk",w[C]),F.append("fileSum",String(x)),n=await Ee(F,C+1);const D=n.message;console.log(D),C===w.length-1?(R.success("上传完成，正在评估，请稍后"),b=D):R.info(`第 ${C+1} / ${w.length} 片上传成功`)}if(b){const C=async()=>{try{const D=JSON.parse(localStorage.getItem("user")).token,U=await Fe(D),V=U.status;if(console.log("状态码为",V),V===200){const J=U.message,z=JSON.parse('"'+J.replace(/\\\\/g,"\\")+'"');console.log(z),R.success("评估完成，正在生成报告");const e=JSON.parse(localStorage.getItem("user"));return await Re(z,e.username),console.log("评估完成"),!0}else if(V===204)return console.log("继续轮询"),!1;return console.log("继续轮询"),!1}catch(D){return console.error("轮询评估结果失败",D),console.log("出错继续轮询"),!1}},F=setInterval(async()=>{await C()&&(console.log("停止轮询"),clearInterval(F))},2e3)}else R.error(b||"上传失败")}catch(n){R.error("上传失败"),console.error(n)}finally{a.value=!1}},E=i({}),A=async u=>{const n=M();console.log(n);const b={rating:n,comment:o.value.comment},w=JSON.parse(localStorage.getItem("user")).token;try{const x=await Ie(w,b,u);console.log(x.message),await L(u)}catch(x){console.error("评价失败",x)}},L=async u=>{try{E.value={};const n=await De(u);return console.log("获取到的工具详情:",n),E.value=n,n}catch(n){throw console.error("获取工具详情失败",n),n.response?n.response.data:{message:"请求失败"}}},M=()=>{const u=[.3,.25,.25,.1,.1];let n=0;return r.value.forEach((b,w)=>{n+=b.score*u[w]}),parseFloat(n.toFixed(1))};return{rateStandards:r,rate:o,userFile:_,uploading:a,toolsDetail:E,userFileName:c,reportHistory:$,loadingHistory:m,handleUpload:O,handleUserFileChange:y,ToolsDetailGet:L,evaluationTransmission:A,calculateWeightedAverage:M}}),Ae=oe("debounce",()=>{const _=i(!1);return i({}),{isSubmitting:_,debounce:(m,r=500)=>{let o=null;return function(...y){o&&clearTimeout(o),o=window.setTimeout(()=>{m.apply(null,y),o=null},r)}},withSubmitLock:async(m,r=3e3)=>{_.value||(_.value=!0,await m(),setTimeout(()=>{_.value=!1},r))},dailySubmitManager:{checkDailySubmit(m){const r=`dailySubmit_${m}`,o=localStorage.getItem(r);if(o){const y=new Date().toISOString().split("T")[0];return o===y}return!1},recordSubmit(m){const r=`dailySubmit_${m}`,o=new Date().toISOString().split("T")[0];localStorage.setItem(r,o)},getLastSubmitDate(m){const r=`dailySubmit_${m}`;return localStorage.getItem(r)||""}}}}),Me={class:"main-container"},Oe={class:"main-score-container"},Ve={class:"title"},Le={class:"content"},Ue={class:"rating-container"},ze={class:"rating-item"},Be={class:"rating-title"},He={class:"score-label"},Je={class:"criteria-container"},Ge={class:"criteria-list"},Pe={class:"comment"},je={key:0,class:"input-less"},We={class:"submit-wrapper"},Xe={class:"submit-buttons"},Ke={key:0,class:"submit-info"},Ye={class:"main-upload-container"},Ze={class:"score-title title"},qe={class:"score-content-item"},Qe={class:"score-header"},et={class:"score-content-item-title"},tt={class:"user-nickname"},st={class:"score-content-item-score"},ot={key:0,class:"score-content-item-content"},at={key:1,class:"no-comments"},ee=10,nt=500,te=500,lt=5,ct=H({__name:"score",setup(_){const a=i(0),c=i(0),$=i(!1),m=i(360),r=i(),o=i(),y=i(),p=ae(),I=Ae(),O=i({id:""}),E=i(""),A=i(!1),L=["#C6D1DE","#409EFF","#67C23A"],M=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(e){return console.error("解析工具数据失败:",e),{id:""}}},u=(e,s="success")=>{R({message:e,type:s,duration:3e3,showClose:!0})},n=e=>typeof e=="string"?parseInt(e,10):e,b=P(()=>{var e;return!A.value&&!I.isSubmitting&&((e=O.value)==null?void 0:e.id)}),w=P(()=>I.isSubmitting?"提交中...":A.value?"今日已提交":"提交评分"),x=P(()=>[...p.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),C=()=>{p.rateStandards.forEach(e=>{e.score=0}),p.rate.comment="",A.value=!1,E.value=""},F=async()=>{try{await I.withSubmitLock(async()=>{const e=M();if(O.value=e,!e.id)throw new Error("未找到工具ID");const s=n(e.id);await p.evaluationTransmission(s),A.value=!0,E.value=new Date().toISOString().split("T")[0],u("评分提交成功，感谢您的参与！","success")})}catch(e){console.error("提交评分失败:",e),u("提交失败，请稍后重试","error")}},D=e=>{var s;(s=o.value)==null||s.setScrollTop(e)},U=({scrollTop:e})=>{c.value=e},V=e=>`${e} px`,J=()=>{if(!b.value){u("您今天已经提交过评分，请换个工具尝试或明天再来！","warning");return}if(!("webkitSpeechRecognition"in window)){u("您的浏览器不支持 Web Speech API，请使用 Chrome 浏览器！","warning");return}const e=new window.webkitSpeechRecognition;e.lang="zh-CN",e.continuous=!1,e.interimResults=!1,e.onstart=()=>{console.log("语音识别开始..."),u("请开始说话...","info")},e.onresult=s=>{const v=s.results[0][0].transcript;console.log("识别结果:",v),v.length>te?(p.rate.comment=v.slice(0,te),u("评论已超过最大长度限制，已自动截断","warning")):p.rate.comment=v},e.onerror=s=>{console.error("语音识别错误:",s.error),u("语音识别失败，请重试","error")},e.onend=()=>{console.log("语音识别结束"),u("语音识别已完成","success")},e.start()};Y(()=>M().id,(e,s)=>{e&&e!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",e),C())},{immediate:!0}),X(async()=>{try{const e=M();if(O.value=e,console.log("当前工具信息:",e),C(),e.id){const s=n(e.id);console.log("开始获取工具详情，工具ID:",s);try{await p.ToolsDetailGet(s),console.log("获取到的工具详情:",p.toolsDetail),console.log("获取到的评分标准:",p.rateStandards)}catch(v){throw console.error("获取工具详情失败:",v),console.error("错误详情:",{message:(v==null?void 0:v.message)||"未知错误",stack:v==null?void 0:v.stack,toolId:s}),v}}await be(),r.value&&(a.value=Math.max(0,r.value.clientHeight-m.value))}catch(e){console.error("初始化失败:",e),console.error("完整错误信息:",{name:(e==null?void 0:e.name)||"未知错误类型",message:(e==null?void 0:e.message)||"未知错误信息",stack:e==null?void 0:e.stack}),u("初始化失败，请刷新页面重试","error")}}),Y(()=>{var e;return(e=p.rate.comment)==null?void 0:e.length},e=>{$.value=(e??0)<ee});const z=I.debounce(F,nt);return(e,s)=>{const v=T("el-icon"),ne=T("el-rate"),le=T("el-popover"),ce=T("el-input"),re=T("el-button"),ie=T("el-avatar"),ue=T("el-scrollbar"),de=T("el-slider");return S(),k("div",Me,[t("div",Oe,[t("div",Ve,[l(v,null,{default:f(()=>[l(g(Se))]),_:1}),s[2]||(s[2]=N("评分模块 "))]),t("div",Le,[t("div",Ue,[(S(!0),k(j,null,W(g(p).rateStandards,(h,me)=>(S(),Z(le,{key:me,width:400,placement:"right",trigger:"hover"},{reference:f(()=>[t("div",ze,[t("span",Be,d(h.name)+"：",1),l(ne,{modelValue:h.score,"onUpdate:modelValue":G=>h.score=G,max:lt,"allow-half":"",colors:L},null,8,["modelValue","onUpdate:modelValue"]),t("span",He,d(h.score)+" 分",1)])]),default:f(()=>[t("div",Je,[s[3]||(s[3]=t("div",{class:"criteria-header"},"评分标准",-1)),t("ul",Ge,[(S(!0),k(j,null,W(h.criteria,(G,_e)=>(S(),k("li",{key:_e},d(G),1))),128))])])]),_:2},1024))),128))]),t("div",Pe,[l(ce,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:g(p).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=h=>g(p).rate.comment=h),disabled:!b.value},null,8,["modelValue","disabled"]),$.value?(S(),k("p",je," 输入的字符数少于"+d(ee)+"个! ")):B("",!0)]),t("div",We,[t("div",Xe,[l(v,{onClick:J,class:"mic-icon"},{default:f(()=>[l(g(ye))]),_:1}),l(re,{type:"primary",onClick:g(z),class:"submit-btn",disabled:!b.value,loading:g(I).isSubmitting,ref_key:"submitRef",ref:y},{default:f(()=>[N(d(w.value),1)]),_:1},8,["onClick","disabled","loading"])]),E.value?(S(),k("div",Ke," 上次提交日期: "+d(E.value),1)):B("",!0)])])]),t("div",Ye,[t("div",Ze,[l(v,null,{default:f(()=>[l(g(q))]),_:1}),s[4]||(s[4]=N("用户评价 "))]),l(ue,{class:"tool-details",always:"",onScroll:U,ref_key:"scrollbarRef",ref:o,height:`${m.value}px`},{default:f(()=>[t("div",{ref_key:"innerRef",ref:r},[x.value&&x.value.length>0?(S(!0),k(j,{key:0},W(x.value,h=>we((S(),k("div",{class:"score-content",key:h.id},[t("div",qe,[t("div",Qe,[t("div",et,[l(ie,{size:24,class:"user-avatar"},{default:f(()=>[N(d(h.user.charAt(0)),1)]),_:2},1024),t("span",tt,"@"+d(h.user||"未设置昵称用户"),1)]),t("div",st,[s[5]||(s[5]=t("span",null,"评分：",-1)),N(d(h.rating)+" ⭐ ",1)])]),h.comment?(S(),k("div",ot,d(h.comment),1)):B("",!0)])])),[[ke,h.comment&&h.comment.trim()]])),128)):(S(),k("div",at,[l(v,{class:"icon"},{default:f(()=>[l(g(q))]),_:1}),s[6]||(s[6]=t("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=t("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),a.value>0&&x.value&&x.value.length>0?(S(),Z(de,{key:0,modelValue:c.value,"onUpdate:modelValue":s[1]||(s[1]=h=>c.value=h),max:a.value,"format-tooltip":V,onInput:D},null,8,["modelValue","max"])):B("",!0)])])}}}),rt=K(ct,[["__scopeId","data-v-fe64a419"]]),it={class:"upload-container"},ut={class:"header"},dt={class:"content"},mt={class:"description"},_t={class:"upload-section"},pt={class:"file-input"},gt={class:"file-name"},vt={class:"file-hint"},ht=H({__name:"upload",setup(_){const a=ae(),c=i("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),$=i([".docx",".doc"]),m=i("点击或拖拽文件到此处上传");return(r,o)=>{const y=T("el-icon"),p=T("el-button");return S(),k("div",it,[t("div",ut,[l(y,null,{default:f(()=>[l(g(Q))]),_:1}),o[1]||(o[1]=t("span",null,"提交评价报告",-1))]),t("div",dt,[t("div",mt,d(c.value),1),t("div",_t,[t("div",pt,[t("div",{class:$e(["input-wrapper",{"has-file":g(a).userFileName}])},[l(y,{class:"upload-icon"},{default:f(()=>[l(g(Te))]),_:1}),t("input",{type:"file",accept:".docx",onChange:o[0]||(o[0]=I=>g(a).handleUserFileChange(I))},null,32),t("span",gt,d(g(a).userFileName||m.value),1),t("span",vt," 支持 "+d($.value.join(", "))+" 格式 ",1)],2)]),l(p,{type:"primary",onClick:g(a).handleUpload,loading:g(a).uploading,class:"upload-btn"},{default:f(()=>[l(y,null,{default:f(()=>[l(g(Q))]),_:1}),N(" "+d(g(a).uploading?"上传中...":"开始上传"),1)]),_:1},8,["onClick","loading"])])])])}}}),ft=K(ht,[["__scopeId","data-v-5e41dcac"]]),bt={class:"container"},St={class:"main-info"},yt={class:"info"},wt={class:"header-section"},kt={class:"name"},$t={class:"score-badge"},Tt={class:"score-value"},xt={class:"description"},Ct={class:"tag-section"},It={class:"tag-list"},Dt={class:"tag-item primary"},Nt={class:"action-section"},Et={class:"logo-container"},Ft={class:"logo-wrapper"},Rt=["src","alt"],At={class:"content-sections"},Mt={class:"score-section"},Ot={class:"upload-section"},Vt=H({__name:"index",setup(_){const a=i("全部工具"),c=i({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),$=Ce(),m=r=>{window.open(r,"_blank","noopener,noreferrer")};return X(()=>{setTimeout(()=>{try{const r=localStorage.getItem("selectedTool");if(r){const o=JSON.parse(r);$.selectedTool=o,c.value=o}}catch(r){console.error("解析工具数据失败:",r)}},100)}),(r,o)=>{const y=T("el-breadcrumb-item"),p=T("el-breadcrumb");return S(),k("div",bt,[l(p,{"separator-icon":g(xe),class:"breadcrumb"},{default:f(()=>[l(y,{to:{path:"/home"}},{default:f(()=>[N(d(a.value),1)]),_:1}),l(y,null,{default:f(()=>[N(d(c.value.category),1)]),_:1}),l(y,null,{default:f(()=>[N(d(c.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),t("div",St,[t("div",yt,[t("div",wt,[t("div",kt,d(c.value.name),1),t("div",$t,[t("span",Tt,d(c.value.score),1),o[1]||(o[1]=t("span",{class:"score-stars"},"⭐",-1))])]),t("div",xt,d(c.value.description),1),t("div",Ct,[t("div",It,[t("span",Dt,d(c.value.category),1),o[2]||(o[2]=t("span",{class:"tag-item secondary"},"AI工具",-1))])]),t("div",Nt,[t("button",{class:"url-button",onClick:o[0]||(o[0]=I=>m(c.value.url))},o[3]||(o[3]=[t("span",{class:"button-text"},"访问官网",-1),t("span",{class:"button-icon"},"→",-1)]))])]),t("div",Et,[t("div",Ft,[t("img",{src:c.value.logo_url,alt:c.value.name},null,8,Rt)])])]),t("div",At,[t("div",Mt,[l(rt)]),t("div",Ot,[l(ft)])])])}}}),Lt=K(Vt,[["__scopeId","data-v-42a55656"]]),Ut={key:0},zt={key:1},Bt={class:"top-nav"},Ht={class:"detail-main"},Kt=H({__name:"detailPage",setup(_){const a=i(!0);return X(()=>{setTimeout(()=>{a.value=!1},500)}),(c,$)=>a.value?(S(),k("div",Ut,[l(Ne)])):(S(),k("div",zt,[t("nav",Bt,[l(pe)]),t("div",Ht,[l(Lt)])]))}});export{Kt as default};
