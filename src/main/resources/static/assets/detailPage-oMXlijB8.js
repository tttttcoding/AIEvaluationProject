import{T as _e}from"./index-C7pO-ZVK.js";import{d as me,r,i as D,c as V,v as B,j as E,E as M,ad as pe,e as f,f as e,k as a,p as S,m as b,w as v,n as A,q as F,l as _,B as I,t as l,A as J,ae as ve,af as G,C as he,U as fe,o as m,_ as U,H as Y,ag as q,ah as ge,ai as be,aj as O,ak as Se}from"./index-UgPJK38L.js";import{u as ye}from"./useSelectedToolStore-CXQOxsBL.js";import{u as P}from"./useScoreStore-E7dG5ViA.js";import{L as ke}from"./loading-CUvVoVHE.js";import"./theme-BJetcWNL.js";import"./ToolsService-r0m5FawN.js";const we=me("debounce",()=>{const y=r(!1);return r({}),{isSubmitting:y,debounce:(p,o=500)=>{let n=null;return function(...g){n&&clearTimeout(n),n=window.setTimeout(()=>{p.apply(null,g),n=null},o)}},withSubmitLock:async(p,o=3e3)=>{y.value||(y.value=!0,await p(),setTimeout(()=>{y.value=!1},o))},dailySubmitManager:{checkDailySubmit(p){const o=`dailySubmit_${p}`,n=localStorage.getItem(o);if(n){const g=new Date().toISOString().split("T")[0];return n===g}return!1},recordSubmit(p){const o=`dailySubmit_${p}`,n=new Date().toISOString().split("T")[0];localStorage.setItem(o,n)},getLastSubmitDate(p){const o=`dailySubmit_${p}`;return localStorage.getItem(o)||""}}}}),Te={class:"main-container"},$e={class:"main-score-container"},xe={class:"title"},Ce={class:"content"},Ie={class:"rating-container"},De={class:"rating-item"},Ee={class:"rating-title"},Ne={class:"score-label"},Le={class:"criteria-container"},Re={class:"criteria-list"},Ve={class:"comment"},Me={key:0,class:"input-less"},Ae={class:"submit-wrapper"},Fe={class:"submit-buttons"},Oe={key:0,class:"submit-info"},Be={class:"main-upload-container"},Ue={class:"score-title title"},He={class:"score-content-item"},ze={class:"score-header"},je={class:"score-content-item-title"},Je={class:"user-nickname"},Ge={class:"user-nickname"},Ye={class:"user-nickname"},qe={class:"score-content-item-score"},Ke={key:0,class:"score-content-item-content"},Pe={key:1,class:"no-comments"},K=10,We=500,Xe=5,Qe=D({__name:"score",setup(y){const i=r(0),d=r(0),k=r(!1),p=r(360),o=r(),n=r(),g=r(),u=P(),h=we(),w=r({id:""}),T=r(""),$=r(!1),W=["#C6D1DE","#409EFF","#67C23A"],N=()=>{try{return JSON.parse(localStorage.getItem("selectedTool")||'{"id": ""}')}catch(t){return console.error("解析工具数据失败:",t),{id:""}}},L=(t,s="success")=>{M({message:t,type:s,duration:3e3,showClose:!0})},H=t=>typeof t=="string"?parseInt(t,10):t,z=V(()=>{var t;return!$.value&&!h.isSubmitting&&((t=w.value)==null?void 0:t.id)}),X=V(()=>h.isSubmitting?"提交中...":$.value?"今日已提交":"提交评分"),C=V(()=>[...u.toolsDetail.rates||[]].reverse().filter(s=>s.comment&&s.comment.trim()!=="")),j=()=>{u.rateStandards.forEach(t=>{t.score=0}),u.rate.comment="",$.value=!1,T.value=""},Q=async()=>{try{await h.withSubmitLock(async()=>{const t=N();if(w.value=t,!t.id)throw new Error("未找到工具ID");const s=H(t.id);await u.evaluationTransmission(s),$.value=!0,T.value=new Date().toISOString().split("T")[0],L("评分提交成功，感谢您的参与！","success")})}catch(t){console.error("提交评分失败:",t),L("提交失败，请稍后重试","error")}},Z=t=>{var s;(s=n.value)==null||s.setScrollTop(t)},ee=({scrollTop:t})=>{d.value=t},te=t=>`${t} px`;B(()=>N().id,(t,s)=>{t&&t!==s&&(console.log("工具ID变化，重置评分状态:",s,"->",t),j())},{immediate:!0}),E(async()=>{try{const t=N();if(w.value=t,j(),t.id){const s=H(t.id);try{await u.ToolsDetailGet(s)}catch(x){throw M.error("获取工具详情失败:",x),x}}await pe(),o.value&&(i.value=Math.max(0,o.value.clientHeight-p.value))}catch(t){M.error("初始化失败:",t),L("初始化失败，请刷新页面重试","error")}}),B(()=>{var t;return(t=u.rate.comment)==null?void 0:t.length},t=>{k.value=(t??0)<K});const se=h.debounce(Q,We);return(t,s)=>{const x=b("el-icon"),oe=b("el-rate"),ae=b("el-popover"),ne=b("el-input"),le=b("el-button"),ie=b("el-avatar"),ce=b("el-scrollbar"),re=b("el-slider");return m(),f("div",Te,[e("div",$e,[e("div",xe,[a(x,null,{default:v(()=>[a(_(ve))]),_:1}),s[2]||(s[2]=S("评分模块 "))]),e("div",Ce,[e("div",Ie,[(m(!0),f(A,null,F(_(u).rateStandards,(c,de)=>(m(),J(ae,{key:de,width:400,placement:"right",trigger:"hover"},{reference:v(()=>[e("div",De,[e("span",Ee,l(c.name)+"：",1),a(oe,{modelValue:c.score,"onUpdate:modelValue":R=>c.score=R,max:Xe,"allow-half":"",colors:W},null,8,["modelValue","onUpdate:modelValue"]),e("span",Ne,l(c.score)+" 分",1)])]),default:v(()=>[e("div",Le,[s[3]||(s[3]=e("div",{class:"criteria-header"},"评分标准",-1)),e("ul",Re,[(m(!0),f(A,null,F(c.criteria,(R,ue)=>(m(),f("li",{key:ue},l(R),1))),128))])])]),_:2},1024))),128))]),e("div",Ve,[a(ne,{type:"textarea",placeholder:"留下您的宝贵评价，帮助其他用户了解此工具 （每个工具每日仅限一次评价）",class:"comment-input",autosize:{minRows:3,maxRows:6},maxlength:"500",modelValue:_(u).rate.comment,"onUpdate:modelValue":s[0]||(s[0]=c=>_(u).rate.comment=c),disabled:!z.value},null,8,["modelValue","disabled"]),k.value?(m(),f("p",Me," 输入的字符数少于"+l(K)+"个! ")):I("",!0)]),e("div",Ae,[e("div",Fe,[a(le,{type:"primary",onClick:_(se),class:"submit-btn",disabled:!z.value,loading:_(h).isSubmitting,ref_key:"submitRef",ref:g},{default:v(()=>[S(l(X.value),1)]),_:1},8,["onClick","disabled","loading"])]),T.value?(m(),f("div",Oe," 上次提交日期: "+l(T.value),1)):I("",!0)])])]),e("div",Be,[e("div",Ue,[a(x,null,{default:v(()=>[a(_(G))]),_:1}),s[4]||(s[4]=S("用户评价 "))]),a(ce,{class:"tool-details",always:"",onScroll:ee,ref_key:"scrollbarRef",ref:n,height:`${p.value}px`},{default:v(()=>[e("div",{ref_key:"innerRef",ref:o},[C.value&&C.value.length>0?(m(!0),f(A,{key:0},F(C.value,c=>he((m(),f("div",{class:"score-content",key:c.id},[e("div",He,[e("div",ze,[e("div",je,[a(ie,{size:24,class:"user-avatar"},{default:v(()=>[S(l(c.user.charAt(0)),1)]),_:2},1024),e("span",Je,"@"+l(c.user||"未设置昵称用户"),1),e("span",Ge,l(c.cno||"-"),1),e("span",Ye,"   "+l(c.rate_time.replace("T"," ")||"-"),1)]),e("div",qe,[s[5]||(s[5]=e("span",null,"评分：",-1)),S(l(c.rating)+" ⭐ ",1)])]),c.comment?(m(),f("div",Ke,l(c.comment),1)):I("",!0)])])),[[fe,c.comment&&c.comment.trim()]])),128)):(m(),f("div",Pe,[a(x,{class:"icon"},{default:v(()=>[a(_(G))]),_:1}),s[6]||(s[6]=e("div",{class:"message"},"暂无用户评价",-1)),s[7]||(s[7]=e("div",{class:"sub-message"},"成为第一个评价此工具的用户吧",-1))]))],512)]),_:1},8,["height"]),i.value>0&&C.value&&C.value.length>0?(m(),J(re,{key:0,modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=c=>d.value=c),max:i.value,"format-tooltip":te,onInput:Z},null,8,["modelValue","max"])):I("",!0)])])}}}),Ze=U(Qe,[["__scopeId","data-v-04026a2f"]]),et={class:"upload-container"},tt={class:"header"},st={class:"content"},ot={class:"description"},at={class:"upload-section"},nt={key:0,class:"upload-warning"},lt={class:"file-name"},it={class:"file-hint"},ct=D({__name:"upload",setup(y){const i=P(),d=r("在这里，你可以提交关于该AI工具的详细评价报告，请确保您的报告包含完整的使用体验，建议根据评分模块的类目分别进行评价。"),k=r([".docx",".doc"]),p=r("点击或拖拽文件到此处上传"),o=r(!1),n=u=>{const h=[25,26,60,61,98,99,138,139,157,158];o.value=h.includes(u)};E(()=>{let u=JSON.parse(localStorage.getItem("selectedTool")||"{}").id;n(Number(u))});const g=r(null);return B(()=>i.uploading,u=>{u?g.value=be({title:"文件上传进度",message:O("div",{class:"upload-progress-notification"},[O("el-progress",{percentage:i.progress,status:i.progress===100?"success":"",strokeWidth:8}),O("p",{class:"progress-text"},i.progress<100?`正在上传文件: ${i.progress}%`:"等待结果返回，请稍后...")]),duration:0,position:"bottom-right",showClose:!1}):g.value&&g.value.close()}),(u,h)=>{const w=b("el-icon"),T=b("el-button");return m(),f("div",et,[e("div",tt,[a(w,null,{default:v(()=>[a(_(q))]),_:1}),h[1]||(h[1]=e("span",null,"提交评价报告",-1))]),e("div",st,[e("div",ot,l(d.value),1),e("div",at,[o.value?I("",!0):(m(),f("div",nt,h[2]||(h[2]=[S(" 当前工具不在开放作业上传的工具列表中，请使用以下工具："),e("a",{href:"https://a1.x914.com/alight/i/2025/06/06/41le.png",target:"_blank"},"查看开放工具列表",-1)]))),e("div",{class:Y(["file-input",{disabled:!o.value}])},[e("div",{class:Y(["input-wrapper",{"has-file":_(i).userFileName}])},[a(w,{class:"upload-icon"},{default:v(()=>[a(_(ge))]),_:1}),e("input",{type:"file",accept:".docx",onChange:h[0]||(h[0]=$=>_(i).handleUserFileChange($))},null,32),e("span",lt,l(_(i).userFileName||p.value),1),e("span",it," 支持 "+l(k.value.join(", "))+" 格式, 单个文件上限为2MB ",1)],2)],2),a(T,{type:"primary",onClick:_(i).handleUpload,loading:_(i).uploading,disabled:!o.value,class:"upload-btn"},{default:v(()=>[a(w,null,{default:v(()=>[a(_(q))]),_:1}),S(" "+l(o.value?_(i).uploading?"上传中...":"开始上传":"当前工具不开放上传作业"),1)]),_:1},8,["onClick","loading","disabled"])])])])}}}),rt=U(ct,[["__scopeId","data-v-6764725f"]]),dt={class:"container"},ut={class:"main-info"},_t={class:"info"},mt={class:"header-section"},pt={class:"name"},vt={class:"score-badge"},ht={class:"score-value"},ft={class:"description"},gt={class:"tag-section"},bt={class:"tag-list"},St={class:"tag-item primary"},yt={class:"action-section"},kt={class:"logo-container"},wt={class:"logo-wrapper"},Tt=["src","alt"],$t={class:"content-sections"},xt={class:"score-section"},Ct={class:"upload-section"},It=D({__name:"index",setup(y){const i=r("全部工具"),d=r({id:"",name:"",category:"",description:"",score:0,url:"",logo_url:""}),k=ye(),p=o=>{window.open(o,"_blank","noopener,noreferrer")};return E(()=>{setTimeout(()=>{try{const o=localStorage.getItem("selectedTool");if(o){const n=JSON.parse(o);k.selectedTool=n,d.value=n}}catch(o){console.error("解析工具数据失败:",o)}},100)}),(o,n)=>{const g=b("el-breadcrumb-item"),u=b("el-breadcrumb");return m(),f("div",dt,[a(u,{"separator-icon":_(Se),class:"breadcrumb"},{default:v(()=>[a(g,{to:{path:"/home"}},{default:v(()=>[S(l(i.value),1)]),_:1}),a(g,null,{default:v(()=>[S(l(d.value.category),1)]),_:1}),a(g,null,{default:v(()=>[S(l(d.value.name),1)]),_:1})]),_:1},8,["separator-icon"]),e("div",ut,[e("div",_t,[e("div",mt,[e("div",pt,l(d.value.name),1),e("div",vt,[e("span",ht,l(d.value.score),1),n[1]||(n[1]=e("span",{class:"score-stars"},[e("svg",{class:"icon",viewBox:"0 0 1300 720",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"29",height:"29"},[e("path",{d:"M512.009505 25.054894l158.199417 320.580987 353.791078 51.421464L767.995248 646.579761l60.432101 352.365345-316.417844-166.354615-316.436854 166.354615 60.432101-352.365345L0 397.057345l353.791078-51.421464z",fill:"#EFCE4A","p-id":"2289","data-spm-anchor-id":"a313x.search_index.0.i1.672b3a81KYHDAp",class:"selected"})])],-1))])]),e("div",ft,l(d.value.description),1),e("div",gt,[e("div",bt,[e("span",St,l(d.value.category),1),n[2]||(n[2]=e("span",{class:"tag-item secondary"},"AI工具",-1))])]),e("div",yt,[e("button",{class:"url-button",onClick:n[0]||(n[0]=h=>p(d.value.url))},n[3]||(n[3]=[e("span",{class:"button-text"},"访问官网",-1),e("span",{class:"button-icon"},"→",-1)]))])]),e("div",kt,[e("div",wt,[e("img",{src:d.value.logo_url,alt:d.value.name},null,8,Tt)])])]),e("div",$t,[e("div",xt,[a(Ze)]),e("div",Ct,[a(rt)])])])}}}),Dt=U(It,[["__scopeId","data-v-37575c5a"]]),Et={key:0},Nt={key:1},Lt={class:"top-nav"},Rt={class:"detail-main"},Ht=D({__name:"detailPage",setup(y){const i=r(!0);return E(()=>{setTimeout(()=>{i.value=!1},500)}),(d,k)=>i.value?(m(),f("div",Et,[a(ke)])):(m(),f("div",Nt,[e("nav",Lt,[a(_e)]),e("div",Rt,[a(Dt)])]))}});export{Ht as default};
