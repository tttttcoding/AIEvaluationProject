import{q as N,s as B,d as F,r as u,v as L,n as h,g as q,x as O,i as j,c as G,a as v,b as i,w as k,f as w,e as I,F as K,l as Q,m as S,E as T,o as R,_ as H}from"./index-D8PVboq4.js";import{A as J}from"./button-DyyqMqvL.js";const P=async l=>{try{return(await N.get("/auth",{data:l})).data}catch(n){throw n.response?n.response.data:{message:"请求失败"}}},W=async(l,n,a,o,_,d)=>{try{return(await B.put("/auth",{Authorization:a,password:o,nickname:_,username:d},{params:{id:l,role:n}})).data}catch(p){throw p.response?p.response.data:{message:"请求失败"}}},X=async(l,n,a)=>{try{return(await B.delete("/auth",{data:{Authorization:a},params:{id:l,role:n}})).data}catch(o){throw o.response?o.response.data:{message:"请求失败"}}},Y=async(l,n,a,o,_)=>{const d={nickname:n,username:a,password:o};try{return(await B.post("/auth",{Authorization:l,user:d},{params:{role:_}})).data}catch(p){throw p.response?p.response.data:{message:"请求失败"}}},Z=async(l,n,a)=>{try{return(await B.get("/auth",{data:{Authorization:l},params:{username:n,role:a}})).data}catch(o){throw o.response?o.response.data:{message:"请求失败"}}},ee=F("admin",()=>{const l=u([]),n=u([]),a=u([]),o=u(0),_=u(0);u(0);const d=L(),p=async()=>{try{const r=d.user.token,c=await P(r);l.value=c.students,U(l.value,"student")}catch{console.error("学生列表获取异常")}},x=async()=>{try{const r=d.user.token,c=await P(r);n.value=c.teachers,U(n.value,"teacher")}catch{console.error("学生列表获取异常")}},U=(r,c)=>{c==="student"?o.value=r.length:_.value=r.length},M=async(r,c,m,e,t)=>{const s=d.user.token;try{const g=await W(r,c,s,m||"",e,t);console.log(g),h({type:"success",message:"修改成功"})}catch(y){console.error(y)}},V=async(r,c)=>{const m=d.user.token;try{const e=await X(r,c,m);console.log(e.message),h({type:"success",message:"删除成功"})}catch(e){console.error(e)}},$=async(r,c,m,e)=>{const t=d.user.token;try{const s=await Y(t,r,c,m,e);console.log(s.message),h({type:"success",message:"添加成功"})}catch(s){console.error(s)}},C=u({id:0,nickname:"",username:"",role:"",message:""});return{students:l,teachers:n,tools:a,userFound:C,fetchStudents:p,fetchTeachers:x,countSize:U,updateUserInfo:M,deleteUser:V,addUser:$,queryUser:async(r,c)=>{const m=d.user.token;try{const e=await Z(m,r,c);console.log(e),h({type:"success",message:"查询成功"}),C.value=e.user}catch(e){console.error(e)}}}}),te={class:"before-container"},se={class:"search"},ne={class:"add"},ae={class:"container"},oe=q({__name:"stuList",setup(l){const n=u("student"),a=ee(),o=u(1),_=u(10),d=u(0),p=u(""),x=u("添加新学生"),U=e=>{o.value=e},M=e=>{T.prompt("请输入新昵称","修改昵称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,10}$/,inputErrorMessage:"昵称长度必须在2-10位之间"}).then(({value:t})=>{if(t){const s={id:e.id,nickname:t,username:e.username};a.updateUserInfo(s.id,n.value,"",s.nickname,s.username)}}).catch(()=>{h({type:"info",message:"取消修改"})})},V=e=>{console.log(e),T.prompt("请输入新用户名 (不建议随意修改用户名)","修改用户名",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,18}$/,inputErrorMessage:"用户名长度必须在2-18位之间"}).then(({value:t})=>{if(t){const s={id:e.id,nickname:e.nickname,username:t};a.updateUserInfo(s.id,n.value,"",s.nickname,s.username)}}).catch(()=>{h({type:"info",message:"取消修改"})})},$=e=>{T.prompt("请输入新密码 (不建议随意修改密码)","修改密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{6,18}$/,inputErrorMessage:"密码长度必须在6-18位之间"}).then(({value:t})=>{if(t){const s={id:e.id,password:t,nickname:e.nickname,username:e.username};a.updateUserInfo(s.id,n.value,s.password,s.nickname,s.username)}}).catch(()=>{h({type:"info",message:"取消修改"})})},C=e=>{T.confirm(`该操作将永久删除用户 (昵称:${e.nickname} 用户名:${e.username}) ,请谨慎操作`,"确认删除",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(()=>{h({type:"success",message:"Delete completed"}),a.deleteUser(e.id,n.value)}).catch(()=>{h({type:"info",message:"Delete canceled"})})};let z;const r=(e,t)=>{const y=(e?a.students.filter(c(e)):a.students).map(g=>({value:g.username,...g}));clearTimeout(z),z=setTimeout(()=>{t(y)},1500*Math.random())},c=e=>t=>t.username.toLowerCase().indexOf(e.toLowerCase())===0,m=e=>{console.log(e);const t=e.id;console.log(t)};return O(o,()=>{a.fetchStudents()}),j(()=>{setTimeout(()=>{a.fetchStudents()},100)}),(e,t)=>{const s=w("el-icon"),y=w("el-autocomplete"),g=w("el-table-column"),b=w("el-button"),A=w("el-table"),D=w("el-pagination");return R(),G(K,null,[t[7]||(t[7]=v("h1",{class:"title"},"学生管理",-1)),v("div",te,[v("div",se,[i(s,null,{default:k(()=>[i(I(Q))]),_:1}),i(y,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=f=>p.value=f),"fetch-suggestions":r,placeholder:"根据用户名查找学生",onSelect:m},{loading:k(()=>t[2]||(t[2]=[v("svg",{class:"circular",viewBox:"0 0 50 50"},[v("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"])]),v("div",ne,[i(J,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=f=>x.value=f)},null,8,["modelValue"])])]),v("div",ae,[i(A,{data:I(a).students,style:{width:"100%"},stripe:"","highlight-current-row":""},{default:k(()=>[i(g,{prop:"id",label:"ID",width:"100","header-align":"center",align:"center"}),i(g,{prop:"nickname",label:"Nickname",width:"160","header-align":"center",align:"center"}),i(g,{prop:"username",label:"Username",width:"160","header-align":"center",align:"center"}),i(g,{fixed:"right",label:"Operations","min-width":"260","header-align":"center",align:"center"},{default:k(({row:f})=>[i(b,{link:"",type:"primary",size:"small",onClick:E=>M(f),title:"nickname"},{default:k(()=>t[3]||(t[3]=[S(" Modify Nickname ")])),_:2},1032,["onClick"]),i(b,{link:"",type:"primary",size:"small",onClick:E=>V(f),title:"username"},{default:k(()=>t[4]||(t[4]=[S(" Modify Username ")])),_:2},1032,["onClick"]),i(b,{link:"",type:"primary",size:"small",onClick:E=>$(f),title:"password"},{default:k(()=>t[5]||(t[5]=[S(" Modify Password ")])),_:2},1032,["onClick"]),i(b,{link:"",type:"primary",onClick:E=>C(f),size:"small",style:{color:"red"}},{default:k(()=>t[6]||(t[6]=[S("Delete")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),i(D,{"current-page":o.value,class:"pagination","page-size":_.value,total:d.value,onCurrentChange:U,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],64)}}}),le=H(oe,[["__scopeId","data-v-d6c7e5be"]]);export{le as default};
