import{b as J,r as c,w as T,e as K,c as Q,a as r,f as a,g as s,h as m,t as W,i as V,F as X,j as Y,k as p,p as Z,E as i,l as k,o as ee,_ as te}from"./index-DU-Sq44Q.js";import{u as ae}from"./useAdminStore-YVElVfel.js";const ne={class:"before-container"},se={class:"search"},le={class:"refresh"},oe={class:"add"},re={class:"button-wrapper"},ie=["title"],ue={class:"dialog-footer"},de={class:"container"},ce=J({__name:"stuList",setup(me){const _=c("student"),n=ae(),y=c(1),$=c(10),b=c(0),S=c(""),U=c("添加新学生"),f=c(!1),g=c(),u=c({username:"",nickname:"",password:""}),z=c({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:6,max:18,message:"用户名长度必须在6-18位之间",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:18,message:"昵称长度必须在2-18位之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"密码长度必须在6-18位之间",trigger:"blur"}]}),M=t=>{var e;(e=g.value)==null||e.resetFields(),t()},E=async()=>{g.value&&await g.value.validate(async t=>{var e;if(t)try{await n.addUser(u.value.nickname,u.value.username,u.value.password,"student"),f.value=!1,(e=g.value)==null||e.resetFields(),n.fetchStudents(),i.success("添加学生成功")}catch{}})},F=async()=>{try{await n.fetchStudents(),i.success("列表刷新成功")}catch(t){i.error("刷新失败: "+t.message)}},I=t=>{y.value=t},P=t=>{k.prompt("请输入新昵称","修改昵称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,18}$/,inputErrorMessage:"昵称长度必须在2-18位之间",inputValue:t.nickname}).then(({value:e})=>{if(e){let l={id:t.id,nickname:e,username:t.username};n.updateUserInfo(l.id,_.value,"",l.nickname,l.username).then(()=>{n.fetchStudents(),i.success("修改昵称成功")})}}).catch(()=>{i({type:"info",message:"取消修改"})})},N=t=>{console.log(t),k.prompt("请输入新用户名 (一般为学号、工号，不建议随意修改)","修改用户名",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{6,18}$/,inputErrorMessage:"用户名长度必须在6-18位之间",inputValue:t.username}).then(({value:e})=>{if(e){let l={id:t.id,nickname:t.nickname,username:e};n.updateUserInfo(l.id,_.value,"",l.nickname,l.username).then(()=>{n.fetchStudents(),i.success("修改用户名成功")})}}).catch(()=>{i({type:"info",message:"取消修改"})})},D=t=>{k.prompt("请输入新密码 (不建议随意修改密码)","修改密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{6,18}$/,inputErrorMessage:"密码长度必须在6-18位之间"}).then(({value:e})=>{if(e){const l={id:t.id,password:e,nickname:t.nickname,username:t.username};n.updateUserInfo(l.id,_.value,l.password,l.nickname,l.username).then(()=>{n.fetchStudents(),i.success("修改密码成功")})}}).catch(()=>{i({type:"info",message:"取消修改"})})},L=t=>{k.confirm(`该操作将永久删除用户 (昵称:${t.nickname} 用户名:${t.username}) ,请谨慎操作`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await n.deleteUser(t.id,_.value),n.fetchStudents(),i.success("删除用户成功")}catch(e){i({type:"error",message:`删除失败: ${e.message}`})}}).catch(()=>{i({type:"info",message:"已取消删除操作"})})};let B;const R=(t,e)=>{const v=(t?n.students.filter(j(t)):n.students).map(d=>({value:d.username,...d}));clearTimeout(B),B=setTimeout(()=>{e(v)},1500*Math.random())},j=t=>e=>e.username.toLowerCase().indexOf(t.toLowerCase())===0,q=t=>{console.log(t);const e=t.id;console.log(e)};return T(y,()=>{n.fetchStudents()}),K(()=>{setTimeout(()=>{n.fetchStudents(),b.value=n.totalStudents},100)}),T(()=>n.totalStudents,t=>{b.value=t}),(t,e)=>{const l=m("el-icon"),v=m("el-autocomplete"),d=m("el-button"),w=m("el-input"),x=m("el-form-item"),A=m("el-form"),O=m("el-dialog"),h=m("el-table-column"),G=m("el-table"),H=m("el-pagination");return ee(),Q(X,null,[e[15]||(e[15]=r("h1",{class:"title"},"学生管理",-1)),r("div",ne,[r("div",se,[a(l,null,{default:s(()=>[a(V(Y))]),_:1}),a(v,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=o=>S.value=o),"fetch-suggestions":R,placeholder:"根据用户名查找学生",onSelect:q},{loading:s(()=>e[7]||(e[7]=[r("svg",{class:"circular",viewBox:"0 0 50 50"},[r("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"])]),r("div",le,[a(d,{onClick:F,type:"primary",size:"small"},{default:s(()=>e[8]||(e[8]=[p("手动刷新列表")])),_:1})]),r("div",oe,[r("div",{class:"button","data-tooltip":"Size: 20Mb",onClick:e[1]||(e[1]=o=>f.value=!0)},[r("div",re,[r("div",{class:"text",title:U.value},W(U.value),9,ie),a(l,{class:"icon",style:{transform:"scale(1.2)"}},{default:s(()=>[a(V(Z))]),_:1})])])])]),a(O,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=o=>f.value=o),title:"添加新学生",width:"30%","before-close":M},{footer:s(()=>[r("span",ue,[a(d,{onClick:e[5]||(e[5]=o=>f.value=!1)},{default:s(()=>e[9]||(e[9]=[p("取消")])),_:1}),a(d,{type:"primary",onClick:E},{default:s(()=>e[10]||(e[10]=[p("确认")])),_:1})])]),default:s(()=>[a(A,{model:u.value,rules:z.value,ref_key:"formRef",ref:g,"label-width":"80px"},{default:s(()=>[a(x,{label:"用户名",prop:"username"},{default:s(()=>[a(w,{modelValue:u.value.username,"onUpdate:modelValue":e[2]||(e[2]=o=>u.value.username=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(x,{label:"昵称",prop:"nickname"},{default:s(()=>[a(w,{modelValue:u.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(x,{label:"密码",prop:"password"},{default:s(()=>[a(w,{modelValue:u.value.password,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value.password=o),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),r("div",de,[a(G,{data:V(n).students,style:{width:"100%"},stripe:"","highlight-current-row":""},{default:s(()=>[a(h,{prop:"id",label:"ID",width:"80","header-align":"center",align:"center"}),a(h,{prop:"nickname",label:"Nickname",width:"120","header-align":"center",align:"center"}),a(h,{prop:"username",label:"Username",width:"120","header-align":"center",align:"center"}),a(h,{fixed:"right",label:"Operations","min-width":"260","header-align":"center",align:"center"},{default:s(({row:o})=>[a(d,{link:"",type:"primary",size:"small",onClick:C=>P(o),title:"nickname"},{default:s(()=>e[11]||(e[11]=[p(" 修改昵称 ")])),_:2},1032,["onClick"]),a(d,{link:"",type:"primary",size:"small",onClick:C=>N(o),title:"username"},{default:s(()=>e[12]||(e[12]=[p(" 修改用户名 ")])),_:2},1032,["onClick"]),a(d,{link:"",type:"primary",size:"small",onClick:C=>D(o),title:"password"},{default:s(()=>e[13]||(e[13]=[p(" 修改密码 ")])),_:2},1032,["onClick"]),a(d,{link:"",type:"primary",onClick:C=>L(o),size:"small",style:{color:"red"}},{default:s(()=>e[14]||(e[14]=[p("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(H,{"current-page":y.value,class:"pagination","page-size":$.value,total:b.value,onCurrentChange:I,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],64)}}}),ge=te(ce,[["__scopeId","data-v-3f8fa81b"]]);export{ge as default};
