import{i as J,r as c,v as T,j as K,e as Q,f as i,k as a,w as n,m,t as W,l as C,n as X,x as Y,p,y as Z,E as r,z as y,o as ee,_ as te}from"./index-uf0FIciC.js";import{u as ae}from"./useAdminStore-YlP7g7lZ.js";const ne={class:"before-container"},le={class:"search"},se={class:"refresh"},oe={class:"add"},re={class:"button-wrapper"},ue=["title"],ie={class:"dialog-footer"},de={class:"container"},ce=J({__name:"stuList",setup(me){const h=c("student"),l=ae(),w=c(1),$=c(10),x=c(0),S=c(""),U=c("添加新学生"),f=c(!1),g=c(),u=c({username:"",nickname:"",password:"",cno:""}),z=c({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:6,max:18,message:"用户名长度必须在6-18位之间",trigger:"blur"}],nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:18,message:"昵称长度必须在2-18位之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:18,message:"密码长度必须在6-18位之间",trigger:"blur"}]}),M=t=>{var e;(e=g.value)==null||e.resetFields(),t()},E=async()=>{g.value&&await g.value.validate(async t=>{var e;if(t)try{await l.addUser(u.value.nickname,u.value.username,u.value.password,"student"),f.value=!1,(e=g.value)==null||e.resetFields(),l.fetchStudents(),r.success("添加成功")}catch{r.error("未知错误")}})},I=async()=>{try{await l.fetchStudents(),r.success("列表已刷新")}catch(t){r.error("刷新失败: "+t.message)}},P=t=>{w.value=t},F=t=>{y.prompt("请输入新昵称","修改昵称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,18}$/,inputErrorMessage:"昵称长度必须在2-18位之间",inputValue:t.nickname}).then(({value:e})=>{if(e){let o={id:t.id,nickname:e,username:t.username};l.updateUserInfo(o.id,h.value,"",o.nickname,o.username).then(()=>{l.fetchStudents(),r.success("修改昵称成功")})}}).catch(()=>{r.info("取消修改")})},N=t=>{y.prompt("请输入新用户名 (一般为学号、工号，不建议随意修改)","修改用户名",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{6,18}$/,inputErrorMessage:"用户名长度必须在6-18位之间",inputValue:t.username}).then(({value:e})=>{if(e){let o={id:t.id,nickname:t.nickname,username:e};l.updateUserInfo(o.id,h.value,"",o.nickname,o.username).then(()=>{l.fetchStudents(),r.success("修改用户名成功")})}}).catch(()=>{r.info("取消修改")})},D=t=>{y.prompt("请输入新密码 (不建议随意修改密码)","修改密码",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{6,18}$/,inputErrorMessage:"密码长度必须在6-18位之间"}).then(({value:e})=>{if(e){const o={id:t.id,password:e,nickname:t.nickname,username:t.username};l.updateUserInfo(o.id,h.value,o.password,o.nickname,o.username).then(()=>{l.fetchStudents(),r.success("修改成功")})}}).catch(()=>{r.info("取消修改")})},L=t=>{y.confirm(`该操作将永久删除用户 (昵称:${t.nickname} 用户名:${t.username}) ,请谨慎操作`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await l.deleteUser(t.id,h.value),l.fetchStudents(),r.success("删除成功")}catch{r.error("删除失败")}}).catch(()=>{r.info("取消删除")})};let B;const R=(t,e)=>{const _=(t?l.students.filter(j(t)):l.students).map(d=>({value:d.username,...d}));clearTimeout(B),B=setTimeout(()=>{e(_)},1500*Math.random())},j=t=>e=>e.username.toLowerCase().indexOf(t.toLowerCase())===0,q=t=>{console.log(t);const e=t.id;console.log(e)};return T(w,()=>{l.fetchStudents()}),K(()=>{setTimeout(()=>{l.fetchStudents(),x.value=l.totalStudents},100)}),T(()=>l.totalStudents,t=>{x.value=t}),(t,e)=>{const o=m("el-icon"),_=m("el-autocomplete"),d=m("el-button"),k=m("el-input"),b=m("el-form-item"),A=m("el-form"),O=m("el-dialog"),v=m("el-table-column"),G=m("el-table"),H=m("el-pagination");return ee(),Q(X,null,[e[16]||(e[16]=i("h1",{class:"title"},"学生管理",-1)),i("div",ne,[i("div",le,[a(o,null,{default:n(()=>[a(C(Y))]),_:1}),a(_,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),"fetch-suggestions":R,placeholder:"根据用户名查找学生",onSelect:q},{loading:n(()=>e[8]||(e[8]=[i("svg",{class:"circular",viewBox:"0 0 50 50"},[i("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"])]),i("div",se,[a(d,{onClick:I,type:"primary",size:"small"},{default:n(()=>e[9]||(e[9]=[p("手动刷新列表")])),_:1,__:[9]})]),i("div",oe,[i("div",{class:"button","data-tooltip":"Size: 20Mb",onClick:e[1]||(e[1]=s=>f.value=!0)},[i("div",re,[i("div",{class:"text",title:U.value},W(U.value),9,ue),a(o,{class:"icon",style:{transform:"scale(1.2)"}},{default:n(()=>[a(C(Z))]),_:1})])])])]),a(O,{modelValue:f.value,"onUpdate:modelValue":e[7]||(e[7]=s=>f.value=s),title:"添加新学生",width:"30%","before-close":M},{footer:n(()=>[i("span",ie,[a(d,{onClick:e[6]||(e[6]=s=>f.value=!1)},{default:n(()=>e[10]||(e[10]=[p("取消")])),_:1,__:[10]}),a(d,{type:"primary",onClick:E},{default:n(()=>e[11]||(e[11]=[p("确认")])),_:1,__:[11]})])]),default:n(()=>[a(A,{model:u.value,rules:z.value,ref_key:"formRef",ref:g,"label-width":"80px"},{default:n(()=>[a(b,{label:"用户名",prop:"username"},{default:n(()=>[a(k,{modelValue:u.value.username,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.username=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(b,{label:"昵称",prop:"nickname"},{default:n(()=>[a(k,{modelValue:u.value.nickname,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.nickname=s),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(b,{label:"密码",prop:"password"},{default:n(()=>[a(k,{modelValue:u.value.password,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value.password=s),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),a(b,{label:"班级",prop:"class"},{default:n(()=>[a(k,{modelValue:u.value.cno,"onUpdate:modelValue":e[5]||(e[5]=s=>u.value.cno=s),placeholder:"请输入班级"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),i("div",de,[a(G,{data:C(l).students,style:{width:"100%"},stripe:"","highlight-current-row":""},{default:n(()=>[a(v,{prop:"id",label:"ID",width:"80","header-align":"center",align:"center"}),a(v,{prop:"nickname",label:"Nickname",width:"130","header-align":"center",align:"center"}),a(v,{prop:"username",label:"Username",width:"130","header-align":"center",align:"center"}),a(v,{prop:"class",label:"Class",width:"100","header-align":"center",align:"center"}),a(v,{fixed:"right",label:"Operations","min-width":"260","header-align":"center",align:"center"},{default:n(({row:s})=>[a(d,{link:"",type:"primary",size:"small",onClick:V=>F(s),title:"nickname"},{default:n(()=>e[12]||(e[12]=[p(" 修改昵称 ")])),_:2,__:[12]},1032,["onClick"]),a(d,{link:"",type:"primary",size:"small",onClick:V=>N(s),title:"username"},{default:n(()=>e[13]||(e[13]=[p(" 修改用户名 ")])),_:2,__:[13]},1032,["onClick"]),a(d,{link:"",type:"primary",size:"small",onClick:V=>D(s),title:"password"},{default:n(()=>e[14]||(e[14]=[p(" 修改密码 ")])),_:2,__:[14]},1032,["onClick"]),a(d,{link:"",type:"primary",onClick:V=>L(s),size:"small",style:{color:"red"}},{default:n(()=>e[15]||(e[15]=[p("删除")])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),a(H,{"current-page":w.value,class:"pagination","page-size":$.value,total:x.value,onCurrentChange:P,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"])])],64)}}}),ge=te(ce,[["__scopeId","data-v-43aad940"]]);export{ge as default};
