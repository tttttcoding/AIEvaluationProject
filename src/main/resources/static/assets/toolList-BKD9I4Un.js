import{_ as X,K as we,c as D,a as i,f as o,t as N,g as a,i as B,p as xe,h as c,o as x,b as Ve,r as g,L as Ce,A as U,w as ke,e as Te,B as E,m as Q,M as Le,F as G,j as Ie,k as _,N as Be,n as H,O as J,P as Se,l as $,E as v,Q as W}from"./index-DFfRBlu0.js";import{u as Ue}from"./useToolsStore-Dh428JkH.js";import{u as $e}from"./useAdminStore-D10_5fcf.js";import"./ToolsService-kAmPzzl5.js";const ze={class:"button","data-tooltip":"Size: 20Mb"},Fe={class:"button-wrapper"},Me=["title"],Ae={__name:"button",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(P){const f=we(P,"modelValue");return(y,h)=>{const V=c("el-icon");return x(),D("div",ze,[i("div",Fe,[i("div",{class:"text",title:f.value},N(f.value),9,Me),o(V,{class:"icon",style:{transform:"scale(1.2)"}},{default:a(()=>[o(B(xe))]),_:1})])])}}},Ee=X(Ae,[["__scopeId","data-v-031693ec"]]),De={class:"before-container"},Ne={class:"search"},Pe={class:"actions"},Re={class:"container"},Oe={class:"logo-preview"},qe={class:"preview-container"},je=["src"],Ke={class:"placeholder-image"},Qe={class:"dialog-footer"},Ge=Ve({__name:"toolList",setup(P){const f=Ue(),y=$e(),h=g(1),V=g(14),z=g(0),F=g(""),R=g("添加新工具"),b=g(null),C=g(!1),M=g(),n=Ce({name:"",category:"",url:"",logo_url:"",description:""}),Y={name:[{required:!0,message:"请输入工具名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],category:[{required:!0,message:"请输入工具分类",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],url:[{required:!0,message:"请输入工具网站链接",trigger:"blur"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w.-]*)*\/?$/,message:"请输入有效的URL",trigger:"blur"}],logo_url:[{required:!0,message:"请输入Logo链接",trigger:"blur"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w.-]*)*\/?$/,message:"请输入有效的URL",trigger:"blur"}],description:[{required:!0,message:"请输入工具描述",trigger:"blur"},{min:5,max:200,message:"长度在 5 到 200 个字符",trigger:"blur"}]},k=g({prop:"id",order:"ascending"}),T=U(()=>Object.values(f.toolsByCategory||{}).flat()),Z=U(()=>Array.from(new Set(T.value.map(e=>e.category))).map(e=>({text:e,value:e}))),ee=(t,e)=>e.category===t,te=U(()=>{let t=[...T.value];if(b.value)return t=t.filter(d=>d.id===b.value.id),t;k.value.prop&&k.value.order&&t.sort((d,r)=>{const s=k.value.prop,p=d[s]??0,m=r[s]??0;return k.value.order==="ascending"?p>m?1:-1:p<m?1:-1});const e=(h.value-1)*V.value,u=e+V.value;return z.value=t.length,t.slice(e,u)}),oe=t=>{k.value=t},w=async()=>{try{const t=W.service({lock:!0,text:"正在刷新数据...",background:"rgba(0, 0, 0, 0.7)"});localStorage.removeItem("toolCategories"),localStorage.removeItem("toolsByCategory"),localStorage.removeItem("toolsCacheTime"),await f.fetchCategory(),t.close(),v({type:"success",message:"数据已刷新",duration:2e3})}catch(t){v.error(`刷新失败：${t}`)}},le=t=>{$.prompt("请输入新名称","修改工具名称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,50}$/,inputErrorMessage:"名称长度必须在2-50位之间",inputValue:t.name}).then(async({value:e})=>{if(e){const u=t.id,d=e,r=t.category,s=t.url,p=t.logo_url,m=t.description;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},ae=t=>{$.prompt("请输入新描述","修改工具描述",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{5,200}$/,inputErrorMessage:"描述长度必须在5-200位之间",inputValue:t.description}).then(async({value:e})=>{if(e){const u=t.id,d=t.name,r=t.category,s=t.url,p=t.logo_url,m=e;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},ne=t=>{$.prompt("请输入新分类","修改工具分类",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,20}$/,inputErrorMessage:"分类长度必须在2-20位之间",inputValue:t.category}).then(async({value:e})=>{if(e){const u=t.id,d=t.name,r=e,s=t.url,p=t.logo_url,m=t.description;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},re=t=>{$.confirm(`该操作将永久删除工具 "${t.name}"，请谨慎操作`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=t.id;await y.deleteTool(e),await w()}).catch(()=>{v({type:"info",message:"已取消删除"})})},se=()=>{C.value=!0,f.categories.length>0&&(n.category=f.categories[0])},O=()=>{var t;(t=M.value)==null||t.resetFields()},ie=()=>{C.value=!1,O()},ue=U(()=>n.logo_url||""),L=g(!0),ce=()=>{if(n.logo_url){const t=new Image;t.onload=()=>{L.value=!0},t.onerror=()=>{L.value=!1},t.src=n.logo_url}else L.value=!1};ke(()=>n.logo_url,()=>{ce()});const de=()=>{var t;(t=M.value)==null||t.validate(async e=>{if(e)try{const u=W.service({lock:!0,text:"正在添加工具...",background:"rgba(0, 0, 0, 0.7)"});await y.addTool(n.name,n.category,n.url,n.logo_url,n.description),u.close(),C.value=!1,O(),await w(),v({type:"success",message:"工具添加成功！",duration:2e3})}catch(u){v.error(`添加失败：${u.message||"未知错误"}`)}else return v.warning("请正确填写所有必填信息"),!1})},pe=t=>{b.value=t,h.value=1,console.log("选中工具:",t)},q=()=>{b.value=null,F.value="",h.value=1};let j;const me=(t,e)=>{const d=(t?T.value.filter(ge(t)):T.value).map(r=>({value:r.name,...r}));clearTimeout(j),j=setTimeout(()=>{e(d)},300)},ge=t=>e=>e.name.toLowerCase().indexOf(t.toLowerCase())===0||e.category.toLowerCase().indexOf(t.toLowerCase())===0,fe=t=>{h.value=t};return Te(async()=>{await f.fetchCategory(),z.value=T.value.length}),(t,e)=>{const u=c("el-icon"),d=c("el-autocomplete"),r=c("el-button"),s=c("el-table-column"),p=c("el-table"),m=c("el-pagination"),S=c("el-input"),I=c("el-form-item"),_e=c("el-option"),ve=c("el-select"),K=c("el-col"),ye=c("el-row"),he=c("el-form"),be=c("el-dialog");return x(),D(G,null,[e[18]||(e[18]=i("h1",{class:"title"},"工具管理",-1)),i("div",De,[i("div",Ne,[o(u,null,{default:a(()=>[o(B(Ie))]),_:1}),o(d,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=l=>F.value=l),"fetch-suggestions":me,placeholder:"根据工具名称查找",onSelect:pe,clearable:"",onClear:q},{loading:a(()=>e[8]||(e[8]=[i("svg",{class:"circular",viewBox:"0 0 50 50"},[i("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"]),b.value?(x(),E(r,{key:0,link:"",type:"primary",onClick:q,style:{"margin-left":"10px"}},{default:a(()=>e[9]||(e[9]=[_(" 清除筛选 ")])),_:1})):Q("",!0)]),i("div",Pe,[o(r,{class:"refresh-btn",type:"primary",icon:B(Le),circle:"",onClick:w,title:"刷新工具列表"},null,8,["icon"]),i("div",{class:"add",onClick:se},[o(Ee,{modelValue:R.value,"onUpdate:modelValue":e[1]||(e[1]=l=>R.value=l)},null,8,["modelValue"])])])]),i("div",Re,[o(p,{data:te.value,style:{width:"100%"},stripe:"","highlight-current-row":"",onSortChange:oe},{default:a(()=>[o(s,{prop:"id",label:"ID",width:"75","header-align":"center",align:"center",sortable:"custom"}),o(s,{prop:"name",label:"工具名称",width:"110","header-align":"center",align:"center"}),o(s,{prop:"category",label:"分类",width:"110","header-align":"center",align:"center",sortable:"custom",filters:Z.value,"filter-method":ee},null,8,["filters"]),o(s,{prop:"description",label:"描述","min-width":"150","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"url",label:"链接",width:"180","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"logo_url",label:"图片链接",width:"180","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"score",label:"评分",width:"90","header-align":"center",align:"center",sortable:"custom"},{default:a(({row:l})=>[_(N(l.score??"暂无")+" ⭐ ",1)]),_:1}),o(s,{prop:"ratingCount",label:"评分数",width:"90","header-align":"center",align:"center",sortable:"custom"},{default:a(({row:l})=>[_(N(l.ratingCount??0),1)]),_:1}),o(s,{fixed:"right",label:"操作",width:"260","header-align":"center",align:"center"},{default:a(({row:l})=>[o(r,{link:"",type:"primary",size:"small",onClick:A=>le(l)},{default:a(()=>e[10]||(e[10]=[_(" 修改名称 ")])),_:2},1032,["onClick"]),o(r,{link:"",type:"primary",size:"small",onClick:A=>ae(l)},{default:a(()=>e[11]||(e[11]=[_(" 修改描述 ")])),_:2},1032,["onClick"]),o(r,{link:"",type:"primary",size:"small",onClick:A=>ne(l)},{default:a(()=>e[12]||(e[12]=[_(" 修改分类 ")])),_:2},1032,["onClick"]),o(r,{link:"",type:"primary",onClick:A=>re(l),size:"small",style:{color:"red"}},{default:a(()=>e[13]||(e[13]=[_(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),b.value?Q("",!0):(x(),E(m,{key:0,"current-page":h.value,class:"pagination","page-size":V.value,total:z.value,onCurrentChange:fe,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"]))]),o(be,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),title:"添加新工具",width:"600px",top:"5vh","close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":""},{footer:a(()=>[i("div",Qe,[o(r,{onClick:ie},{default:a(()=>e[16]||(e[16]=[_("取 消")])),_:1}),o(r,{type:"primary",onClick:de},{default:a(()=>e[17]||(e[17]=[_("确 定")])),_:1})])]),default:a(()=>[o(he,{ref_key:"toolFormRef",ref:M,model:n,rules:Y,"label-width":"100px","label-position":"right",class:"tool-form"},{default:a(()=>[o(ye,{gutter:20},{default:a(()=>[o(K,{span:16},{default:a(()=>[o(I,{label:"工具名称",prop:"name"},{default:a(()=>[o(S,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),placeholder:"请输入工具名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(I,{label:"工具分类",prop:"category"},{default:a(()=>[o(ve,{modelValue:n.category,"onUpdate:modelValue":e[3]||(e[3]=l=>n.category=l),placeholder:"请选择工具分类",style:{width:"100%"},filterable:"","allow-create":""},{default:a(()=>[(x(!0),D(G,null,Be(B(f).categories,l=>(x(),E(_e,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(I,{label:"工具链接",prop:"url"},{default:a(()=>[o(S,{modelValue:n.url,"onUpdate:modelValue":e[4]||(e[4]=l=>n.url=l),placeholder:"请输入工具链接（如：https://www.example.com）"},null,8,["modelValue"])]),_:1}),o(I,{label:"Logo链接",prop:"logo_url"},{default:a(()=>[o(S,{modelValue:n.logo_url,"onUpdate:modelValue":e[5]||(e[5]=l=>n.logo_url=l),placeholder:"请输入Logo链接"},null,8,["modelValue"])]),_:1})]),_:1}),o(K,{span:8,class:"preview-col"},{default:a(()=>[i("div",Oe,[e[15]||(e[15]=i("p",null,"Logo预览",-1)),i("div",qe,[H(i("img",{src:ue.value,alt:"Logo预览",class:"preview-image"},null,8,je),[[J,L.value&&n.logo_url]]),H(i("div",Ke,[o(u,{style:{"font-size":"24px",color:"#909399"}},{default:a(()=>[o(B(Se))]),_:1}),e[14]||(e[14]=i("span",null,"无效图片链接",-1))],512),[[J,!L.value||!n.logo_url]])])])]),_:1})]),_:1}),o(I,{label:"工具描述",prop:"description"},{default:a(()=>[o(S,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.description=l),type:"textarea",rows:4,placeholder:"请输入工具描述（5-200字）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ye=X(Ge,[["__scopeId","data-v-7ca14fa9"]]);export{Ye as default};
