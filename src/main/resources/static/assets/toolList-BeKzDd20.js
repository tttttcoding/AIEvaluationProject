import{_ as X,Q as we,e as R,f as i,k as o,t as D,w as a,l as S,y as xe,m as c,o as x,i as Ve,r as g,R as Ce,c as B,v as ke,j as Te,A as E,B as W,S as Ie,n as G,x as Le,p as f,q as Se,C as H,U as J,V as Ue,z as $,E as v,W as K}from"./index-UgPJK38L.js";import{u as Be}from"./useToolsStore-DRc9QM8f.js";import{u as $e}from"./useAdminStore-U4QSgU1R.js";import"./ToolsService-r0m5FawN.js";const ze={class:"button","data-tooltip":"Size: 20Mb"},Fe={class:"button-wrapper"},Ae=["title"],Me={__name:"button",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(q){const _=we(q,"modelValue");return(y,h)=>{const V=c("el-icon");return x(),R("div",ze,[i("div",Fe,[i("div",{class:"text",title:_.value},D(_.value),9,Ae),o(V,{class:"icon",style:{transform:"scale(1.2)"}},{default:a(()=>[o(S(xe))]),_:1})])])}}},Ee=X(Me,[["__scopeId","data-v-0171b836"]]),Re={class:"before-container"},De={class:"search"},qe={class:"actions"},Ne={class:"container"},Pe={class:"logo-preview"},Oe={class:"preview-container"},je=["src"],Qe={class:"placeholder-image"},We={class:"dialog-footer"},Ge=Ve({__name:"toolList",setup(q){const _=Be(),y=$e(),h=g(1),V=g(14),z=g(0),F=g(""),N=g("添加新工具"),b=g(null),C=g(!1),A=g(),n=Ce({name:"",category:"",url:"",logo_url:"",description:""}),Y={name:[{required:!0,message:"请输入工具名称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],category:[{required:!0,message:"请输入工具分类",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],url:[{required:!0,message:"请输入工具网站链接",trigger:"blur"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w.-]*)*\/?$/,message:"请输入有效的URL",trigger:"blur"}],logo_url:[{required:!0,message:"请输入Logo链接",trigger:"blur"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w.-]*)*\/?$/,message:"请输入有效的URL",trigger:"blur"}],description:[{required:!0,message:"请输入工具描述",trigger:"blur"},{min:5,max:200,message:"长度在 5 到 200 个字符",trigger:"blur"}]},k=g({prop:"id",order:"ascending"}),T=B(()=>Object.values(_.currentCategoryTools||{}).flat()),Z=B(()=>Array.from(new Set(T.value.map(e=>e.category))).map(e=>({text:e,value:e}))),ee=(t,e)=>e.category===t,te=B(()=>{let t=[...T.value];if(b.value)return t=t.filter(d=>d.id===b.value.id),t;k.value.prop&&k.value.order&&t.sort((d,r)=>{const s=k.value.prop,p=d[s]??0,m=r[s]??0;return k.value.order==="ascending"?p>m?1:-1:p<m?1:-1});const e=(h.value-1)*V.value,u=e+V.value;return z.value=t.length,t.slice(e,u)}),oe=t=>{k.value=t},w=async()=>{try{const t=K.service({lock:!0,text:"正在刷新数据...",background:"rgba(0, 0, 0, 0.7)"});localStorage.removeItem("toolCategories"),localStorage.removeItem("toolsByCategory"),localStorage.removeItem("toolsCacheTime"),await _.fetchCategory(),t.close(),v({type:"success",message:"数据已刷新",duration:2e3})}catch(t){v.error(`刷新失败：${t}`)}},le=t=>{$.prompt("请输入新名称","修改工具名称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,50}$/,inputErrorMessage:"名称长度必须在2-50位之间",inputValue:t.name}).then(async({value:e})=>{if(e){const u=t.id,d=e,r=t.category,s=t.url,p=t.logo_url,m=t.description;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},ae=t=>{$.prompt("请输入新描述","修改工具描述",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{5,200}$/,inputErrorMessage:"描述长度必须在5-200位之间",inputValue:t.description}).then(async({value:e})=>{if(e){const u=t.id,d=t.name,r=t.category,s=t.url,p=t.logo_url,m=e;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},ne=t=>{$.prompt("请输入新分类","修改工具分类",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,20}$/,inputErrorMessage:"分类长度必须在2-20位之间",inputValue:t.category}).then(async({value:e})=>{if(e){const u=t.id,d=t.name,r=e,s=t.url,p=t.logo_url,m=t.description;await y.updateToolInfo(u,d,r,s,p,m),await w()}}).catch(()=>{v({type:"info",message:"取消修改"})})},re=t=>{$.confirm(`该操作将永久删除工具 "${t.name}"，请谨慎操作`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e=t.id;await y.deleteTool(e),await w()}).catch(()=>{v({type:"info",message:"已取消删除"})})},se=()=>{C.value=!0,_.categories.length>0&&(n.category=_.categories[0])},P=()=>{var t;(t=A.value)==null||t.resetFields()},ie=()=>{C.value=!1,P()},ue=B(()=>n.logo_url||""),I=g(!0),ce=()=>{if(n.logo_url){const t=new Image;t.onload=()=>{I.value=!0},t.onerror=()=>{I.value=!1},t.src=n.logo_url}else I.value=!1};ke(()=>n.logo_url,()=>{ce()});const de=()=>{var t;(t=A.value)==null||t.validate(async e=>{if(e)try{const u=K.service({lock:!0,text:"正在添加工具...",background:"rgba(0, 0, 0, 0.7)"});await y.addTool(n.name,n.category,n.url,n.logo_url,n.description),u.close(),C.value=!1,P(),await w(),v({type:"success",message:"工具添加成功！",duration:2e3})}catch(u){v.error(`添加失败：${u.message||"未知错误"}`)}else return v.warning("请正确填写所有必填信息"),!1})},pe=t=>{b.value=t,h.value=1,console.log("选中工具:",t)},O=()=>{b.value=null,F.value="",h.value=1};let j;const me=(t,e)=>{const d=(t?T.value.filter(ge(t)):T.value).map(r=>({value:r.name,...r}));clearTimeout(j),j=setTimeout(()=>{e(d)},300)},ge=t=>e=>e.name.toLowerCase().indexOf(t.toLowerCase())===0||e.category.toLowerCase().indexOf(t.toLowerCase())===0,_e=t=>{h.value=t};return Te(async()=>{await _.fetchCategory(),z.value=T.value.length}),(t,e)=>{const u=c("el-icon"),d=c("el-autocomplete"),r=c("el-button"),s=c("el-table-column"),p=c("el-table"),m=c("el-pagination"),U=c("el-input"),L=c("el-form-item"),fe=c("el-option"),ve=c("el-select"),Q=c("el-col"),ye=c("el-row"),he=c("el-form"),be=c("el-dialog");return x(),R(G,null,[e[18]||(e[18]=i("h1",{class:"title"},"工具管理",-1)),i("div",Re,[i("div",De,[o(u,null,{default:a(()=>[o(S(Le))]),_:1}),o(d,{modelValue:F.value,"onUpdate:modelValue":e[0]||(e[0]=l=>F.value=l),"fetch-suggestions":me,placeholder:"根据工具名称查找",onSelect:pe,clearable:"",onClear:O},{loading:a(()=>e[8]||(e[8]=[i("svg",{class:"circular",viewBox:"0 0 50 50"},[i("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"]),b.value?(x(),E(r,{key:0,link:"",type:"primary",onClick:O,style:{"margin-left":"10px"}},{default:a(()=>e[9]||(e[9]=[f(" 清除筛选 ")])),_:1,__:[9]})):W("",!0)]),i("div",qe,[o(r,{class:"refresh-btn",type:"primary",icon:S(Ie),circle:"",onClick:w,title:"刷新工具列表"},null,8,["icon"]),i("div",{class:"add",onClick:se},[o(Ee,{modelValue:N.value,"onUpdate:modelValue":e[1]||(e[1]=l=>N.value=l)},null,8,["modelValue"])])])]),i("div",Ne,[o(p,{data:te.value,style:{width:"100%"},stripe:"","highlight-current-row":"",onSortChange:oe},{default:a(()=>[o(s,{prop:"id",label:"ID",width:"75","header-align":"center",align:"center",sortable:"custom"}),o(s,{prop:"name",label:"工具名称",width:"110","header-align":"center",align:"center"}),o(s,{prop:"category",label:"分类",width:"110","header-align":"center",align:"center",sortable:"custom",filters:Z.value,"filter-method":ee},null,8,["filters"]),o(s,{prop:"description",label:"描述","min-width":"150","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"url",label:"链接",width:"180","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"logo_url",label:"图片链接",width:"180","header-align":"center",align:"center","show-overflow-tooltip":!0}),o(s,{prop:"score",label:"评分",width:"90","header-align":"center",align:"center",sortable:"custom"},{default:a(({row:l})=>[f(D(l.score??"暂无")+" ⭐ ",1)]),_:1}),o(s,{prop:"ratingCount",label:"评分数",width:"90","header-align":"center",align:"center",sortable:"custom"},{default:a(({row:l})=>[f(D(l.ratingCount??0),1)]),_:1}),o(s,{fixed:"right",label:"操作",width:"260","header-align":"center",align:"center"},{default:a(({row:l})=>[o(r,{link:"",type:"primary",size:"small",onClick:M=>le(l)},{default:a(()=>e[10]||(e[10]=[f(" 修改名称 ")])),_:2,__:[10]},1032,["onClick"]),o(r,{link:"",type:"primary",size:"small",onClick:M=>ae(l)},{default:a(()=>e[11]||(e[11]=[f(" 修改描述 ")])),_:2,__:[11]},1032,["onClick"]),o(r,{link:"",type:"primary",size:"small",onClick:M=>ne(l)},{default:a(()=>e[12]||(e[12]=[f(" 修改分类 ")])),_:2,__:[12]},1032,["onClick"]),o(r,{link:"",type:"primary",onClick:M=>re(l),size:"small",style:{color:"red"}},{default:a(()=>e[13]||(e[13]=[f(" 删除 ")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),b.value?W("",!0):(x(),E(m,{key:0,"current-page":h.value,class:"pagination","page-size":V.value,total:z.value,onCurrentChange:_e,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"]))]),o(be,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=l=>C.value=l),title:"添加新工具",width:"600px",top:"5vh","close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":""},{footer:a(()=>[i("div",We,[o(r,{onClick:ie},{default:a(()=>e[16]||(e[16]=[f("取 消")])),_:1,__:[16]}),o(r,{type:"primary",onClick:de},{default:a(()=>e[17]||(e[17]=[f("确 定")])),_:1,__:[17]})])]),default:a(()=>[o(he,{ref_key:"toolFormRef",ref:A,model:n,rules:Y,"label-width":"100px","label-position":"right",class:"tool-form"},{default:a(()=>[o(ye,{gutter:20},{default:a(()=>[o(Q,{span:16},{default:a(()=>[o(L,{label:"工具名称",prop:"name"},{default:a(()=>[o(U,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),placeholder:"请输入工具名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(L,{label:"工具分类",prop:"category"},{default:a(()=>[o(ve,{modelValue:n.category,"onUpdate:modelValue":e[3]||(e[3]=l=>n.category=l),placeholder:"请选择工具分类",style:{width:"100%"},filterable:"","allow-create":""},{default:a(()=>[(x(!0),R(G,null,Se(S(_).categories,l=>(x(),E(fe,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(L,{label:"工具链接",prop:"url"},{default:a(()=>[o(U,{modelValue:n.url,"onUpdate:modelValue":e[4]||(e[4]=l=>n.url=l),placeholder:"请输入工具链接（如：https://www.example.com）"},null,8,["modelValue"])]),_:1}),o(L,{label:"Logo链接",prop:"logo_url"},{default:a(()=>[o(U,{modelValue:n.logo_url,"onUpdate:modelValue":e[5]||(e[5]=l=>n.logo_url=l),placeholder:"请输入Logo链接"},null,8,["modelValue"])]),_:1})]),_:1}),o(Q,{span:8,class:"preview-col"},{default:a(()=>[i("div",Pe,[e[15]||(e[15]=i("p",null,"Logo预览",-1)),i("div",Oe,[H(i("img",{src:ue.value,alt:"Logo预览",class:"preview-image"},null,8,je),[[J,I.value&&n.logo_url]]),H(i("div",Qe,[o(u,{style:{"font-size":"24px",color:"#909399"}},{default:a(()=>[o(S(Ue))]),_:1}),e[14]||(e[14]=i("span",null,"无效图片链接",-1))],512),[[J,!I.value||!n.logo_url]])])])]),_:1})]),_:1}),o(L,{label:"工具描述",prop:"description"},{default:a(()=>[o(U,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.description=l),type:"textarea",rows:4,placeholder:"请输入工具描述（5-200字）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Ye=X(Ge,[["__scopeId","data-v-52699727"]]);export{Ye as default};
