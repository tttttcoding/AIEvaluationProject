import{g as J,r as c,h as B,i as K,c as Q,a as u,b as a,j as E,k as L,w as n,f as m,F as W,e as X,l as Y,m as p,t as M,E as C,n as s,o as T,_ as Z}from"./index-D8PVboq4.js";import{u as q}from"./useToolsStore-BjDRuf4g.js";import{A as ee}from"./button-DyyqMqvL.js";import"./ToolsService-RoSKOOJw.js";const te={class:"before-container"},ae={class:"search"},oe={class:"add"},ne={class:"container"},le=J({__name:"toolList",setup(re){const V=q(),g=c(1),x=c(13),b=c(0),w=c(""),S=c("添加新工具"),d=c(null),f=c({prop:"id",order:"ascending"}),v=B(()=>Object.values(V.toolsByCategory||{}).flat()),U=B(()=>Array.from(new Set(v.value.map(e=>e.category))).map(e=>({text:e,value:e}))),A=(t,e)=>e.category===t,F=B(()=>{let t=[...v.value];if(d.value)return t=t.filter(i=>i.id===d.value.id),t;f.value.prop&&f.value.order&&t.sort((i,l)=>{const r=f.value.prop,y=i[r]??0,_=l[r]??0;return f.value.order==="ascending"?y>_?1:-1:y<_?1:-1});const e=(g.value-1)*x.value,h=e+x.value;return b.value=t.length,t.slice(e,h)}),N=t=>{f.value=t},P=t=>{C.prompt("请输入新名称","修改工具名称",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,50}$/,inputErrorMessage:"名称长度必须在2-50位之间"}).then(({value:e})=>{e&&s.success("修改成功")}).catch(()=>{s({type:"info",message:"取消修改"})})},D=t=>{C.prompt("请输入新描述","修改工具描述",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{5,200}$/,inputErrorMessage:"描述长度必须在5-200位之间"}).then(({value:e})=>{e&&s.success("修改成功")}).catch(()=>{s({type:"info",message:"取消修改"})})},I=t=>{C.prompt("请输入新分类","修改工具分类",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^.{2,20}$/,inputErrorMessage:"分类长度必须在2-20位之间"}).then(({value:e})=>{e&&s.success("修改成功")}).catch(()=>{s({type:"info",message:"取消修改"})})},O=t=>{C.confirm(`该操作将永久删除工具 "${t.name}"，请谨慎操作`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.success("删除成功")}).catch(()=>{s({type:"info",message:"已取消删除"})})},j=t=>{d.value=t,g.value=1,console.log("选中工具:",t)},$=()=>{d.value=null,w.value="",g.value=1};let z;const R=(t,e)=>{const i=(t?v.value.filter(G(t)):v.value).map(l=>({value:l.name,...l}));clearTimeout(z),z=setTimeout(()=>{e(i)},300)},G=t=>e=>e.name.toLowerCase().indexOf(t.toLowerCase())===0||e.category.toLowerCase().indexOf(t.toLowerCase())===0,H=t=>{g.value=t};return K(async()=>{await V.fetchCategory(),b.value=v.value.length}),(t,e)=>{const h=m("el-icon"),i=m("el-autocomplete"),l=m("el-button"),r=m("el-table-column"),y=m("el-table"),_=m("el-pagination");return T(),Q(W,null,[e[8]||(e[8]=u("h1",{class:"title"},"工具管理",-1)),u("div",te,[u("div",ae,[a(h,null,{default:n(()=>[a(X(Y))]),_:1}),a(i,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),"fetch-suggestions":R,placeholder:"根据工具名称查找",onSelect:j,clearable:"",onClear:$},{loading:n(()=>e[2]||(e[2]=[u("svg",{class:"circular",viewBox:"0 0 50 50"},[u("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})],-1)])),_:1},8,["modelValue"]),d.value?(T(),E(l,{key:0,link:"",type:"primary",onClick:$,style:{"margin-left":"10px"}},{default:n(()=>e[3]||(e[3]=[p(" 清除筛选 ")])),_:1})):L("",!0)]),u("div",oe,[a(ee,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=o=>S.value=o)},null,8,["modelValue"])])]),u("div",ne,[a(y,{data:F.value,style:{width:"100%"},stripe:"","highlight-current-row":"",onSortChange:N},{default:n(()=>[a(r,{prop:"id",label:"ID",width:"75","header-align":"center",align:"center",sortable:"custom"}),a(r,{prop:"name",label:"工具名称",width:"160","header-align":"center",align:"center"}),a(r,{prop:"category",label:"分类",width:"120","header-align":"center",align:"center",sortable:"custom",filters:U.value,"filter-method":A},null,8,["filters"]),a(r,{prop:"description",label:"描述","min-width":"200","header-align":"center",align:"center","show-overflow-tooltip":!0}),a(r,{prop:"score",label:"评分",width:"100","header-align":"center",align:"center",sortable:"custom"},{default:n(({row:o})=>[p(M(o.score??"暂无")+" ⭐ ",1)]),_:1}),a(r,{prop:"ratingCount",label:"评分数",width:"100","header-align":"center",align:"center",sortable:"custom"},{default:n(({row:o})=>[p(M(o.ratingCount??0),1)]),_:1}),a(r,{fixed:"right",label:"操作",width:"260","header-align":"center",align:"center"},{default:n(({row:o})=>[a(l,{link:"",type:"primary",size:"small",onClick:k=>P(o)},{default:n(()=>e[4]||(e[4]=[p(" 修改名称 ")])),_:2},1032,["onClick"]),a(l,{link:"",type:"primary",size:"small",onClick:k=>D(o)},{default:n(()=>e[5]||(e[5]=[p(" 修改描述 ")])),_:2},1032,["onClick"]),a(l,{link:"",type:"primary",size:"small",onClick:k=>I(o)},{default:n(()=>e[6]||(e[6]=[p(" 修改分类 ")])),_:2},1032,["onClick"]),a(l,{link:"",type:"primary",onClick:k=>O(o),size:"small",style:{color:"red"}},{default:n(()=>e[7]||(e[7]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),d.value?L("",!0):(T(),E(_,{key:0,"current-page":g.value,class:"pagination","page-size":x.value,total:b.value,onCurrentChange:H,layout:"total, prev, pager, next, jumper"},null,8,["current-page","page-size","total"]))])],64)}}}),pe=Z(le,[["__scopeId","data-v-6d3523ff"]]);export{pe as default};
