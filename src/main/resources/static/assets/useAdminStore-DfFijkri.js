import{s as k,E as e,a as f,d as I,r as g,u as U}from"./index-DvWpKrQb.js";const N=async c=>{try{const s=await k.get("/auth",{headers:{Authorization:c}});return console.log("获取用户列表响应:",s.data),s.data}catch(s){if(s.response)switch(s.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${s.message}`)}else s.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(s)}},D=async(c,s,a,r,p,y)=>{const d={password:r,nickname:p,username:y,cno:""};try{return(await k.put("/auth",{Authorization:a,user:d},{params:{role:s,id:c}})).data}catch(i){if(i.response)switch(i.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${i.message}`)}else i.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(i)}},$=async(c,s,a)=>{try{return(await k.delete("/auth",{headers:{Authorization:a},params:{id:c,role:s}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},j=async(c,s,a,r,p)=>{const y={nickname:s,username:a,password:r};try{return(await k.post("/auth",{Authorization:c,user:y},{params:{role:p}})).data}catch(n){if(n.response)switch(n.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${n.message}`)}else n.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(n)}},B=async(c,s,a)=>{try{return(await k.post("/auth",{Authorization:c},{params:{username:s,role:a}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},C=async(c,s,a)=>{try{return(await k.put(`/tools/${a}`,{Authorization:c,tool:s})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},P=async(c,s)=>{try{return(await k.delete(`/tools/${s}`,{data:{Authorization:c}})).data}catch(a){if(a.response)switch(a.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${a.message}`)}else a.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(a)}},R=async(c,s,a,r,p,y)=>{const n={name:s,category:a,url:r,logo_url:p,description:y};try{return(await k.post("/tools",{Authorization:c,tool:n})).data}catch(d){if(d.response)switch(d.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),f.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${d.message}`)}else d.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(d)}},M=I("admin",()=>{const c=g([]),s=g([]),a=g([]),r=g(0),p=g(0),y=g(0),n=U(),d=async()=>{try{const t=n.user.token,o=await N(t);o&&o.student?(c.value=o.student,T(c.value,"student")):e.warning("返回数据格式有误")}catch{e.error("数据获取失败")}},i=async()=>{try{const t=n.user.token,o=await N(t);s.value=o.teachers}catch{e.error("教师列表获取异常")}},T=(t,o)=>{o==="student"?r.value=t.length:p.value=t.length},O=async(t,o,u,l,b)=>{const m=n.user.token;try{await D(t,o,m,u??"",l,b),e.success("修改成功")}catch(h){e.error(h==null?void 0:h.message)}},v=async(t,o)=>{const u=n.user.token;try{await $(t,o,u),e.success("修改成功"),o==="student"?d():o==="teacher"&&i()}catch{e.error("删除失败")}},S=async(t,o,u,l)=>{const b=n.user.token;try{const m=await j(b,t,o,u,l);e.success("添加成功")}catch(m){console.error(m)}},E=g({id:0,nickname:"",username:"",role:"",cno:"",message:""});return{students:c,teachers:s,tools:a,totalStudents:r,totalTeachers:p,totalTools:y,userFound:E,fetchStudents:d,fetchTeachers:i,countSize:T,updateUserInfo:O,deleteUser:v,addUser:S,queryUser:async(t,o)=>{const u=n.user.token;try{const l=await B(u,t,o);e.success("查询成功"),E.value=l.user}catch(l){e.error(l==null?void 0:l.message)}},updateToolInfo:async(t,o,u,l,b,m)=>{const h=n.user.token,A={name:o,category:u,url:l,logo_url:b,description:m};try{const w=await C(h,A,t);e.success("修改成功")}catch(w){console.error(w==null?void 0:w.message)}},deleteTool:async t=>{const o=n.user.token;try{const u=await P(o,t);e.success("删除成功")}catch(u){e.error(u)}},addTool:async(t,o,u,l,b)=>{const m=n.user.token;try{const h=await R(m,t,o,u,l,b);return e.success("工具添加成功"),h}catch{e.error("工具添加失败")}}}});export{M as u};
