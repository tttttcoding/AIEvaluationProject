import{s as g,E as e,a as h,d as I,r as f,u as A}from"./index-Bn9PkK3f.js";const v=async a=>{try{console.log("发送GetUsers请求"),console.log(a);const s=await g.get("/auth",{headers:{Authorization:a}});return console.log("获取用户列表响应:",s.data),s.data}catch(s){if(s.response)switch(s.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${s.message}`)}else s.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(s)}},D=async(a,s,c,r,i,k)=>{const n={nickname:i,username:k,password:r};try{const l=await g.put("/auth",{Authorization:c,user:n},{params:{role:s,id:a}});return console.log(l.data),l.data}catch(l){if(l.response)switch(l.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${l.message}`)}else l.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(l)}},$=async(a,s,c)=>{try{return console.log(c),(await g.delete("/auth",{headers:{Authorization:c},params:{id:a,role:s}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},j=async(a,s,c,r,i)=>{const k={nickname:s,username:c,password:r};try{return(await g.post("/auth",{Authorization:a,user:k},{params:{role:i}})).data}catch(n){if(n.response)switch(n.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${n.message}`)}else n.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(n)}},B=async(a,s,c)=>{try{return(await g.post("/auth",{Authorization:a},{params:{username:s,role:c}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},C=async(a,s,c)=>{try{return(await g.put(`/tools/${c}`,{Authorization:a,tool:s})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}else r.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(r)}},P=async(a,s)=>{try{return(await g.delete(`/tools/${s}`,{data:{Authorization:a}})).data}catch(c){if(c.response)switch(c.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${c.message}`)}else c.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(c)}},R=async(a,s,c,r,i,k)=>{const n={name:s,category:c,url:r,logo_url:i,description:k};try{return(await g.post("/tools",{Authorization:a,tool:n})).data}catch(l){if(l.response)switch(l.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),h.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${l.message}`)}else l.code==="ECONNABORTED"?e.error("请求超时，请检查网络连接"):e.error("网络错误，请检查网络连接");return Promise.reject(l)}},Q=I("admin",()=>{const a=f([]),s=f([]),c=f([]),r=f(0),i=f(0),k=f(0),n=A(),l=async()=>{try{const t=n.user.token;console.log("开始获取学生列表...");const o=await v(t);o&&o.student?(a.value=o.student,w(a.value,"student"),console.log("学生列表，数量:",a.value.length),e.success("获取学生列表成功")):(console.error("学生列表返回数据格式有误:",o),e.warning("获取学生列表失败"))}catch(t){console.error("学生列表获取异常:",t),e.error("获取学生列表失败，请检查网络或服务状态")}},b=async()=>{try{const t=n.user.token,o=await v(t);s.value=o.teachers}catch{console.error("教师列表获取异常")}},w=(t,o)=>{o==="student"?r.value=t.length:i.value=t.length},N=async(t,o,p,u,y)=>{const d=n.user.token;try{const m=await D(t,o,d,p??"",u,y);console.log(m),e({type:"success",message:"修改成功"})}catch(m){console.error(m)}},O=async(t,o)=>{const p=n.user.token;try{const u=await $(t,o,p);console.log(u.message),e({type:"success",message:"删除成功"}),o==="student"?l():o==="teacher"&&b()}catch(u){console.error(u),e({type:"error",message:u.message||"删除失败，请重试"})}},S=async(t,o,p,u)=>{const y=n.user.token;try{const d=await j(y,t,o,p,u);console.log(d.message),e({type:"success",message:"添加成功"})}catch(d){console.error(d)}},T=f({id:0,nickname:"",username:"",role:"",message:""});return{students:a,teachers:s,tools:c,totalStudents:r,totalTeachers:i,totalTools:k,userFound:T,fetchStudents:l,fetchTeachers:b,countSize:w,updateUserInfo:N,deleteUser:O,addUser:S,queryUser:async(t,o)=>{const p=n.user.token;try{const u=await B(p,t,o);console.log(u),e({type:"success",message:"查询成功"}),T.value=u.user}catch(u){console.error(u)}},updateToolInfo:async(t,o,p,u,y,d)=>{const m=n.user.token,U={name:o,category:p,url:u,logo_url:y,description:d};try{const E=await C(m,U,t);e({type:"success",message:"修改成功"})}catch(E){console.error(E)}},deleteTool:async t=>{const o=n.user.token;try{const p=await P(o,t);console.log(p.message),e({type:"success",message:"删除成功"})}catch(p){console.error(p)}},addTool:async(t,o,p,u,y)=>{const d=n.user.token;try{const m=await R(d,t,o,p,u,y);return console.log(m.message),e({type:"success",message:"工具添加成功"}),m}catch(m){throw console.error(m),e({type:"error",message:m.message||"添加失败，请重试"}),m}}}});export{Q as u};
