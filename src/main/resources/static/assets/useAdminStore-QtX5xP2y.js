import{s as h,d as D,r as i,u as E,E as y}from"./index-BClh5s4Q.js";const v=async t=>{var n;try{console.log("发送GetUsers请求"),console.log(t);const e=await h.get("/auth",{headers:{Authorization:t}});return console.log("获取用户列表响应:",e.data),e.data}catch(e){throw console.error("获取用户列表错误:",e),console.error("错误详情:",((n=e.response)==null?void 0:n.data)||e.message),e.response?e.response.data:{message:"请求失败"}}},G=async(t,n,e,r,u,m)=>{const a={nickname:u,username:m,password:r};try{const p=await h.put("/auth",{Authorization:e,user:a},{params:{role:n,id:t}});return console.log(p.data),p.data}catch(p){throw console.error("更新用户信息错误:",p),p.response?p.response.data:{message:"请求失败"}}},$=async(t,n,e)=>{var r;try{return console.log(e),(await h.delete("/auth",{headers:{Authorization:e},params:{id:t,role:n}})).data}catch(u){throw console.error("删除用户错误:",u),console.log((r=u.response)==null?void 0:r.data),u.response?u.response.data:{message:"请求失败"}}},x=async(t,n,e,r,u)=>{const m={nickname:n,username:e,password:r};try{return(await h.post("/auth",{Authorization:t,user:m},{params:{role:u}})).data}catch(a){throw console.error("添加用户错误:",a),a.response?a.response.data:{message:"请求失败"}}},F=async(t,n,e)=>{try{return(await h.post("/auth",{Authorization:t},{params:{username:n,role:e}})).data}catch(r){throw console.error("查询用户错误:",r),r.response?r.response.data:{message:"请求失败"}}},M=async(t,n,e)=>{try{return(await h.put(`/tools/${e}`,{Authorization:t,tool:n})).data}catch(r){throw console.error("更新工具信息错误:",r),r.response?r.response.data:{message:"请求失败"}}},Q=async(t,n)=>{try{return(await h.delete(`/tools/${n}`,{data:{Authorization:t}})).data}catch(e){throw console.error("删除工具错误:",e),e.response?e.response.data:{message:"请求失败"}}},b=async(t,n,e,r,u,m)=>{const a={name:n,category:e,url:r,logo_url:u,description:m};try{return(await h.post("/tools",{Authorization:t,tool:a})).data}catch(p){throw console.error("添加工具错误:",p),p.response?p.response.data:{message:"请求失败"}}},K=D("admin",()=>{const t=i([]),n=i([]),e=i([]),r=i(0),u=i(0),m=i(0),a=E(),p=async()=>{try{const o=a.user.token;console.log("开始获取学生列表...");const s=await v(o);s&&s.student?(t.value=s.student,T(t.value,"student"),console.log("学生列表，数量:",t.value.length),y.success("获取学生列表成功")):(console.error("学生列表返回数据格式有误:",s),y.warning("获取学生列表失败"))}catch(o){console.error("学生列表获取异常:",o),y.error("获取学生列表失败，请检查网络或服务状态")}},k=async()=>{try{const o=a.user.token,s=await v(o);n.value=s.teachers}catch{console.error("教师列表获取异常")}},T=(o,s)=>{s==="student"?r.value=o.length:u.value=o.length},S=async(o,s,l,c,w)=>{const g=a.user.token;try{const d=await G(o,s,g,l??"",c,w);console.log(d),y({type:"success",message:"修改成功"})}catch(d){console.error(d)}},I=async(o,s)=>{const l=a.user.token;try{const c=await $(o,s,l);console.log(c.message),y({type:"success",message:"删除成功"}),s==="student"?p():s==="teacher"&&k()}catch(c){console.error(c),y({type:"error",message:c.message||"删除失败，请重试"})}},q=async(o,s,l,c)=>{const w=a.user.token;try{const g=await x(w,o,s,l,c);console.log(g.message),y({type:"success",message:"添加成功"})}catch(g){console.error(g)}},U=i({id:0,nickname:"",username:"",role:"",message:""});return{students:t,teachers:n,tools:e,totalStudents:r,totalTeachers:u,totalTools:m,userFound:U,fetchStudents:p,fetchTeachers:k,countSize:T,updateUserInfo:S,deleteUser:I,addUser:q,queryUser:async(o,s)=>{const l=a.user.token;try{const c=await F(l,o,s);console.log(c),y({type:"success",message:"查询成功"}),U.value=c.user}catch(c){console.error(c)}},updateToolInfo:async(o,s,l,c,w,g)=>{const d=a.user.token,A={name:s,category:l,url:c,logo_url:w,description:g};try{const f=await M(d,A,o);y({type:"success",message:"修改成功"})}catch(f){console.error(f)}},deleteTool:async o=>{const s=a.user.token;try{const l=await Q(s,o);console.log(l.message),y({type:"success",message:"删除成功"})}catch(l){console.error(l)}},addTool:async(o,s,l,c,w)=>{const g=a.user.token;try{const d=await b(g,o,s,l,c,w);return console.log(d.message),y({type:"success",message:"工具添加成功"}),d}catch(d){throw console.error(d),y({type:"error",message:d.message||"添加失败，请重试"}),d}}}});export{K as u};
