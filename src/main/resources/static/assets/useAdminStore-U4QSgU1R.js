import{s as k,E as e,b as y,d as P,r as g,u as A}from"./index-UgPJK38L.js";const T=async a=>{try{const s=await k.get("/auth",{headers:{Authorization:a}});return console.log("获取用户列表响应:",s.data),s.data}catch(s){if(s.response)switch(s.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${s.message}`)}return Promise.reject(s)}},q=async(a,s,c,r,d,f)=>{const p={password:r,nickname:d,username:f,cno:""};try{return(await k.put("/auth",{Authorization:c,user:p},{params:{role:s,id:a}})).data}catch(m){if(m.response)switch(m.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${m.message}`)}return Promise.reject(m)}},D=async(a,s,c)=>{try{return(await k.delete("/auth",{headers:{Authorization:c},params:{id:a,role:s}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}return Promise.reject(r)}},E=async(a,s,c,r,d)=>{const f={nickname:s,username:c,password:r};try{return(await k.post("/auth",{Authorization:a,user:f},{params:{role:d}})).data}catch(n){if(n.response)switch(n.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${n.message}`)}return Promise.reject(n)}},x=async(a,s,c)=>{try{return(await k.post("/auth",{Authorization:a},{params:{username:s,role:c}})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}return Promise.reject(r)}},z=async(a,s,c)=>{try{return(await k.put(`/tools/${c}`,{Authorization:a,tool:s})).data}catch(r){if(r.response)switch(r.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${r.message}`)}return Promise.reject(r)}},F=async(a,s)=>{try{return(await k.delete(`/tools/${s}`,{data:{Authorization:a}})).data}catch(c){if(c.response)switch(c.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${c.message}`)}return Promise.reject(c)}},G=async(a,s,c,r,d,f)=>{const n={name:s,category:c,url:r,logo_url:d,description:f};try{return(await k.post("/tools",{Authorization:a,tool:n})).data}catch(p){if(p.response)switch(p.response.status){case 401:e.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),y.push("/form");break;case 403:e.error("没有权限访问");break;case 404:e.error("请求的资源不存在");break;case 500:e.error("服务器内部错误");break;default:e.error(`请求失败: ${p.message}`)}return Promise.reject(p)}},J=P("admin",()=>{const a=g([]),s=g([]),c=g([]),r=g(0),d=g(0),f=g(0),n=A(),p=async()=>{try{const o=n.user.token,t=await T(o);t&&t.student?(a.value=t.student,v(a.value,"student")):e.warning("返回数据格式有误")}catch{e.error("数据获取失败")}},m=async()=>{try{const o=n.user.token,t=await T(o);s.value=t.teachers}catch{e.error("教师列表获取异常")}},v=(o,t)=>{t==="student"?r.value=o.length:d.value=o.length},I=async(o,t,u,l,b)=>{const i=n.user.token;try{await q(o,t,i,u??"",l,b),e.success("修改成功")}catch(h){e.error(h==null?void 0:h.message)}},U=async(o,t)=>{const u=n.user.token;try{await D(o,t,u),e.success("修改成功"),t==="student"?p():t==="teacher"&&m()}catch{e.error("删除失败")}},$=async(o,t,u,l)=>{const b=n.user.token;try{const i=await E(b,o,t,u,l);e.success("添加成功")}catch(i){console.error(i)}},S=g({id:0,nickname:"",username:"",role:"",cno:"",message:""});return{students:a,teachers:s,tools:c,totalStudents:r,totalTeachers:d,totalTools:f,userFound:S,fetchStudents:p,fetchTeachers:m,countSize:v,updateUserInfo:I,deleteUser:U,addUser:$,queryUser:async(o,t)=>{const u=n.user.token;try{const l=await x(u,o,t);e.success("查询成功"),S.value=l.user}catch(l){e.error(l==null?void 0:l.message)}},updateToolInfo:async(o,t,u,l,b,i)=>{const h=n.user.token,j={name:t,category:u,url:l,logo_url:b,description:i};try{const w=await z(h,j,o);e.success("修改成功")}catch(w){console.error(w==null?void 0:w.message)}},deleteTool:async o=>{const t=n.user.token;try{const u=await F(t,o);e.success("删除成功")}catch(u){e.error(u)}},addTool:async(o,t,u,l,b)=>{const i=n.user.token;try{const h=await G(i,o,t,u,l,b);return e.success("工具添加成功"),h}catch{e.error("工具添加失败")}}}});export{J as u};
