import{s as H,E as t,a as O,P as B,F as U,f as J,g as j,d as _,r as o}from"./index-DvWpKrQb.js";import{u as M,b as k,c as P}from"./ToolsService-JFaD2gMm.js";import{u as C}from"./useToolsStore-CAAdC4a7.js";const $=async(c,i)=>{try{return(await H.post(`/evaluation/upload/${i}`,c,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(n){if(n.response)switch(n.response.status){case 401:t.error("登录状态过期，请重新登录!"),localStorage.removeItem("user"),O.push("/form");break;case 403:t.error("没有权限访问");break;case 404:t.error("请求的资源不存在");break;case 500:t.error("服务器内部错误");break;default:t.error(`请求失败: ${n.message}`)}else n.code==="ECONNABORTED"?t.error("请求超时，请检查网络连接"):t.error("网络错误，请检查网络连接");return Promise.reject(n)}};const K=_("score",()=>{C();const c=o(null),i=o(!1),n=o(""),E=o([]),g=o(!1),d=o([{name:"内容质量",percent:.3,score:0,criteria:["表达清晰：生成内容易懂、逻辑清晰","创意能力：提供创新性的答案或富有变化的内容","上下文理解：能否根据历史输入调整生成结果，提高连贯性","事实准确性：是否提供错误或误导性内容"],basis:""},{name:"性能高效性",percent:.25,score:0,criteria:["结果精准：生成的结果符合或超出预期","响应速度：用户指令下达后能快速生成结果","运行稳定：不卡顿、不崩溃","核心功能完备：具备同类产品核心功能"],basis:""},{name:"操作便捷性",percent:.25,score:0,criteria:["界面交互：美观简洁，功能易查找","新手引导：提供教程或文档，帮助快速熟悉","多端兼容：支持电脑、手机、平板同步使用","个性化设置：可根据用户偏好调整 AI 行为"],basis:""},{name:"付费合理性",percent:.1,score:0,criteria:["免费使用：提供免费版本，主要功能可试用","定价合理：价格在可接受范围","价格匹配：付费功能质量与价格相符","价格灵活：提供多种套餐或功能模块收费"],basis:""},{name:"服务反馈水平",percent:.1,score:0,criteria:["用户反馈：提供反馈通道，客服响应及时","隐私保护：清晰告知数据收集情况","产品活跃性：定期更新，优化性能，采纳用户反馈","用户社区活跃度：有社区供提问、交流、分享"],basis:""}]),v=o({username:"默认",tool:"默认",category:"默认",averageScore:0,comment:""}),l=o(null),y=r=>{if(!l.value)return!0;const e=Date.now(),a=10*1e3;if(l.value.fileName===r&&e-l.value.timestamp<a){const s=Math.ceil((a-(e-l.value.timestamp))/1e3);return t.warning(`请求过于频繁，请等待 ${s} 秒后再次上传`),!1}return!0},F=r=>{const e=r.target.files;e&&e.length>0&&(c.value=e[0],n.value=e[0].name)},w=o(0),N=1*1024*1024;function R(r){const e=[];let a=0;for(;a<r.size;){const s=Math.min(a+N,r.size);e.push(r.slice(a,s)),a=s}return e}const D=async()=>{if(!c.value){t.warning("请选择文件");return}if(!y(c.value.name))return;const r=JSON.parse(localStorage.getItem("user")).token;i.value=!0;try{l.value={timestamp:Date.now(),fileName:c.value.name};let e=null,a=null;const s=R(c.value),f=s.length;for(let u=0;u<s.length;u++){const p=new FormData;p.append("Authorization",r),p.append("file",s[u]),p.append("fileSum",String(f)),e=await $(p,u+1),w.value=Math.round((u+1)/f*100)}a||t.error(a)}catch(e){console.error(e)}finally{i.value=!1}},h=o({}),T=async r=>{const a={rating:b(),comment:v.value.comment},s=JSON.parse(localStorage.getItem("user")).token;try{await M(s,a,r),t.success("评分上传成功"),await S(r)}catch{t.error("评分上传失败")}},S=async r=>{try{h.value={};const e=await k(r);return h.value=e,e}catch{t.error("工具详情获取失败")}},b=()=>{const r=[.3,.25,.25,.1,.1];let e=0;return d.value.forEach((a,s)=>{e+=a.score*r[s]}),parseFloat(e.toFixed(1))},m=o([]),I=o([]),A=async()=>{try{await Promise.all(m.value.map(async r=>{r.rate_time=r.rate_time.replace("T"," ");const e=await k(Number(r.tool_id));return r.tool_name=e.name||"未知工具",r.tool_category=e.category||"未知类别",{...r}}))}catch{t.error("格式化历史评分记录失败")}};return{rateStandards:d,rate:v,progress:w,userFile:c,uploading:i,toolsDetail:h,userFileName:n,reportHistory:E,loadingHistory:g,lastUploadRecord:l,historyRates:m,historyRateFormatted:I,checkThrottle:y,handleUpload:D,handleUserFileChange:F,ToolsDetailGet:S,fetchHistoryRates:async()=>{const r=JSON.parse(localStorage.getItem("user")).token;g.value=!0;try{const e=await P(r);m.value=e.rates,console.log(m.value),await A(),g.value=!1,t.success("历史评分记录获取成功")}catch{t.error("历史评分记录获取失败")}},evaluationTransmission:T,calculateWeightedAverage:b}});export{K as u};
