import{d as p,r as n}from"./index-D8PVboq4.js";import{g as T,a as I}from"./ToolsService-RoSKOOJw.js";const N=p("tools",()=>{const t=n([]),o=n({}),i=n(!1),g=n(new Set),m=5*60*1e3,h=async()=>{const e=localStorage.getItem("toolCategories"),c=localStorage.getItem("toolsByCategory");if(e&&c)try{const a=JSON.parse(e),s=JSON.parse(c);return a!=null&&a.length?(t.value=a,o.value=s,g.value=new Set(a),!0):!1}catch(a){console.error("缓存数据解析失败:",a)}return!1},f=()=>{try{t.value.length>0&&(localStorage.setItem("toolCategories",JSON.stringify(t.value)),localStorage.setItem("toolsByCategory",JSON.stringify(o.value)),localStorage.setItem("toolsCacheTime",Date.now().toString()))}catch(e){console.error("保存缓存失败:",e)}},C=()=>{const e=localStorage.getItem("toolsCacheTime");return!e||Date.now()-parseInt(e)>m},u=async(e,c=!1)=>{for(let s=0;s<e.length;s+=3){const w=e.slice(s,s+3).map(async l=>{try{const r=await T(l);r!=null&&r.tools&&(o.value[l]=r.tools.map(d),g.value.add(l),c||f())}catch(r){console.error(`获取 ${l} 工具失败:`,r),o.value[l]=[]}});await Promise.all(w)}},v=async()=>{t.value.length&&await u(t.value.slice(0,2))},y=async()=>{t.value.length&&(await u(t.value.slice(2),!0),Object.keys(o.value).length===t.value.length&&f())},S=async()=>{try{if(i.value=!0,!C()&&await h())return;const e=await I();e!=null&&e.categories&&(t.value=e.categories,await v(),await y())}catch(e){console.error("获取数据异常:",e),await h()}finally{i.value=!1}},d=e=>({id:e.id,name:e.name,logo_url:e.logo_url,url:e.url,description:e.description,score:e.score,ratingCount:e.ratingCount,category:e.category});return{categories:t,toolsByCategory:o,isLoading:i,loadedCategories:g,fetchCategory:S,loadToolsForCategories:u}});export{N as u};
